import{u as Mt,q as Lt,i as vn,v as qi,_ as xs,x as Ts,y as bn,z as Sn,A as Ui,B as Os,C as As,D as Ms,E as Cs,F as Ls,G as js,I as Ps,J as ks,K as Ds,t as q,L as $s,M as Ns,N as Fs,n as zi,O as Is,l as gr,P as wr,S as Gi,Q as ui,m as Et,R as yr,T as It,a as Ws,U as Bs,r as qs,V as vr,W as br,h as Hi,X as He,g as En,Y as je,c as _n,Z as Us,H as Rn,d as xn,$ as zs,a0 as Gs,a1 as Tn,j as Hs}from"./schema-utils-qbCEesrZ.D4WS2fP6.js";import{as as Vs,at as Ks,K as Bt,m as ht,p as Vi,c as Ys,P as lt,au as Sr,b as ue,i as Js,av as Qi,aw as Ht,ax as Zs,J as he,a9 as $e,aj as fi,ay as Xs,ak as Qs,d as On,v as Er,az as tr,ab as to,ap as Ki}from"./index.BDwdYHGq.js";const{parseArgs:er}=Vs,eo={parseArgs:er},io=Object.freeze(Object.defineProperty({__proto__:null,default:eo,parseArgs:er},Symbol.toStringTag,{value:"Module"}));function ro(r){const t=(...e)=>r(...e);return Object.defineProperty(t,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),t}const{toString:no}=Object.prototype;function so(r){return no.call(r)==="[object RegExp]"}const _r={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function oo(r,t={}){if(!so(r))throw new TypeError("Expected a RegExp instance");const e=Object.keys(_r).map(n=>(typeof t[n]=="boolean"?t[n]:r[n])?_r[n]:"").join(""),i=new RegExp(t.source||r.source,e);return i.lastIndex=typeof t.lastIndex=="number"?t.lastIndex:r.lastIndex,i}function ao(r,t,{timeout:e}={}){try{return ro(()=>oo(r).test(t),{timeout:e})()}catch(i){throw i}}const lo=45,ho={timeout:400};function co(r){return r.length>lo?!1:ao(Ks({exact:!0}),r,ho)}function uo(r,t){const e=[];for(let i=0;i<r.length;i++)try{const n=/^@?[a-z0-9_-]+=/i.test(r[i])&&Bt.parse(r[i],"object");n&&(r.splice(i--,1),e.push(Object.entries(n)[0]))}catch(n){throw n}return e}function fo(r){return r.startsWith("'")?r.slice(1,-1):r.startsWith('"')?r.slice(1,-1).replace(/\\(.)/g,"$1"):r.startsWith("\\")?r[1]===`
`?"":r[1]:r}function po(r){const t=r.trim().split(/(\s+|"(?:\\.|[^"\\])*"|'(?:[^'])*'|[^\\'"\s]+|\\.)/s),e=[];for(let i=1,n=-1;i<t.length;i+=2){if(n>=0&&!t[i].trim()){e[++n]="";continue}if(t[i-1].length)throw new Error("unparsable shell-like command: unexpected "+t[i-1]);n<0&&(e[n=0]=""),e[n]+=fo(t[i])}if(t[t.length-1].length)throw new Error("unparsable shell-like command - unclosed quote or escape sequence");return e}const mo={parse:So,stringify:vo};function di(r){return String(r??"").replace(/["\\]/g,t=>`\\${t}`)}function go(r){return String(r??"").replace(/'/g,`'"'"'`)}function wo(r=[]){return Array.isArray(r)?r:r instanceof Headers?[...r.entries()]:Object.entries(r)}function yo(r){return co(r)?r:`$(dig +short "${r}" | tail -1)`}function vo(r,{include:t}={}){const{method:e,headers:i,body:n,meta:{resolve:s,insecure:a}={}}=r,o=Lt(r),l=o.port||(o.protocol=="https:"?443:80);return[`curl ${e!=="GET"?`--request ${e} `:""}"${di(o)}"`,s&&`--resolve "${o.hostname}:${l}:${yo(s)}"`,a&&a!=="false"&&"--insecure",t&&"--include",...wo(i).map(([h,c])=>`--header "${di(h)}: ${di(c)}"`),...n?[`--data-raw '${go(n)}'`]:[]].filter(Boolean).join(` \\
  `)}const bo=["Connection","Content-Length","Keep-Alive","TE","Transfer-Encoding","Trailer","Upgrade","Proxy-Authorization","Proxy-Authenticate"];function So(r){const t=po(r);if(t[0]!=="curl")throw new Error(`not a curl command: ${t[0]} ...`);const{values:e,positionals:i}=er({args:t.slice(1),allowPositionals:!0,options:{request:{short:"X",type:"string"},header:{type:"string",short:"H",multiple:!0},include:{short:"i",type:"boolean"},location:{short:"L",type:"boolean"},data:{short:"d",type:"string"},"data-ascii":{type:"string"},"data-binary":{type:"string"},"data-raw":{type:"string"},json:{type:"string"},form:{short:"F",type:"string",multiple:!0},compressed:{type:"boolean"},url:{type:"string"}}}),n=e.include,s=ue(uo(i),([m,y])=>({[m]:y})),a=e.url??i.shift();if(!a)throw new lt("curl-fmt: no positional arguments or --url");const{origin:o,pathname:l,searchParams:h}=Lt(a),c=Mt(e.header?.map(m=>{const[,y,g]=/^([^:]*?):(.*)$/.exec(m)||[];return[y.trim(),g.trim()]}));for(const m of bo)c.delete(m);e.json&&(c.append("Content-Type","application/json"),c.append("Accept","application/json"));const f=e.data!==void 0?{body:e.data}:e.json!==void 0?{body:e.json,encoding:"form"}:e["data-raw"]!==void 0?{body:e["data-raw"]}:e["data-ascii"]!==void 0?{body:e["data-ascii"]}:e["data-binary"]!==void 0?{body:e["data-binary"],encoding:"raw"}:e.form?{body:Js(ue(e.form??[],m=>{const[,y,g]=/^([^=]*?)=(.*)$/.exec(m)||[void 0,m];return{[decodeURIComponent(y)]:g?decodeURIComponent(g):""}})).toString(),encoding:"form"}:{},u=e.request??(f.body!==void 0?"POST":"GET");return{options:{include:n},request:{method:u,origin:o,pathname:l??(o?"/":void 0),searchParams:h,meta:{},headers:c,values:s,...f}}}function An(r){const t=r.split(`
`);let e=0;return{peek(){return t[e]},next(){return t[e++]},rest(){return t.slice(e)},get eof(){return e>=t.length}}}const Ne={parse:Oo,stringify:_o,requestObject:{json:Mo,fromJSON:Co},responseObject:{parse:Ao,stringify:Ro,json:xo,fromJSON:To}};function Eo(r,t,e,i){const n=i?.limit??1/0;let s=r,a=s.length;const o=`${" ".repeat(i?.indent??2)}`;for(const h of t?.split("/").slice(1)||[])a+1+h.length>n&&(a=o.length,s+=`
${o}`),s+=`/${h}`,a+=1+h.length;if(!e.size)return s;if(a+String(e).length<=n)return s+e;let l=0;for(const[h,c]of e.entries())s+=`
${o}${l++==0?"?":"&"}${Sr(h)}=${Sr(c)}`;return s}function _o({values:r,...t},e){const{origin:i,pathname:n,searchParams:s}=Lt(t),a=Bt.stringify(r??{},e?.kv??{indent:2,limit:e?.limit??80,split:!0,trailer:`
`}),o=`${i?.trim()?`${t.method??"GET"} `:""}${i??""}`,l=Eo(o,n,s,e);return`${a}${l}${[...Object.entries(t.meta??{})].map(([h,c])=>`
[${h}]: ${c}`).join("")}${[...Mt(t.headers)??[]].map(([h,c])=>`
${h}: ${c}`).join("")}${t.body?`

${t.body}`:""}`.trim()}function Ro(r){const{status:t,statusText:e,headers:i}=r;return`${t}${e?` ${e}`:""}${[...i.entries()].map(([n,s])=>`
${n}: ${s}`).join("")}${r.body?`

${r.body}`:""}
`.trim()}function xo(r){return{status:Number(r.status??0),statusText:r.statusText,headers:[...r.headers||[]],body:r.body}}function To(r){return{status:r.status,statusText:r.statusText,headers:Mt(r.headers),body:r.body}}function Oo(r,t={}){const{[Bt.unparsed]:e,...i}=Bt.parse(r,"stream",{allowExpressions:!0}),n=An(e??""),s={},a=Object.assign({},ht(i,{select(g,v){return Bt.isExprValue(g)?(s[v]=`{{ -${v} = $$expr(${JSON.stringify(Bt.loadExprValue(g))}) }}`,!1):!0}}));if(t.acceptcurl&&/^curl\s/.test(n.peek().trim())){const{request:{values:g,...v}}=mo.parse(n.rest().join(`
`)),[S,{headers:x,...A}]=vn(v);return{...qi(S),headers:Mt(x),...A,values:{...g,...a}}}const o=n.next();if(!o.trim())return{values:a};const l=Vi(o),h=/^\s*(?:([A-Z]+)\s+)?((?:https?:)?[/][/].*)?/.exec(l.template).slice(0,4).map(g=>g&&Ys(g,l));if(!h)throw new lt("failed to parse http request, expected maybe a method and url: "+o);let[,c="GET",f=""]=h;for(fe(n);!n.eof&&/^\s*[/?&]/.test(n.peek());)f+=Cn(n.next().trim()),fe(n);const{headers:u,meta:m}=Mn(n),y=Ln(n);return{...qi(f),method:c,meta:m,headers:Mt(u),...y&&{body:y},values:a,computations:s}}function Ao(r){const t=An(r??"");fe(t,{andBlankLines:!0});const[,e,i]=/\s*(\d+?)(?:\s+(.*))?$/.exec(t.next().trim()),{headers:n,meta:s}=Mn(t),a=Ln(t);return{status:e,statusText:i,headers:Mt(n),meta:s,body:a}}function Mn(r){const t=[],e={};for(;fe(r),!r.eof;){const i=Cn(r.next());if(!i)break;const n=/^\s*\[(\s*[^:\]]+)\s*\]\s*:\s*(.*)$/.exec(i);if(n){const[,l,h]=n;e[l]=h;continue}const s=/^\s*([^:]+):\s*(.*)$/.exec(i);if(!s)throw new lt("invalid headerline: "+i);const[,a,o]=s;t.push([a.trimEnd(),o])}return{headers:t,meta:e}}function Mo(r){return{method:r.method??"GET",url:Lt(r).toString(),headers:[...r.headers||[]],body:r.body,values:r.values,meta:r.meta}}function Co(r){const{origin:t,pathname:e,searchParams:i}=Lt(r.url);return{method:r.method,origin:t,pathname:e,searchParams:i,meta:r.meta,headers:Mt(r.headers),body:r.body,values:r.values}}function Cn(r){return r.replace(/\s*(?:#.*)?$/,"")}function fe(r,{andBlankLines:t=!1}={}){for(;!r.eof&&(/^#/.test(r.peek())||t&&!r.peek().trim());)r.next()}function Ln(r){const t=[];for(;fe(r,{andBlankLines:!1}),!r.eof;)t.push(r.next());return t.join(`
`).trim()}function Fe(r){if(!r)return r;switch(typeof r){case"object":{if(r instanceof Number)return r;if(Array.isArray(r))return r.length===0?void 0:r.map(Fe);if(Object.keys(r).length===0)return;const t=Object.entries(r).map(([e,i])=>[e,Fe(i)]).filter(([,e])=>e!==void 0);return t.length===0?void 0:t.reduce((e,[i,n])=>Object.assign(e,{[i]:n}),{})}default:return r}}function Lo(){let r;return{promise:new Promise((e,i)=>r={resolve:e,reject:i}),resolution:r}}var Ee={exports:{}},Rr;function Ve(){if(Rr)return Ee.exports;Rr=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(b,R,T){return Function.prototype.apply.call(b,R,T)},e;r&&typeof r.ownKeys=="function"?e=r.ownKeys:Object.getOwnPropertySymbols?e=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:e=function(b){return Object.getOwnPropertyNames(b)};function i(w){console&&console.warn&&console.warn(w)}var n=Number.isNaN||function(b){return b!==b};function s(){s.init.call(this)}Ee.exports=s,Ee.exports.once=S,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(w){if(typeof w!="number"||w<0||n(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");a=w}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||n(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function l(w){return w._maxListeners===void 0?s.defaultMaxListeners:w._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(b){for(var R=[],T=1;T<arguments.length;T++)R.push(arguments[T]);var L=b==="error",j=this._events;if(j!==void 0)L=L&&j.error===void 0;else if(!L)return!1;if(L){var M;if(R.length>0&&(M=R[0]),M instanceof Error)throw M;var I=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw I.context=M,I}var nt=j[b];if(nt===void 0)return!1;if(typeof nt=="function")t(nt,this,R);else for(var Pt=nt.length,vt=y(nt,Pt),T=0;T<Pt;++T)t(vt[T],this,R);return!0};function h(w,b,R,T){var L,j,M;if(o(R),j=w._events,j===void 0?(j=w._events=Object.create(null),w._eventsCount=0):(j.newListener!==void 0&&(w.emit("newListener",b,R.listener?R.listener:R),j=w._events),M=j[b]),M===void 0)M=j[b]=R,++w._eventsCount;else if(typeof M=="function"?M=j[b]=T?[R,M]:[M,R]:T?M.unshift(R):M.push(R),L=l(w),L>0&&M.length>L&&!M.warned){M.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=w,I.type=b,I.count=M.length,i(I)}return w}s.prototype.addListener=function(b,R){return h(this,b,R,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(b,R){return h(this,b,R,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(w,b,R){var T={fired:!1,wrapFn:void 0,target:w,type:b,listener:R},L=c.bind(T);return L.listener=R,T.wrapFn=L,L}s.prototype.once=function(b,R){return o(R),this.on(b,f(this,b,R)),this},s.prototype.prependOnceListener=function(b,R){return o(R),this.prependListener(b,f(this,b,R)),this},s.prototype.removeListener=function(b,R){var T,L,j,M,I;if(o(R),L=this._events,L===void 0)return this;if(T=L[b],T===void 0)return this;if(T===R||T.listener===R)--this._eventsCount===0?this._events=Object.create(null):(delete L[b],L.removeListener&&this.emit("removeListener",b,T.listener||R));else if(typeof T!="function"){for(j=-1,M=T.length-1;M>=0;M--)if(T[M]===R||T[M].listener===R){I=T[M].listener,j=M;break}if(j<0)return this;j===0?T.shift():g(T,j),T.length===1&&(L[b]=T[0]),L.removeListener!==void 0&&this.emit("removeListener",b,I||R)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(b){var R,T,L;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[b]),this;if(arguments.length===0){var j=Object.keys(T),M;for(L=0;L<j.length;++L)M=j[L],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(R=T[b],typeof R=="function")this.removeListener(b,R);else if(R!==void 0)for(L=R.length-1;L>=0;L--)this.removeListener(b,R[L]);return this};function u(w,b,R){var T=w._events;if(T===void 0)return[];var L=T[b];return L===void 0?[]:typeof L=="function"?R?[L.listener||L]:[L]:R?v(L):y(L,L.length)}s.prototype.listeners=function(b){return u(this,b,!0)},s.prototype.rawListeners=function(b){return u(this,b,!1)},s.listenerCount=function(w,b){return typeof w.listenerCount=="function"?w.listenerCount(b):m.call(w,b)},s.prototype.listenerCount=m;function m(w){var b=this._events;if(b!==void 0){var R=b[w];if(typeof R=="function")return 1;if(R!==void 0)return R.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function y(w,b){for(var R=new Array(b),T=0;T<b;++T)R[T]=w[T];return R}function g(w,b){for(;b+1<w.length;b++)w[b]=w[b+1];w.pop()}function v(w){for(var b=new Array(w.length),R=0;R<b.length;++R)b[R]=w[R].listener||w[R];return b}function S(w,b){return new Promise(function(R,T){function L(M){w.removeListener(b,j),T(M)}function j(){typeof w.removeListener=="function"&&w.removeListener("error",L),R([].slice.call(arguments))}A(w,b,j,{once:!0}),b!=="error"&&x(w,L,{once:!0})})}function x(w,b,R){typeof w.on=="function"&&A(w,"error",b,R)}function A(w,b,R,T){if(typeof w.on=="function")T.once?w.once(b,R):w.on(b,R);else if(typeof w.addEventListener=="function")w.addEventListener(b,function L(j){T.once&&w.removeEventListener(b,L),R(j)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return Ee.exports}var ir=Ve(),_e={exports:{}},xr;function Yt(){return xr||(xr=1,typeof Object.create=="function"?_e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:_e.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}),_e.exports}var pi,Tr;function jn(){return Tr||(Tr=1,pi=Ve().EventEmitter),pi}const rr=Qi(xs),Pn=Qi(io);var mi,Or;function jo(){if(Or)return mi;Or=1;function r(y,g){var v=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);g&&(S=S.filter(function(x){return Object.getOwnPropertyDescriptor(y,x).enumerable})),v.push.apply(v,S)}return v}function t(y){for(var g=1;g<arguments.length;g++){var v=arguments[g]!=null?arguments[g]:{};g%2?r(Object(v),!0).forEach(function(S){e(y,S,v[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(v)):r(Object(v)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(v,S))})}return y}function e(y,g,v){return g=a(g),g in y?Object.defineProperty(y,g,{value:v,enumerable:!0,configurable:!0,writable:!0}):y[g]=v,y}function i(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")}function n(y,g){for(var v=0;v<g.length;v++){var S=g[v];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(y,a(S.key),S)}}function s(y,g,v){return g&&n(y.prototype,g),Object.defineProperty(y,"prototype",{writable:!1}),y}function a(y){var g=o(y,"string");return typeof g=="symbol"?g:String(g)}function o(y,g){if(typeof y!="object"||y===null)return y;var v=y[Symbol.toPrimitive];if(v!==void 0){var S=v.call(y,g);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}var l=rr,h=l.Buffer,c=Pn,f=c.inspect,u=f&&f.custom||"inspect";function m(y,g,v){h.prototype.copy.call(y,g,v)}return mi=(function(){function y(){i(this,y),this.head=null,this.tail=null,this.length=0}return s(y,[{key:"push",value:function(v){var S={data:v,next:null};this.length>0?this.tail.next=S:this.head=S,this.tail=S,++this.length}},{key:"unshift",value:function(v){var S={data:v,next:this.head};this.length===0&&(this.tail=S),this.head=S,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var S=this.head,x=""+S.data;S=S.next;)x+=v+S.data;return x}},{key:"concat",value:function(v){if(this.length===0)return h.alloc(0);for(var S=h.allocUnsafe(v>>>0),x=this.head,A=0;x;)m(x.data,S,A),A+=x.data.length,x=x.next;return S}},{key:"consume",value:function(v,S){var x;return v<this.head.data.length?(x=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):v===this.head.data.length?x=this.shift():x=S?this._getString(v):this._getBuffer(v),x}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var S=this.head,x=1,A=S.data;for(v-=A.length;S=S.next;){var w=S.data,b=v>w.length?w.length:v;if(b===w.length?A+=w:A+=w.slice(0,v),v-=b,v===0){b===w.length?(++x,S.next?this.head=S.next:this.head=this.tail=null):(this.head=S,S.data=w.slice(b));break}++x}return this.length-=x,A}},{key:"_getBuffer",value:function(v){var S=h.allocUnsafe(v),x=this.head,A=1;for(x.data.copy(S),v-=x.data.length;x=x.next;){var w=x.data,b=v>w.length?w.length:v;if(w.copy(S,S.length-v,0,b),v-=b,v===0){b===w.length?(++A,x.next?this.head=x.next:this.head=this.tail=null):(this.head=x,x.data=w.slice(b));break}++A}return this.length-=A,S}},{key:u,value:function(v,S){return f(this,t(t({},S),{},{depth:0,customInspect:!1}))}}]),y})(),mi}var gi,Ar;function kn(){if(Ar)return gi;Ar=1;var r={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"};function t(o,l){var h=this,c=this._readableState&&this._readableState.destroyed,f=this._writableState&&this._writableState.destroyed;return c||f?(l?l(o):o&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(s,this,o)):r.nextTick(s,this,o)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(o||null,function(u){!l&&u?h._writableState?h._writableState.errorEmitted?r.nextTick(i,h):(h._writableState.errorEmitted=!0,r.nextTick(e,h,u)):r.nextTick(e,h,u):l?(r.nextTick(i,h),l(u)):r.nextTick(i,h)}),this)}function e(o,l){s(o,l),i(o)}function i(o){o._writableState&&!o._writableState.emitClose||o._readableState&&!o._readableState.emitClose||o.emit("close")}function n(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function s(o,l){o.emit("error",l)}function a(o,l){var h=o._readableState,c=o._writableState;h&&h.autoDestroy||c&&c.autoDestroy?o.destroy(l):o.emit("error",l)}return gi={destroy:t,undestroy:n,errorOrDestroy:a},gi}var wi={},Mr;function Jt(){if(Mr)return wi;Mr=1;function r(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,o.__proto__=l}var t={};function e(o,l,h){h||(h=Error);function c(u,m,y){return typeof l=="string"?l:l(u,m,y)}var f=(function(u){r(m,u);function m(y,g,v){return u.call(this,c(y,g,v))||this}return m})(h);f.prototype.name=h.name,f.prototype.code=o,t[o]=f}function i(o,l){if(Array.isArray(o)){var h=o.length;return o=o.map(function(c){return String(c)}),h>2?"one of ".concat(l," ").concat(o.slice(0,h-1).join(", "),", or ")+o[h-1]:h===2?"one of ".concat(l," ").concat(o[0]," or ").concat(o[1]):"of ".concat(l," ").concat(o[0])}else return"of ".concat(l," ").concat(String(o))}function n(o,l,h){return o.substr(0,l.length)===l}function s(o,l,h){return(h===void 0||h>o.length)&&(h=o.length),o.substring(h-l.length,h)===l}function a(o,l,h){return typeof h!="number"&&(h=0),h+l.length>o.length?!1:o.indexOf(l,h)!==-1}return e("ERR_INVALID_OPT_VALUE",function(o,l){return'The value "'+l+'" is invalid for option "'+o+'"'},TypeError),e("ERR_INVALID_ARG_TYPE",function(o,l,h){var c;typeof l=="string"&&n(l,"not ")?(c="must not be",l=l.replace(/^not /,"")):c="must be";var f;if(s(o," argument"))f="The ".concat(o," ").concat(c," ").concat(i(l,"type"));else{var u=a(o,".")?"property":"argument";f='The "'.concat(o,'" ').concat(u," ").concat(c," ").concat(i(l,"type"))}return f+=". Received type ".concat(typeof h),f},TypeError),e("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),e("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),e("ERR_STREAM_PREMATURE_CLOSE","Premature close"),e("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),e("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),e("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),e("ERR_STREAM_WRITE_AFTER_END","write after end"),e("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),e("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),e("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),wi.codes=t,wi}var yi,Cr;function Dn(){if(Cr)return yi;Cr=1;var r=Jt().codes.ERR_INVALID_OPT_VALUE;function t(i,n,s){return i.highWaterMark!=null?i.highWaterMark:n?i[s]:null}function e(i,n,s,a){var o=t(n,a,s);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var l=a?s:"highWaterMark";throw new r(l,o)}return Math.floor(o)}return i.objectMode?16:16*1024}return yi={getHighWaterMark:e},yi}var vi,Lr;function Po(){if(Lr)return vi;Lr=1,vi=r;function r(e,i){if(t("noDeprecation"))return e;var n=!1;function s(){if(!n){if(t("throwDeprecation"))throw new Error(i);t("traceDeprecation")?console.trace(i):console.warn(i),n=!0}return e.apply(this,arguments)}return s}function t(e){try{if(!Ht.localStorage)return!1}catch{return!1}var i=Ht.localStorage[e];return i==null?!1:String(i).toLowerCase()==="true"}return vi}var bi,jr;function $n(){if(jr)return bi;jr=1;var r={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"};bi=j;function t(_){var E=this;this.next=null,this.entry=null,this.finish=function(){ai(E,_)}}var e;j.WritableState=T;var i={deprecate:Po()},n=jn(),s=rr.Buffer,a=(typeof Ht<"u"?Ht:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(_){return s.from(_)}function l(_){return s.isBuffer(_)||_ instanceof a}var h=kn(),c=Dn(),f=c.getHighWaterMark,u=Jt().codes,m=u.ERR_INVALID_ARG_TYPE,y=u.ERR_METHOD_NOT_IMPLEMENTED,g=u.ERR_MULTIPLE_CALLBACK,v=u.ERR_STREAM_CANNOT_PIPE,S=u.ERR_STREAM_DESTROYED,x=u.ERR_STREAM_NULL_VALUES,A=u.ERR_STREAM_WRITE_AFTER_END,w=u.ERR_UNKNOWN_ENCODING,b=h.errorOrDestroy;Yt()(j,n);function R(){}function T(_,E,C){e=e||Vt(),_=_||{},typeof C!="boolean"&&(C=E instanceof e),this.objectMode=!!_.objectMode,C&&(this.objectMode=this.objectMode||!!_.writableObjectMode),this.highWaterMark=f(this,_,"writableHighWaterMark",C),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var k=_.decodeStrings===!1;this.decodeStrings=!k,this.defaultEncoding=_.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function($){ni(E,$)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}T.prototype.getBuffer=function(){for(var E=this.bufferedRequest,C=[];E;)C.push(E),E=E.next;return C},(function(){try{Object.defineProperty(T.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var L;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(L=Function.prototype[Symbol.hasInstance],Object.defineProperty(j,Symbol.hasInstance,{value:function(E){return L.call(this,E)?!0:this!==j?!1:E&&E._writableState instanceof T}})):L=function(E){return E instanceof this};function j(_){e=e||Vt();var E=this instanceof e;if(!E&&!L.call(j,this))return new j(_);this._writableState=new T(_,this,E),this.writable=!0,_&&(typeof _.write=="function"&&(this._write=_.write),typeof _.writev=="function"&&(this._writev=_.writev),typeof _.destroy=="function"&&(this._destroy=_.destroy),typeof _.final=="function"&&(this._final=_.final)),n.call(this)}j.prototype.pipe=function(){b(this,new v)};function M(_,E){var C=new A;b(_,C),r.nextTick(E,C)}function I(_,E,C,k){var $;return C===null?$=new x:typeof C!="string"&&!E.objectMode&&($=new m("chunk",["string","Buffer"],C)),$?(b(_,$),r.nextTick(k,$),!1):!0}j.prototype.write=function(_,E,C){var k=this._writableState,$=!1,d=!k.objectMode&&l(_);return d&&!s.isBuffer(_)&&(_=o(_)),typeof E=="function"&&(C=E,E=null),d?E="buffer":E||(E=k.defaultEncoding),typeof C!="function"&&(C=R),k.ending?M(this,C):(d||I(this,k,_,C))&&(k.pendingcb++,$=Pt(this,k,d,_,E,C)),$},j.prototype.cork=function(){this._writableState.corked++},j.prototype.uncork=function(){var _=this._writableState;_.corked&&(_.corked--,!_.writing&&!_.corked&&!_.bufferProcessing&&_.bufferedRequest&&kt(this,_))},j.prototype.setDefaultEncoding=function(E){if(typeof E=="string"&&(E=E.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((E+"").toLowerCase())>-1))throw new w(E);return this._writableState.defaultEncoding=E,this},Object.defineProperty(j.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function nt(_,E,C){return!_.objectMode&&_.decodeStrings!==!1&&typeof E=="string"&&(E=s.from(E,C)),E}Object.defineProperty(j.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Pt(_,E,C,k,$,d){if(!C){var p=nt(E,k,$);k!==p&&(C=!0,$="buffer",k=p)}var O=E.objectMode?1:k.length;E.length+=O;var P=E.length<E.highWaterMark;if(P||(E.needDrain=!0),E.writing||E.corked){var W=E.lastBufferedRequest;E.lastBufferedRequest={chunk:k,encoding:$,isBuf:C,callback:d,next:null},W?W.next=E.lastBufferedRequest:E.bufferedRequest=E.lastBufferedRequest,E.bufferedRequestCount+=1}else vt(_,E,!1,O,k,$,d);return P}function vt(_,E,C,k,$,d,p){E.writelen=k,E.writecb=p,E.writing=!0,E.sync=!0,E.destroyed?E.onwrite(new S("write")):C?_._writev($,E.onwrite):_._write($,d,E.onwrite),E.sync=!1}function ri(_,E,C,k,$){--E.pendingcb,C?(r.nextTick($,k),r.nextTick(Tt,_,E),_._writableState.errorEmitted=!0,b(_,k)):($(k),_._writableState.errorEmitted=!0,b(_,k),Tt(_,E))}function we(_){_.writing=!1,_.writecb=null,_.length-=_.writelen,_.writelen=0}function ni(_,E){var C=_._writableState,k=C.sync,$=C.writecb;if(typeof $!="function")throw new g;if(we(C),E)ri(_,C,k,E,$);else{var d=ve(C)||_.destroyed;!d&&!C.corked&&!C.bufferProcessing&&C.bufferedRequest&&kt(_,C),k?r.nextTick(xt,_,C,d,$):xt(_,C,d,$)}}function xt(_,E,C,k){C||ye(_,E),E.pendingcb--,k(),Tt(_,E)}function ye(_,E){E.length===0&&E.needDrain&&(E.needDrain=!1,_.emit("drain"))}function kt(_,E){E.bufferProcessing=!0;var C=E.bufferedRequest;if(_._writev&&C&&C.next){var k=E.bufferedRequestCount,$=new Array(k),d=E.corkedRequestsFree;d.entry=C;for(var p=0,O=!0;C;)$[p]=C,C.isBuf||(O=!1),C=C.next,p+=1;$.allBuffers=O,vt(_,E,!0,E.length,$,"",d.finish),E.pendingcb++,E.lastBufferedRequest=null,d.next?(E.corkedRequestsFree=d.next,d.next=null):E.corkedRequestsFree=new t(E),E.bufferedRequestCount=0}else{for(;C;){var P=C.chunk,W=C.encoding,D=C.callback,N=E.objectMode?1:P.length;if(vt(_,E,!1,N,P,W,D),C=C.next,E.bufferedRequestCount--,E.writing)break}C===null&&(E.lastBufferedRequest=null)}E.bufferedRequest=C,E.bufferProcessing=!1}j.prototype._write=function(_,E,C){C(new y("_write()"))},j.prototype._writev=null,j.prototype.end=function(_,E,C){var k=this._writableState;return typeof _=="function"?(C=_,_=null,E=null):typeof E=="function"&&(C=E,E=null),_!=null&&this.write(_,E),k.corked&&(k.corked=1,this.uncork()),k.ending||oi(this,k,C),this},Object.defineProperty(j.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ve(_){return _.ending&&_.length===0&&_.bufferedRequest===null&&!_.finished&&!_.writing}function si(_,E){_._final(function(C){E.pendingcb--,C&&b(_,C),E.prefinished=!0,_.emit("prefinish"),Tt(_,E)})}function be(_,E){!E.prefinished&&!E.finalCalled&&(typeof _._final=="function"&&!E.destroyed?(E.pendingcb++,E.finalCalled=!0,r.nextTick(si,_,E)):(E.prefinished=!0,_.emit("prefinish")))}function Tt(_,E){var C=ve(E);if(C&&(be(_,E),E.pendingcb===0&&(E.finished=!0,_.emit("finish"),E.autoDestroy))){var k=_._readableState;(!k||k.autoDestroy&&k.endEmitted)&&_.destroy()}return C}function oi(_,E,C){E.ending=!0,Tt(_,E),C&&(E.finished?r.nextTick(C):_.once("finish",C)),E.ended=!0,_.writable=!1}function ai(_,E,C){var k=_.entry;for(_.entry=null;k;){var $=k.callback;E.pendingcb--,$(C),k=k.next}E.corkedRequestsFree.next=_}return Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(E){this._writableState&&(this._writableState.destroyed=E)}}),j.prototype.destroy=h.destroy,j.prototype._undestroy=h.undestroy,j.prototype._destroy=function(_,E){E(_)},bi}var Si,Pr;function Vt(){if(Pr)return Si;Pr=1;var r={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"},t=Object.keys||function(c){var f=[];for(var u in c)f.push(u);return f};Si=o;var e=Nn(),i=$n();Yt()(o,e);for(var n=t(i.prototype),s=0;s<n.length;s++){var a=n[s];o.prototype[a]||(o.prototype[a]=i.prototype[a])}function o(c){if(!(this instanceof o))return new o(c);e.call(this,c),i.call(this,c),this.allowHalfOpen=!0,c&&(c.readable===!1&&(this.readable=!1),c.writable===!1&&(this.writable=!1),c.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",l)))}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function l(){this._writableState.ended||r.nextTick(h,this)}function h(c){c.end()}return Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(f){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=f,this._writableState.destroyed=f)}}),Si}function nr(){}const ko={StringDecoder:nr},Do=Object.freeze(Object.defineProperty({__proto__:null,StringDecoder:nr,default:ko},Symbol.toStringTag,{value:"Module"})),kr=Qi(Do);var Ei,Dr;function sr(){if(Dr)return Ei;Dr=1;var r=Jt().codes.ERR_STREAM_PREMATURE_CLOSE;function t(s){var a=!1;return function(){if(!a){a=!0;for(var o=arguments.length,l=new Array(o),h=0;h<o;h++)l[h]=arguments[h];s.apply(this,l)}}}function e(){}function i(s){return s.setHeader&&typeof s.abort=="function"}function n(s,a,o){if(typeof a=="function")return n(s,null,a);a||(a={}),o=t(o||e);var l=a.readable||a.readable!==!1&&s.readable,h=a.writable||a.writable!==!1&&s.writable,c=function(){s.writable||u()},f=s._writableState&&s._writableState.finished,u=function(){h=!1,f=!0,l||o.call(s)},m=s._readableState&&s._readableState.endEmitted,y=function(){l=!1,m=!0,h||o.call(s)},g=function(A){o.call(s,A)},v=function(){var A;if(l&&!m)return(!s._readableState||!s._readableState.ended)&&(A=new r),o.call(s,A);if(h&&!f)return(!s._writableState||!s._writableState.ended)&&(A=new r),o.call(s,A)},S=function(){s.req.on("finish",u)};return i(s)?(s.on("complete",u),s.on("abort",v),s.req?S():s.on("request",S)):h&&!s._writableState&&(s.on("end",c),s.on("close",c)),s.on("end",y),s.on("finish",u),a.error!==!1&&s.on("error",g),s.on("close",v),function(){s.removeListener("complete",u),s.removeListener("abort",v),s.removeListener("request",S),s.req&&s.req.removeListener("finish",u),s.removeListener("end",c),s.removeListener("close",c),s.removeListener("finish",u),s.removeListener("end",y),s.removeListener("error",g),s.removeListener("close",v)}}return Ei=n,Ei}var _i,$r;function $o(){if($r)return _i;$r=1;var r={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"},t;function e(w,b,R){return b=i(b),b in w?Object.defineProperty(w,b,{value:R,enumerable:!0,configurable:!0,writable:!0}):w[b]=R,w}function i(w){var b=n(w,"string");return typeof b=="symbol"?b:String(b)}function n(w,b){if(typeof w!="object"||w===null)return w;var R=w[Symbol.toPrimitive];if(R!==void 0){var T=R.call(w,b);if(typeof T!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(w)}var s=sr(),a=Symbol("lastResolve"),o=Symbol("lastReject"),l=Symbol("error"),h=Symbol("ended"),c=Symbol("lastPromise"),f=Symbol("handlePromise"),u=Symbol("stream");function m(w,b){return{value:w,done:b}}function y(w){var b=w[a];if(b!==null){var R=w[u].read();R!==null&&(w[c]=null,w[a]=null,w[o]=null,b(m(R,!1)))}}function g(w){r.nextTick(y,w)}function v(w,b){return function(R,T){w.then(function(){if(b[h]){R(m(void 0,!0));return}b[f](R,T)},T)}}var S=Object.getPrototypeOf(function(){}),x=Object.setPrototypeOf((t={get stream(){return this[u]},next:function(){var b=this,R=this[l];if(R!==null)return Promise.reject(R);if(this[h])return Promise.resolve(m(void 0,!0));if(this[u].destroyed)return new Promise(function(M,I){r.nextTick(function(){b[l]?I(b[l]):M(m(void 0,!0))})});var T=this[c],L;if(T)L=new Promise(v(T,this));else{var j=this[u].read();if(j!==null)return Promise.resolve(m(j,!1));L=new Promise(this[f])}return this[c]=L,L}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var b=this;return new Promise(function(R,T){b[u].destroy(null,function(L){if(L){T(L);return}R(m(void 0,!0))})})}),t),S),A=function(b){var R,T=Object.create(x,(R={},e(R,u,{value:b,writable:!0}),e(R,a,{value:null,writable:!0}),e(R,o,{value:null,writable:!0}),e(R,l,{value:null,writable:!0}),e(R,h,{value:b._readableState.endEmitted,writable:!0}),e(R,f,{value:function(j,M){var I=T[u].read();I?(T[c]=null,T[a]=null,T[o]=null,j(m(I,!1))):(T[a]=j,T[o]=M)},writable:!0}),R));return T[c]=null,s(b,function(L){if(L&&L.code!=="ERR_STREAM_PREMATURE_CLOSE"){var j=T[o];j!==null&&(T[c]=null,T[a]=null,T[o]=null,j(L)),T[l]=L;return}var M=T[a];M!==null&&(T[c]=null,T[a]=null,T[o]=null,M(m(void 0,!0))),T[h]=!0}),b.on("readable",g.bind(null,T)),T};return _i=A,_i}var Ri,Nr;function No(){return Nr||(Nr=1,Ri=function(){throw new Error("Readable.from is not available in the browser")}),Ri}var xi,Fr;function Nn(){if(Fr)return xi;Fr=1;var r={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"};xi=M;var t;M.ReadableState=j,Ve().EventEmitter;var e=function(p,O){return p.listeners(O).length},i=jn(),n=rr.Buffer,s=(typeof Ht<"u"?Ht:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(d){return n.from(d)}function o(d){return n.isBuffer(d)||d instanceof s}var l=Pn,h;l&&l.debuglog?h=l.debuglog("stream"):h=function(){};var c=jo(),f=kn(),u=Dn(),m=u.getHighWaterMark,y=Jt().codes,g=y.ERR_INVALID_ARG_TYPE,v=y.ERR_STREAM_PUSH_AFTER_EOF,S=y.ERR_METHOD_NOT_IMPLEMENTED,x=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,A,w,b;Yt()(M,i);var R=f.errorOrDestroy,T=["error","close","destroy","pause","resume"];function L(d,p,O){if(typeof d.prependListener=="function")return d.prependListener(p,O);!d._events||!d._events[p]?d.on(p,O):Array.isArray(d._events[p])?d._events[p].unshift(O):d._events[p]=[O,d._events[p]]}function j(d,p,O){t=t||Vt(),d=d||{},typeof O!="boolean"&&(O=p instanceof t),this.objectMode=!!d.objectMode,O&&(this.objectMode=this.objectMode||!!d.readableObjectMode),this.highWaterMark=m(this,d,"readableHighWaterMark",O),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=d.emitClose!==!1,this.autoDestroy=!!d.autoDestroy,this.destroyed=!1,this.defaultEncoding=d.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,d.encoding&&(A||(A=kr.StringDecoder),this.decoder=new A(d.encoding),this.encoding=d.encoding)}function M(d){if(t=t||Vt(),!(this instanceof M))return new M(d);var p=this instanceof t;this._readableState=new j(d,this,p),this.readable=!0,d&&(typeof d.read=="function"&&(this._read=d.read),typeof d.destroy=="function"&&(this._destroy=d.destroy)),i.call(this)}Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(p){this._readableState&&(this._readableState.destroyed=p)}}),M.prototype.destroy=f.destroy,M.prototype._undestroy=f.undestroy,M.prototype._destroy=function(d,p){p(d)},M.prototype.push=function(d,p){var O=this._readableState,P;return O.objectMode?P=!0:typeof d=="string"&&(p=p||O.defaultEncoding,p!==O.encoding&&(d=n.from(d,p),p=""),P=!0),I(this,d,p,!1,P)},M.prototype.unshift=function(d){return I(this,d,null,!0,!1)};function I(d,p,O,P,W){h("readableAddChunk",p);var D=d._readableState;if(p===null)D.reading=!1,ni(d,D);else{var N;if(W||(N=Pt(D,p)),N)R(d,N);else if(D.objectMode||p&&p.length>0)if(typeof p!="string"&&!D.objectMode&&Object.getPrototypeOf(p)!==n.prototype&&(p=a(p)),P)D.endEmitted?R(d,new x):nt(d,D,p,!0);else if(D.ended)R(d,new v);else{if(D.destroyed)return!1;D.reading=!1,D.decoder&&!O?(p=D.decoder.write(p),D.objectMode||p.length!==0?nt(d,D,p,!1):kt(d,D)):nt(d,D,p,!1)}else P||(D.reading=!1,kt(d,D))}return!D.ended&&(D.length<D.highWaterMark||D.length===0)}function nt(d,p,O,P){p.flowing&&p.length===0&&!p.sync?(p.awaitDrain=0,d.emit("data",O)):(p.length+=p.objectMode?1:O.length,P?p.buffer.unshift(O):p.buffer.push(O),p.needReadable&&xt(d)),kt(d,p)}function Pt(d,p){var O;return!o(p)&&typeof p!="string"&&p!==void 0&&!d.objectMode&&(O=new g("chunk",["string","Buffer","Uint8Array"],p)),O}M.prototype.isPaused=function(){return this._readableState.flowing===!1},M.prototype.setEncoding=function(d){A||(A=kr.StringDecoder);var p=new A(d);this._readableState.decoder=p,this._readableState.encoding=this._readableState.decoder.encoding;for(var O=this._readableState.buffer.head,P="";O!==null;)P+=p.write(O.data),O=O.next;return this._readableState.buffer.clear(),P!==""&&this._readableState.buffer.push(P),this._readableState.length=P.length,this};var vt=1073741824;function ri(d){return d>=vt?d=vt:(d--,d|=d>>>1,d|=d>>>2,d|=d>>>4,d|=d>>>8,d|=d>>>16,d++),d}function we(d,p){return d<=0||p.length===0&&p.ended?0:p.objectMode?1:d!==d?p.flowing&&p.length?p.buffer.head.data.length:p.length:(d>p.highWaterMark&&(p.highWaterMark=ri(d)),d<=p.length?d:p.ended?p.length:(p.needReadable=!0,0))}M.prototype.read=function(d){h("read",d),d=parseInt(d,10);var p=this._readableState,O=d;if(d!==0&&(p.emittedReadable=!1),d===0&&p.needReadable&&((p.highWaterMark!==0?p.length>=p.highWaterMark:p.length>0)||p.ended))return h("read: emitReadable",p.length,p.ended),p.length===0&&p.ended?C(this):xt(this),null;if(d=we(d,p),d===0&&p.ended)return p.length===0&&C(this),null;var P=p.needReadable;h("need readable",P),(p.length===0||p.length-d<p.highWaterMark)&&(P=!0,h("length less than watermark",P)),p.ended||p.reading?(P=!1,h("reading or ended",P)):P&&(h("do read"),p.reading=!0,p.sync=!0,p.length===0&&(p.needReadable=!0),this._read(p.highWaterMark),p.sync=!1,p.reading||(d=we(O,p)));var W;return d>0?W=E(d,p):W=null,W===null?(p.needReadable=p.length<=p.highWaterMark,d=0):(p.length-=d,p.awaitDrain=0),p.length===0&&(p.ended||(p.needReadable=!0),O!==d&&p.ended&&C(this)),W!==null&&this.emit("data",W),W};function ni(d,p){if(h("onEofChunk"),!p.ended){if(p.decoder){var O=p.decoder.end();O&&O.length&&(p.buffer.push(O),p.length+=p.objectMode?1:O.length)}p.ended=!0,p.sync?xt(d):(p.needReadable=!1,p.emittedReadable||(p.emittedReadable=!0,ye(d)))}}function xt(d){var p=d._readableState;h("emitReadable",p.needReadable,p.emittedReadable),p.needReadable=!1,p.emittedReadable||(h("emitReadable",p.flowing),p.emittedReadable=!0,r.nextTick(ye,d))}function ye(d){var p=d._readableState;h("emitReadable_",p.destroyed,p.length,p.ended),!p.destroyed&&(p.length||p.ended)&&(d.emit("readable"),p.emittedReadable=!1),p.needReadable=!p.flowing&&!p.ended&&p.length<=p.highWaterMark,_(d)}function kt(d,p){p.readingMore||(p.readingMore=!0,r.nextTick(ve,d,p))}function ve(d,p){for(;!p.reading&&!p.ended&&(p.length<p.highWaterMark||p.flowing&&p.length===0);){var O=p.length;if(h("maybeReadMore read 0"),d.read(0),O===p.length)break}p.readingMore=!1}M.prototype._read=function(d){R(this,new S("_read()"))},M.prototype.pipe=function(d,p){var O=this,P=this._readableState;switch(P.pipesCount){case 0:P.pipes=d;break;case 1:P.pipes=[P.pipes,d];break;default:P.pipes.push(d);break}P.pipesCount+=1,h("pipe count=%d opts=%j",P.pipesCount,p);var W=(!p||p.end!==!1)&&d!==r.stdout&&d!==r.stderr,D=W?Dt:Zt;P.endEmitted?r.nextTick(D):O.once("end",D),d.on("unpipe",N);function N($t,Nt){h("onunpipe"),$t===O&&Nt&&Nt.hasUnpiped===!1&&(Nt.hasUnpiped=!0,Rs())}function Dt(){h("onend"),d.end()}var Se=si(O);d.on("drain",Se);var pr=!1;function Rs(){h("cleanup"),d.removeListener("close",hi),d.removeListener("finish",ci),d.removeListener("drain",Se),d.removeListener("error",li),d.removeListener("unpipe",N),O.removeListener("end",Dt),O.removeListener("end",Zt),O.removeListener("data",mr),pr=!0,P.awaitDrain&&(!d._writableState||d._writableState.needDrain)&&Se()}O.on("data",mr);function mr($t){h("ondata");var Nt=d.write($t);h("dest.write",Nt),Nt===!1&&((P.pipesCount===1&&P.pipes===d||P.pipesCount>1&&$(P.pipes,d)!==-1)&&!pr&&(h("false write response, pause",P.awaitDrain),P.awaitDrain++),O.pause())}function li($t){h("onerror",$t),Zt(),d.removeListener("error",li),e(d,"error")===0&&R(d,$t)}L(d,"error",li);function hi(){d.removeListener("finish",ci),Zt()}d.once("close",hi);function ci(){h("onfinish"),d.removeListener("close",hi),Zt()}d.once("finish",ci);function Zt(){h("unpipe"),O.unpipe(d)}return d.emit("pipe",O),P.flowing||(h("pipe resume"),O.resume()),d};function si(d){return function(){var O=d._readableState;h("pipeOnDrain",O.awaitDrain),O.awaitDrain&&O.awaitDrain--,O.awaitDrain===0&&e(d,"data")&&(O.flowing=!0,_(d))}}M.prototype.unpipe=function(d){var p=this._readableState,O={hasUnpiped:!1};if(p.pipesCount===0)return this;if(p.pipesCount===1)return d&&d!==p.pipes?this:(d||(d=p.pipes),p.pipes=null,p.pipesCount=0,p.flowing=!1,d&&d.emit("unpipe",this,O),this);if(!d){var P=p.pipes,W=p.pipesCount;p.pipes=null,p.pipesCount=0,p.flowing=!1;for(var D=0;D<W;D++)P[D].emit("unpipe",this,{hasUnpiped:!1});return this}var N=$(p.pipes,d);return N===-1?this:(p.pipes.splice(N,1),p.pipesCount-=1,p.pipesCount===1&&(p.pipes=p.pipes[0]),d.emit("unpipe",this,O),this)},M.prototype.on=function(d,p){var O=i.prototype.on.call(this,d,p),P=this._readableState;return d==="data"?(P.readableListening=this.listenerCount("readable")>0,P.flowing!==!1&&this.resume()):d==="readable"&&!P.endEmitted&&!P.readableListening&&(P.readableListening=P.needReadable=!0,P.flowing=!1,P.emittedReadable=!1,h("on readable",P.length,P.reading),P.length?xt(this):P.reading||r.nextTick(Tt,this)),O},M.prototype.addListener=M.prototype.on,M.prototype.removeListener=function(d,p){var O=i.prototype.removeListener.call(this,d,p);return d==="readable"&&r.nextTick(be,this),O},M.prototype.removeAllListeners=function(d){var p=i.prototype.removeAllListeners.apply(this,arguments);return(d==="readable"||d===void 0)&&r.nextTick(be,this),p};function be(d){var p=d._readableState;p.readableListening=d.listenerCount("readable")>0,p.resumeScheduled&&!p.paused?p.flowing=!0:d.listenerCount("data")>0&&d.resume()}function Tt(d){h("readable nexttick read 0"),d.read(0)}M.prototype.resume=function(){var d=this._readableState;return d.flowing||(h("resume"),d.flowing=!d.readableListening,oi(this,d)),d.paused=!1,this};function oi(d,p){p.resumeScheduled||(p.resumeScheduled=!0,r.nextTick(ai,d,p))}function ai(d,p){h("resume",p.reading),p.reading||d.read(0),p.resumeScheduled=!1,d.emit("resume"),_(d),p.flowing&&!p.reading&&d.read(0)}M.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _(d){var p=d._readableState;for(h("flow",p.flowing);p.flowing&&d.read()!==null;);}M.prototype.wrap=function(d){var p=this,O=this._readableState,P=!1;d.on("end",function(){if(h("wrapped end"),O.decoder&&!O.ended){var N=O.decoder.end();N&&N.length&&p.push(N)}p.push(null)}),d.on("data",function(N){if(h("wrapped data"),O.decoder&&(N=O.decoder.write(N)),!(O.objectMode&&N==null)&&!(!O.objectMode&&(!N||!N.length))){var Dt=p.push(N);Dt||(P=!0,d.pause())}});for(var W in d)this[W]===void 0&&typeof d[W]=="function"&&(this[W]=(function(Dt){return function(){return d[Dt].apply(d,arguments)}})(W));for(var D=0;D<T.length;D++)d.on(T[D],this.emit.bind(this,T[D]));return this._read=function(N){h("wrapped _read",N),P&&(P=!1,d.resume())},this},typeof Symbol=="function"&&(M.prototype[Symbol.asyncIterator]=function(){return w===void 0&&(w=$o()),w(this)}),Object.defineProperty(M.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(M.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(M.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(p){this._readableState&&(this._readableState.flowing=p)}}),M._fromList=E,Object.defineProperty(M.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function E(d,p){if(p.length===0)return null;var O;return p.objectMode?O=p.buffer.shift():!d||d>=p.length?(p.decoder?O=p.buffer.join(""):p.buffer.length===1?O=p.buffer.first():O=p.buffer.concat(p.length),p.buffer.clear()):O=p.buffer.consume(d,p.decoder),O}function C(d){var p=d._readableState;h("endReadable",p.endEmitted),p.endEmitted||(p.ended=!0,r.nextTick(k,p,d))}function k(d,p){if(h("endReadableNT",d.endEmitted,d.length),!d.endEmitted&&d.length===0&&(d.endEmitted=!0,p.readable=!1,p.emit("end"),d.autoDestroy)){var O=p._writableState;(!O||O.autoDestroy&&O.finished)&&p.destroy()}}typeof Symbol=="function"&&(M.from=function(d,p){return b===void 0&&(b=No()),b(M,d,p)});function $(d,p){for(var O=0,P=d.length;O<P;O++)if(d[O]===p)return O;return-1}return xi}var Ti,Ir;function Fn(){if(Ir)return Ti;Ir=1,Ti=o;var r=Jt().codes,t=r.ERR_METHOD_NOT_IMPLEMENTED,e=r.ERR_MULTIPLE_CALLBACK,i=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,n=r.ERR_TRANSFORM_WITH_LENGTH_0,s=Vt();Yt()(o,s);function a(c,f){var u=this._transformState;u.transforming=!1;var m=u.writecb;if(m===null)return this.emit("error",new e);u.writechunk=null,u.writecb=null,f!=null&&this.push(f),m(c);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}function o(c){if(!(this instanceof o))return new o(c);s.call(this,c),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,c&&(typeof c.transform=="function"&&(this._transform=c.transform),typeof c.flush=="function"&&(this._flush=c.flush)),this.on("prefinish",l)}function l(){var c=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(f,u){h(c,f,u)}):h(this,null,null)}o.prototype.push=function(c,f){return this._transformState.needTransform=!1,s.prototype.push.call(this,c,f)},o.prototype._transform=function(c,f,u){u(new t("_transform()"))},o.prototype._write=function(c,f,u){var m=this._transformState;if(m.writecb=u,m.writechunk=c,m.writeencoding=f,!m.transforming){var y=this._readableState;(m.needTransform||y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}},o.prototype._read=function(c){var f=this._transformState;f.writechunk!==null&&!f.transforming?(f.transforming=!0,this._transform(f.writechunk,f.writeencoding,f.afterTransform)):f.needTransform=!0},o.prototype._destroy=function(c,f){s.prototype._destroy.call(this,c,function(u){f(u)})};function h(c,f,u){if(f)return c.emit("error",f);if(u!=null&&c.push(u),c._writableState.length)throw new n;if(c._transformState.transforming)throw new i;return c.push(null)}return Ti}var Oi,Wr;function Fo(){if(Wr)return Oi;Wr=1,Oi=t;var r=Fn();Yt()(t,r);function t(e){if(!(this instanceof t))return new t(e);r.call(this,e)}return t.prototype._transform=function(e,i,n){n(null,e)},Oi}var Ai,Br;function Io(){if(Br)return Ai;Br=1;var r;function t(u){var m=!1;return function(){m||(m=!0,u.apply(void 0,arguments))}}var e=Jt().codes,i=e.ERR_MISSING_ARGS,n=e.ERR_STREAM_DESTROYED;function s(u){if(u)throw u}function a(u){return u.setHeader&&typeof u.abort=="function"}function o(u,m,y,g){g=t(g);var v=!1;u.on("close",function(){v=!0}),r===void 0&&(r=sr()),r(u,{readable:m,writable:y},function(x){if(x)return g(x);v=!0,g()});var S=!1;return function(x){if(!v&&!S){if(S=!0,a(u))return u.abort();if(typeof u.destroy=="function")return u.destroy();g(x||new n("pipe"))}}}function l(u){u()}function h(u,m){return u.pipe(m)}function c(u){return!u.length||typeof u[u.length-1]!="function"?s:u.pop()}function f(){for(var u=arguments.length,m=new Array(u),y=0;y<u;y++)m[y]=arguments[y];var g=c(m);if(Array.isArray(m[0])&&(m=m[0]),m.length<2)throw new i("streams");var v,S=m.map(function(x,A){var w=A<m.length-1,b=A>0;return o(x,w,b,function(R){v||(v=R),R&&S.forEach(l),!w&&(S.forEach(l),g(v))})});return m.reduce(h)}return Ai=f,Ai}var Mi,qr;function Wo(){if(qr)return Mi;qr=1,Mi=e;var r=Ve().EventEmitter,t=Yt();t(e,r),e.Readable=Nn(),e.Writable=$n(),e.Duplex=Vt(),e.Transform=Fn(),e.PassThrough=Fo(),e.finished=sr(),e.pipeline=Io(),e.Stream=e;function e(){r.call(this)}return e.prototype.pipe=function(i,n){var s=this;function a(m){i.writable&&i.write(m)===!1&&s.pause&&s.pause()}s.on("data",a);function o(){s.readable&&s.resume&&s.resume()}i.on("drain",o),!i._isStdio&&(!n||n.end!==!1)&&(s.on("end",h),s.on("close",c));var l=!1;function h(){l||(l=!0,i.end())}function c(){l||(l=!0,typeof i.destroy=="function"&&i.destroy())}function f(m){if(u(),r.listenerCount(this,"error")===0)throw m}s.on("error",f),i.on("error",f);function u(){s.removeListener("data",a),i.removeListener("drain",o),s.removeListener("end",h),s.removeListener("close",c),s.removeListener("error",f),i.removeListener("error",f),s.removeListener("end",u),s.removeListener("close",u),i.removeListener("close",u)}return s.on("end",u),s.on("close",u),i.on("close",u),i.emit("pipe",s),i},Mi}var Bo=Wo();const In=Zs(Bo);function qo(){return{enable(){}}}class Uo{stack=[];run(t,e){this.stack.unshift(t);let i=!1;try{const n=e();return typeof n?.then=="function"?(i=!0,n.finally(()=>{this.stack.shift()})):n}finally{i||this.stack.shift()}}getStore(){return this.stack[0]}}const Yi=new Map;new FinalizationRegistry(r=>{const t=Yi.get(r);t&&(t.resolution=void 0),Yi.delete(r)});let zo;const Go=qo();function Ho(){Yi.delete(zo)}function Vo(r){if(Wn===0){const e=Promise.resolve().then(()=>r());return e.catch(()=>{}),e}let t;return(t=Ko(r)).catch(()=>{}),t}async function Ko(r){return await null,Ho(),await null,r()}let Wn=0;new FinalizationRegistry(r=>{--Wn==0&&Go.disable(),Yo(r)});const Ci={};Ci.next=Ci.prev=Ci;function Yo(r){r.prev.next=r.next,r.next.prev=r.prev,r.next=r.prev=r}Promise.all=(r=>async(...[t])=>{Bn(t);for(const e of t)try{await e}catch{}return r.call(Promise,t)})(Promise.all);Promise.allSettled=(r=>async(...[t])=>{Bn(t);for(const e of t)try{await e}catch{}return r.call(Promise,t)})(Promise.allSettled);function Bn(r){for(const t of r)typeof t?.then=="function"&&t?.then?.(()=>{},()=>{})}var F={env:{},versions:{node:"22.16.0",acorn:"8.14.1",ada:"2.9.2",amaro:"0.4.1",ares:"1.34.5",brotli:"1.1.0",cjs_module_lexer:"2.1.0",cldr:"47.0",icu:"77.1",llhttp:"9.2.1",modules:"127",napi:"10",nbytes:"0.1.1",ncrypto:"0.0.1",nghttp2:"1.64.0",openssl:"3.0.16",simdjson:"3.12.2",simdutf:"6.4.2",sqlite:"3.49.1",tz:"2025b",undici:"6.21.2",unicode:"16.0",uv:"1.49.2",uvwasi:"0.0.21",v8:"12.4.254.21-node.26",zlib:"1.3.0.1-motley-780819f",zstd:"1.5.7"},version:"v1.0.0"},Li={},Jo=Object.defineProperty,Zo=(r,t,e)=>t in r?Jo(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Xo=(r,t,e)=>Zo(r,t+"",e);function Qo(r){function t(i,n){return r[i](n).catch(s=>{const a=new ta({cause:s,step:i,info:n});throw r.error(a,n),a})}function e(i){let n,s,a,o,l,h,c;function f(y,g){return Object.defineProperties(zi(y),ht(Object.getOwnPropertyDescriptors(g),v=>({...v,enumerable:!1,configurable:!1})))}return n??(n=f(Promise.resolve(r.init(i)),{get context(){return n},get match(){return u()},get preview(){return u().preview},get egress(){return u().egress},get ingress(){return u().egress.ingress},get result(){return u().egress.ingress.result},reprocess:m}));function u(){return s??(s=f(n.then(v=>t("match",{context:v})),{context:n,get match(){return s},get preview(){return y()},get egress(){return g()},get ingress(){return g().ingress},get result(){return g().ingress.result},reprocess:m}));function y(){return a??(a=f(Promise.all([n,s]).then(([v,S])=>t("preview",{context:v,match:S})),{context:n,match:s,preview:a,get egress(){return g()},get ingress(){return g().ingress},get result(){return g().ingress.result},reprocess:m}))}function g(){return o??(o=f(Promise.all([n,s]).then(([S,x])=>t("render",{context:S,match:x})),{context:n,match:s,get preview(){return y()},get egress(){return o},get ingress(){return v()},get result(){return v().result},reprocess:m}));function v(){return l??(l=Promise.all([n,s,o]).then(([x,A,w])=>t("fetch",{context:x,match:A,egress:w}))),h??(h=f(l.then(async x=>(await S(),x)),{context:n,match:s,get preview(){return y()},egress:o,get ingress(){return h},get result(){return S()},reprocess:m}));function S(){return c??(c=f(Promise.all([n,s,o]).then(([x,A,w])=>{const b={context:x,match:A,egress:w};return l.then(R=>t("process",{...b,ingress:R}),R=>t("process",{...b,error:R}))}),{context:n,match:s,get preview(){return y()},egress:o,ingress:h,get result(){return c},reprocess:m}))}}}}async function m(y){const g={...await n,...y},v=await t("match",{context:g}),S=await n.egress,x=await n.ingress;return t("process",{context:g,match:v,egress:S,ingress:x})}}return{executor:r,init(i){return e(i)},match(i){return e(i).match},preview(i){return e(i).preview},render(i){return e(i).egress},fetch(i){return e(i).ingress},process(i){return e(i).result}}}class ta extends Error{constructor({cause:t,step:e,info:i}){super(i?.match?.endpoint?.configuration?.path?`${i?.match?.endpoint?.configuration?.path} (${e})`:`failed at (${e})`,{cause:t}),Xo(this,"step"),this.step=e}get formatted(){let t=this;const e=[];for(;t?.cause!==void 0;)t=t.cause,e.unshift(String(t?.message??t));return e.unshift(String(this?.message??this)),e.join(`
 -- `)}}const qn=(r,t,e)=>{const i=r instanceof RegExp?Ur(r,e):r,n=t instanceof RegExp?Ur(t,e):t,s=i!==null&&n!=null&&ea(i,n,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+i.length,s[1]),post:e.slice(s[1]+n.length)}},Ur=(r,t)=>{const e=t.match(r);return e?e[0]:null},ea=(r,t,e)=>{let i,n,s,a,o,l=e.indexOf(r),h=e.indexOf(t,l+1),c=l;if(l>=0&&h>0){if(r===t)return[l,h];for(i=[],s=e.length;c>=0&&!o;){if(c===l)i.push(c),l=e.indexOf(r,c+1);else if(i.length===1){const f=i.pop();f!==void 0&&(o=[f,h])}else n=i.pop(),n!==void 0&&n<s&&(s=n,a=h),h=e.indexOf(t,c+1);c=l<h&&l>=0?l:h}i.length&&a!==void 0&&(o=[s,a])}return o},Un="\0SLASH"+Math.random()+"\0",zn="\0OPEN"+Math.random()+"\0",or="\0CLOSE"+Math.random()+"\0",Gn="\0COMMA"+Math.random()+"\0",Hn="\0PERIOD"+Math.random()+"\0",ia=new RegExp(Un,"g"),ra=new RegExp(zn,"g"),na=new RegExp(or,"g"),sa=new RegExp(Gn,"g"),oa=new RegExp(Hn,"g"),aa=/\\\\/g,la=/\\{/g,ha=/\\}/g,ca=/\\,/g,ua=/\\./g;function ji(r){return isNaN(r)?r.charCodeAt(0):parseInt(r,10)}function fa(r){return r.replace(aa,Un).replace(la,zn).replace(ha,or).replace(ca,Gn).replace(ua,Hn)}function da(r){return r.replace(ia,"\\").replace(ra,"{").replace(na,"}").replace(sa,",").replace(oa,".")}function Vn(r){if(!r)return[""];const t=[],e=qn("{","}",r);if(!e)return r.split(",");const{pre:i,body:n,post:s}=e,a=i.split(",");a[a.length-1]+="{"+n+"}";const o=Vn(s);return s.length&&(a[a.length-1]+=o.shift(),a.push.apply(a,o)),t.push.apply(t,a),t}function pa(r){return r?(r.slice(0,2)==="{}"&&(r="\\{\\}"+r.slice(2)),se(fa(r),!0).map(da)):[]}function ma(r){return"{"+r+"}"}function ga(r){return/^-?0\d/.test(r)}function wa(r,t){return r<=t}function ya(r,t){return r>=t}function se(r,t){const e=[],i=qn("{","}",r);if(!i)return[r];const n=i.pre,s=i.post.length?se(i.post,!1):[""];if(/\$$/.test(i.pre))for(let a=0;a<s.length;a++){const o=n+"{"+i.body+"}"+s[a];e.push(o)}else{const a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),l=a||o,h=i.body.indexOf(",")>=0;if(!l&&!h)return i.post.match(/,(?!,).*\}/)?(r=i.pre+"{"+i.body+or+i.post,se(r)):[r];let c;if(l)c=i.body.split(/\.\./);else if(c=Vn(i.body),c.length===1&&c[0]!==void 0&&(c=se(c[0],!1).map(ma),c.length===1))return s.map(u=>i.pre+c[0]+u);let f;if(l&&c[0]!==void 0&&c[1]!==void 0){const u=ji(c[0]),m=ji(c[1]),y=Math.max(c[0].length,c[1].length);let g=c.length===3&&c[2]!==void 0?Math.abs(ji(c[2])):1,v=wa;m<u&&(g*=-1,v=ya);const x=c.some(ga);f=[];for(let A=u;v(A,m);A+=g){let w;if(o)w=String.fromCharCode(A),w==="\\"&&(w="");else if(w=String(A),x){const b=y-w.length;if(b>0){const R=new Array(b+1).join("0");A<0?w="-"+R+w.slice(1):w=R+w}}f.push(w)}}else{f=[];for(let u=0;u<c.length;u++)f.push.apply(f,se(c[u],!1))}for(let u=0;u<f.length;u++)for(let m=0;m<s.length;m++){const y=n+f[u]+s[m];(!t||l||y)&&e.push(y)}}return e}const va=1024*64,Ie=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>va)throw new TypeError("pattern is too long")},ba={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Xt=r=>r.replace(/[[\]\\-]/g,"\\$&"),Sa=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),zr=r=>r.join(""),Ea=(r,t)=>{const e=t;if(r.charAt(e)!=="[")throw new Error("not in a brace expression");const i=[],n=[];let s=e+1,a=!1,o=!1,l=!1,h=!1,c=e,f="";t:for(;s<r.length;){const g=r.charAt(s);if((g==="!"||g==="^")&&s===e+1){h=!0,s++;continue}if(g==="]"&&a&&!l){c=s+1;break}if(a=!0,g==="\\"&&!l){l=!0,s++;continue}if(g==="["&&!l){for(const[v,[S,x,A]]of Object.entries(ba))if(r.startsWith(v,s)){if(f)return["$.",!1,r.length-e,!0];s+=v.length,A?n.push(S):i.push(S),o=o||x;continue t}}if(l=!1,f){g>f?i.push(Xt(f)+"-"+Xt(g)):g===f&&i.push(Xt(g)),f="",s++;continue}if(r.startsWith("-]",s+1)){i.push(Xt(g+"-")),s+=2;continue}if(r.startsWith("-",s+1)){f=g,s+=2;continue}i.push(Xt(g)),s++}if(c<s)return["",!1,0,!1];if(!i.length&&!n.length)return["$.",!1,r.length-e,!0];if(n.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!h){const g=i[0].length===2?i[0].slice(-1):i[0];return[Sa(g),!1,c-e,!1]}const u="["+(h?"^":"")+zr(i)+"]",m="["+(h?"":"^")+zr(n)+"]";return[i.length&&n.length?"("+u+"|"+m+")":i.length?u:m,o,c-e,!0]},qt=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),_a=new Set(["!","?","+","*","@"]),Gr=r=>_a.has(r),Ra="(?!(?:^|/)\\.\\.?(?:$|/))",Re="(?!\\.)",xa=new Set(["[","."]),Ta=new Set(["..","."]),Oa=new Set("().*{}+?[]^$\\!"),Aa=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ar="[^/]",Hr=ar+"*?",Vr=ar+"+?";class Y{type;#t;#e;#s=!1;#n=[];#o;#b;#y;#c=!1;#a;#f;#u=!1;constructor(t,e,i={}){this.type=t,t&&(this.#e=!0),this.#o=e,this.#t=this.#o?this.#o.#t:this,this.#a=this.#t===this?i:this.#t.#a,this.#y=this.#t===this?[]:this.#t.#y,t==="!"&&!this.#t.#c&&this.#y.push(this),this.#b=this.#o?this.#o.#n.length:0}get hasMagic(){if(this.#e!==void 0)return this.#e;for(const t of this.#n)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return this.#f!==void 0?this.#f:this.type?this.#f=this.type+"("+this.#n.map(t=>String(t)).join("|")+")":this.#f=this.#n.map(t=>String(t)).join("")}#l(){if(this!==this.#t)throw new Error("should only call on root");if(this.#c)return this;this.toString(),this.#c=!0;let t;for(;t=this.#y.pop();){if(t.type!=="!")continue;let e=t,i=e.#o;for(;i;){for(let n=e.#b+1;!i.type&&n<i.#n.length;n++)for(const s of t.#n){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(i.#n[n])}e=i,i=e.#o}}return this}push(...t){for(const e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof Y&&e.#o===this))throw new Error("invalid part: "+e);this.#n.push(e)}}toJSON(){const t=this.type===null?this.#n.slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...this.#n.map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#c&&this.#o?.type==="!")&&t.push({}),t}isStart(){if(this.#t===this)return!0;if(!this.#o?.isStart())return!1;if(this.#b===0)return!0;const t=this.#o;for(let e=0;e<this.#b;e++){const i=t.#n[e];if(!(i instanceof Y&&i.type==="!"))return!1}return!0}isEnd(){if(this.#t===this||this.#o?.type==="!")return!0;if(!this.#o?.isEnd())return!1;if(!this.type)return this.#o?.isEnd();const t=this.#o?this.#o.#n.length:0;return this.#b===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const e=new Y(this.type,t);for(const i of this.#n)e.copyIn(i);return e}static#i(t,e,i,n){let s=!1,a=!1,o=-1,l=!1;if(e.type===null){let m=i,y="";for(;m<t.length;){const g=t.charAt(m++);if(s||g==="\\"){s=!s,y+=g;continue}if(a){m===o+1?(g==="^"||g==="!")&&(l=!0):g==="]"&&!(m===o+2&&l)&&(a=!1),y+=g;continue}else if(g==="["){a=!0,o=m,l=!1,y+=g;continue}if(!n.noext&&Gr(g)&&t.charAt(m)==="("){e.push(y),y="";const v=new Y(g,e);m=Y.#i(t,v,m,n),e.push(v);continue}y+=g}return e.push(y),m}let h=i+1,c=new Y(null,e);const f=[];let u="";for(;h<t.length;){const m=t.charAt(h++);if(s||m==="\\"){s=!s,u+=m;continue}if(a){h===o+1?(m==="^"||m==="!")&&(l=!0):m==="]"&&!(h===o+2&&l)&&(a=!1),u+=m;continue}else if(m==="["){a=!0,o=h,l=!1,u+=m;continue}if(Gr(m)&&t.charAt(h)==="("){c.push(u),u="";const y=new Y(m,c);c.push(y),h=Y.#i(t,y,h,n);continue}if(m==="|"){c.push(u),u="",f.push(c),c=new Y(null,e);continue}if(m===")")return u===""&&e.#n.length===0&&(e.#u=!0),c.push(u),u="",e.push(...f,c),h;u+=m}return e.type=null,e.#e=void 0,e.#n=[t.substring(i-1)],h}static fromGlob(t,e={}){const i=new Y(null,void 0,e);return Y.#i(t,i,0,e),i}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();const t=this.toString(),[e,i,n,s]=this.toRegExpSource();if(!(n||this.#e||this.#a.nocase&&!this.#a.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;const o=(this.#a.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${e}$`,o),{_src:e,_glob:t})}get options(){return this.#a}toRegExpSource(t){const e=t??!!this.#a.dot;if(this.#t===this&&this.#l(),!this.type){const l=this.isStart()&&this.isEnd(),h=this.#n.map(m=>{const[y,g,v,S]=typeof m=="string"?Y.#S(m,this.#e,l):m.toRegExpSource(t);return this.#e=this.#e||v,this.#s=this.#s||S,y}).join("");let c="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&Ta.has(this.#n[0]))){const y=xa,g=e&&y.has(h.charAt(0))||h.startsWith("\\.")&&y.has(h.charAt(2))||h.startsWith("\\.\\.")&&y.has(h.charAt(4)),v=!e&&!t&&y.has(h.charAt(0));c=g?Ra:v?Re:""}let f="";return this.isEnd()&&this.#t.#c&&this.#o?.type==="!"&&(f="(?:$|\\/)"),[c+h+f,qt(h),this.#e=!!this.#e,this.#s]}const i=this.type==="*"||this.type==="+",n=this.type==="!"?"(?:(?!(?:":"(?:";let s=this.#p(e);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){const l=this.toString();return this.#n=[l],this.type=null,this.#e=void 0,[l,qt(this.toString()),!1,!1]}let a=!i||t||e||!Re?"":this.#p(!0);a===s&&(a=""),a&&(s=`(?:${s})(?:${a})*?`);let o="";if(this.type==="!"&&this.#u)o=(this.isStart()&&!e?Re:"")+Vr;else{const l=this.type==="!"?"))"+(this.isStart()&&!e&&!t?Re:"")+Hr+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;o=n+s+l}return[o,qt(s),this.#e=!!this.#e,this.#s]}#p(t){return this.#n.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");const[i,n,s,a]=e.toRegExpSource(t);return this.#s=this.#s||a,i}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#S(t,e,i=!1){let n=!1,s="",a=!1;for(let o=0;o<t.length;o++){const l=t.charAt(o);if(n){n=!1,s+=(Oa.has(l)?"\\":"")+l;continue}if(l==="\\"){o===t.length-1?s+="\\\\":n=!0;continue}if(l==="["){const[h,c,f,u]=Ea(t,o);if(f){s+=h,a=a||c,o+=f-1,e=e||u;continue}}if(l==="*"){i&&t==="*"?s+=Vr:s+=Hr,e=!0;continue}if(l==="?"){s+=ar,e=!0;continue}s+=Aa(l)}return[s,qt(t),!!e,a]}}const Kn=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&"),Z=(r,t,e={})=>(Ie(t),!e.nocomment&&t.charAt(0)==="#"?!1:new Rt(t,e).match(r)),Ma=/^\*+([^+@!?\*\[\(]*)$/,Ca=r=>t=>!t.startsWith(".")&&t.endsWith(r),La=r=>t=>t.endsWith(r),ja=r=>(r=r.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(r)),Pa=r=>(r=r.toLowerCase(),t=>t.toLowerCase().endsWith(r)),ka=/^\*+\.\*+$/,Da=r=>!r.startsWith(".")&&r.includes("."),$a=r=>r!=="."&&r!==".."&&r.includes("."),Na=/^\.\*+$/,Fa=r=>r!=="."&&r!==".."&&r.startsWith("."),Ia=/^\*+$/,Wa=r=>r.length!==0&&!r.startsWith("."),Ba=r=>r.length!==0&&r!=="."&&r!=="..",qa=/^\?+([^+@!?\*\[\(]*)?$/,Ua=([r,t=""])=>{const e=Yn([r]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},za=([r,t=""])=>{const e=Jn([r]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},Ga=([r,t=""])=>{const e=Jn([r]);return t?i=>e(i)&&i.endsWith(t):e},Ha=([r,t=""])=>{const e=Yn([r]);return t?i=>e(i)&&i.endsWith(t):e},Yn=([r])=>{const t=r.length;return e=>e.length===t&&!e.startsWith(".")},Jn=([r])=>{const t=r.length;return e=>e.length===t&&e!=="."&&e!==".."},Zn=typeof F=="object"&&F?typeof Li=="object"&&Li&&Li.__MINIMATCH_TESTING_PLATFORM__||F.platform:"posix",Kr={win32:{sep:"\\"},posix:{sep:"/"}},Va=Zn==="win32"?Kr.win32.sep:Kr.posix.sep;Z.sep=Va;const J=Symbol("globstar **");Z.GLOBSTAR=J;const Ka="[^/]",Ya=Ka+"*?",Ja="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Za="(?:(?!(?:\\/|^)\\.).)*?",Xa=(r,t={})=>e=>Z(e,r,t);Z.filter=Xa;const et=(r,t={})=>Object.assign({},r,t),Qa=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return Z;const t=Z;return Object.assign((i,n,s={})=>t(i,n,et(r,s)),{Minimatch:class extends t.Minimatch{constructor(n,s={}){super(n,et(r,s))}static defaults(n){return t.defaults(et(r,n)).Minimatch}},AST:class extends t.AST{constructor(n,s,a={}){super(n,s,et(r,a))}static fromGlob(n,s={}){return t.AST.fromGlob(n,et(r,s))}},unescape:(i,n={})=>t.unescape(i,et(r,n)),escape:(i,n={})=>t.escape(i,et(r,n)),filter:(i,n={})=>t.filter(i,et(r,n)),defaults:i=>t.defaults(et(r,i)),makeRe:(i,n={})=>t.makeRe(i,et(r,n)),braceExpand:(i,n={})=>t.braceExpand(i,et(r,n)),match:(i,n,s={})=>t.match(i,n,et(r,s)),sep:t.sep,GLOBSTAR:J})};Z.defaults=Qa;const Xn=(r,t={})=>(Ie(r),t.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:pa(r));Z.braceExpand=Xn;const tl=(r,t={})=>new Rt(r,t).makeRe();Z.makeRe=tl;const el=(r,t,e={})=>{const i=new Rt(t,e);return r=r.filter(n=>i.match(n)),i.options.nonull&&!r.length&&r.push(t),r};Z.match=el;const Yr=/[?*]|[+@!]\(.*?\)|\[|\]/,il=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Rt{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){Ie(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||Zn,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const i=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let n=this.globParts.map((s,a,o)=>{if(this.isWindows&&this.windowsNoMagicRoot){const l=s[0]===""&&s[1]===""&&(s[2]==="?"||!Yr.test(s[2]))&&!Yr.test(s[3]),h=/^[a-z]:/i.test(s[0]);if(l)return[...s.slice(0,4),...s.slice(4).map(c=>this.parse(c))];if(h)return[s[0],...s.slice(1).map(c=>this.parse(c))]}return s.map(l=>this.parse(l))});if(this.debug(this.pattern,n),this.set=n.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let n=0;n<t[i].length;n++)t[i][n]==="**"&&(t[i][n]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let i=-1;for(;(i=e.indexOf("**",i+1))!==-1;){let n=i;for(;e[n+1]==="**";)n++;n!==i&&e.splice(i,n-i)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((i,n)=>{const s=i[i.length-1];return n==="**"&&s==="**"?i:n===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(i.pop(),i):(i.push(n),i)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let n=1;n<t.length-1;n++){const s=t[n];n===1&&s===""&&t[0]===""||(s==="."||s==="")&&(e=!0,t.splice(n,1),n--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let i=0;for(;(i=t.indexOf("..",i+1))!==-1;){const n=t[i-1];n&&n!=="."&&n!==".."&&n!=="**"&&(e=!0,t.splice(i-1,2),i-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let n=-1;for(;(n=i.indexOf("**",n+1))!==-1;){let a=n;for(;i[a+1]==="**";)a++;a>n&&i.splice(n+1,a-n);let o=i[n+1];const l=i[n+2],h=i[n+3];if(o!==".."||!l||l==="."||l===".."||!h||h==="."||h==="..")continue;e=!0,i.splice(n,1);const c=i.slice(0);c[n]="**",t.push(c),n--}if(!this.preserveMultipleSlashes){for(let a=1;a<i.length-1;a++){const o=i[a];a===1&&o===""&&i[0]===""||(o==="."||o==="")&&(e=!0,i.splice(a,1),a--)}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(e=!0,i.pop())}let s=0;for(;(s=i.indexOf("..",s+1))!==-1;){const a=i[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){e=!0;const l=s===1&&i[s+1]==="**"?["."]:[];i.splice(s-1,2,...l),i.length===0&&i.push(""),s-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){const n=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);if(n){t[e]=[],t[i]=n;break}}return t.filter(e=>e.length)}partsMatch(t,e,i=!1){let n=0,s=0,a=[],o="";for(;n<t.length&&s<e.length;)if(t[n]===e[s])a.push(o==="b"?e[s]:t[n]),n++,s++;else if(i&&t[n]==="**"&&e[s]===t[n+1])a.push(t[n]),n++;else if(i&&e[s]==="**"&&t[n]===e[s+1])a.push(e[s]),s++;else if(t[n]==="*"&&e[s]&&(this.options.dot||!e[s].startsWith("."))&&e[s]!=="**"){if(o==="b")return!1;o="a",a.push(t[n]),n++,s++}else if(e[s]==="*"&&t[n]&&(this.options.dot||!t[n].startsWith("."))&&t[n]!=="**"){if(o==="a")return!1;o="b",a.push(e[s]),n++,s++}else return!1;return t.length===e.length&&a}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,i=0;for(let n=0;n<t.length&&t.charAt(n)==="!";n++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e}matchOne(t,e,i=!1){const n=this.options;if(this.isWindows){const g=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),v=!g&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),S=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),x=!S&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),A=v?3:g?0:void 0,w=x?3:S?0:void 0;if(typeof A=="number"&&typeof w=="number"){const[b,R]=[t[A],e[w]];b.toLowerCase()===R.toLowerCase()&&(e[w]=b,w>A?e=e.slice(w):A>w&&(t=t.slice(A)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var a=0,o=0,l=t.length,h=e.length;a<l&&o<h;a++,o++){this.debug("matchOne loop");var c=e[o],f=t[a];if(this.debug(e,c,f),c===!1)return!1;if(c===J){this.debug("GLOBSTAR",[e,c,f]);var u=a,m=o+1;if(m===h){for(this.debug("** at the end");a<l;a++)if(t[a]==="."||t[a]===".."||!n.dot&&t[a].charAt(0)===".")return!1;return!0}for(;u<l;){var y=t[u];if(this.debug(`
globstar while`,t,u,e,m,y),this.matchOne(t.slice(u),e.slice(m),i))return this.debug("globstar found match!",u,l,y),!0;if(y==="."||y===".."||!n.dot&&y.charAt(0)==="."){this.debug("dot detected!",t,u,e,m);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(i&&(this.debug(`
>>> no match, partial?`,t,u,e,m),u===l))}let g;if(typeof c=="string"?(g=f===c,this.debug("string match",c,f,g)):(g=c.test(f),this.debug("pattern match",c,f,g)),!g)return!1}if(a===l&&o===h)return!0;if(a===l)return i;if(o===h)return a===l-1&&t[a]==="";throw new Error("wtf?")}braceExpand(){return Xn(this.pattern,this.options)}parse(t){Ie(t);const e=this.options;if(t==="**")return J;if(t==="")return"";let i,n=null;(i=t.match(Ia))?n=e.dot?Ba:Wa:(i=t.match(Ma))?n=(e.nocase?e.dot?Pa:ja:e.dot?La:Ca)(i[1]):(i=t.match(qa))?n=(e.nocase?e.dot?za:Ua:e.dot?Ga:Ha)(i):(i=t.match(ka))?n=e.dot?$a:Da:(i=t.match(Na))&&(n=Fa);const s=Y.fromGlob(t,this.options).toMMPattern();return n&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:n}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,i=e.noglobstar?Ya:e.dot?Ja:Za,n=new Set(e.nocase?["i"]:[]);let s=t.map(l=>{const h=l.map(c=>{if(c instanceof RegExp)for(const f of c.flags.split(""))n.add(f);return typeof c=="string"?il(c):c===J?J:c._src});return h.forEach((c,f)=>{const u=h[f+1],m=h[f-1];c!==J||m===J||(m===void 0?u!==void 0&&u!==J?h[f+1]="(?:\\/|"+i+"\\/)?"+u:h[f]=i:u===void 0?h[f-1]=m+"(?:\\/|"+i+")?":u!==J&&(h[f-1]=m+"(?:\\/|\\/"+i+"\\/)"+u,h[f+1]=J))}),h.filter(c=>c!==J).join("/")}).join("|");const[a,o]=t.length>1?["(?:",")"]:["",""];s="^"+a+s+o+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...n].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;const i=this.options;this.isWindows&&(t=t.split("\\").join("/"));const n=this.slashSplit(t);this.debug(this.pattern,"split",n);const s=this.set;this.debug(this.pattern,"set",s);let a=n[n.length-1];if(!a)for(let o=n.length-2;!a&&o>=0;o--)a=n[o];for(let o=0;o<s.length;o++){const l=s[o];let h=n;if(i.matchBase&&l.length===1&&(h=[a]),this.matchOne(h,l,e))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(t){return Z.defaults(t).Minimatch}}Z.AST=Y;Z.Minimatch=Rt;Z.escape=Kn;Z.unescape=qt;const rl=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Qn=new Set,Ji=typeof F=="object"&&F?F:{},ts=(r,t,e,i)=>{typeof Ji.emitWarning=="function"?Ji.emitWarning(r,t,e,i):console.error(`[${e}] ${t}: ${r}`)};let We=globalThis.AbortController,Jr=globalThis.AbortSignal;if(typeof We>"u"){Jr=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,n){this._onabort.push(n)}},We=class{constructor(){t()}signal=new Jr;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const n of this.signal._onabort)n(i);this.signal.onabort?.(i)}}};let r=Ji.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const t=()=>{r&&(r=!1,ts("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const nl=r=>!Qn.has(r),St=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),es=r=>St(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?Pe:null:null;class Pe extends Array{constructor(t){super(t),this.fill(0)}}class Ut{heap;length;static#t=!1;static create(t){const e=es(t);if(!e)return[];Ut.#t=!0;const i=new Ut(t,e);return Ut.#t=!1,i}constructor(t,e){if(!Ut.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class Ke{#t;#e;#s;#n;#o;#b;#y;#c;get perf(){return this.#c}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#f;#u;#l;#i;#p;#S;#v;#m;#A;#g;#_;#T;#w;#E;#O;#d;#r;static unsafeExposeInternals(t){return{starts:t.#T,ttls:t.#w,sizes:t.#_,keyMap:t.#u,keyList:t.#l,valList:t.#i,next:t.#p,prev:t.#S,get head(){return t.#v},get tail(){return t.#m},free:t.#A,isBackgroundFetch:e=>t.#h(e),backgroundFetch:(e,i,n,s)=>t.#U(e,i,n,s),moveToTail:e=>t.#N(e),indexes:e=>t.#C(e),rindexes:e=>t.#j(e),isStale:e=>t.#x(e)}}get max(){return this.#t}get maxSize(){return this.#e}get calculatedSize(){return this.#f}get size(){return this.#a}get fetchMethod(){return this.#b}get memoMethod(){return this.#y}get dispose(){return this.#s}get onInsert(){return this.#n}get disposeAfter(){return this.#o}constructor(t){const{max:e=0,ttl:i,ttlResolution:n=1,ttlAutopurge:s,updateAgeOnGet:a,updateAgeOnHas:o,allowStale:l,dispose:h,onInsert:c,disposeAfter:f,noDisposeOnSet:u,noUpdateTTL:m,maxSize:y=0,maxEntrySize:g=0,sizeCalculation:v,fetchMethod:S,memoMethod:x,noDeleteOnFetchRejection:A,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:b,allowStaleOnFetchAbort:R,ignoreFetchAbort:T,perf:L}=t;if(L!==void 0&&typeof L?.now!="function")throw new TypeError("perf option must have a now() method if specified");if(this.#c=L??rl,e!==0&&!St(e))throw new TypeError("max option must be a nonnegative integer");const j=e?es(e):Array;if(!j)throw new Error("invalid max value: "+e);if(this.#t=e,this.#e=y,this.maxEntrySize=g||this.#e,this.sizeCalculation=v,this.sizeCalculation){if(!this.#e&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(x!==void 0&&typeof x!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#y=x,S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#b=S,this.#O=!!S,this.#u=new Map,this.#l=new Array(e).fill(void 0),this.#i=new Array(e).fill(void 0),this.#p=new j(e),this.#S=new j(e),this.#v=0,this.#m=0,this.#A=Ut.create(e),this.#a=0,this.#f=0,typeof h=="function"&&(this.#s=h),typeof c=="function"&&(this.#n=c),typeof f=="function"?(this.#o=f,this.#g=[]):(this.#o=void 0,this.#g=void 0),this.#E=!!this.#s,this.#r=!!this.#n,this.#d=!!this.#o,this.noDisposeOnSet=!!u,this.noUpdateTTL=!!m,this.noDeleteOnFetchRejection=!!A,this.allowStaleOnFetchRejection=!!b,this.allowStaleOnFetchAbort=!!R,this.ignoreFetchAbort=!!T,this.maxEntrySize!==0){if(this.#e!==0&&!St(this.#e))throw new TypeError("maxSize must be a positive integer if specified");if(!St(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#F()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!o,this.ttlResolution=St(n)||n===0?n:1,this.ttlAutopurge=!!s,this.ttl=i||0,this.ttl){if(!St(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#t===0&&this.ttl===0&&this.#e===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#e){const M="LRU_CACHE_UNBOUNDED";nl(M)&&(Qn.add(M),ts("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",M,Ke))}}getRemainingTTL(t){return this.#u.has(t)?1/0:0}#P(){const t=new Pe(this.#t),e=new Pe(this.#t);this.#w=t,this.#T=e,this.#B=(s,a,o=this.#c.now())=>{if(e[s]=a!==0?o:0,t[s]=a,a!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#x(s)&&this.#L(this.#l[s],"expire")},a+1);l.unref&&l.unref()}},this.#M=s=>{e[s]=t[s]!==0?this.#c.now():0},this.#R=(s,a)=>{if(t[a]){const o=t[a],l=e[a];if(!o||!l)return;s.ttl=o,s.start=l,s.now=i||n();const h=s.now-l;s.remainingTTL=o-h}};let i=0;const n=()=>{const s=this.#c.now();if(this.ttlResolution>0){i=s;const a=setTimeout(()=>i=0,this.ttlResolution);a.unref&&a.unref()}return s};this.getRemainingTTL=s=>{const a=this.#u.get(s);if(a===void 0)return 0;const o=t[a],l=e[a];if(!o||!l)return 1/0;const h=(i||n())-l;return o-h},this.#x=s=>{const a=e[s],o=t[s];return!!o&&!!a&&(i||n())-a>o}}#M=()=>{};#R=()=>{};#B=()=>{};#x=()=>!1;#F(){const t=new Pe(this.#t);this.#f=0,this.#_=t,this.#k=e=>{this.#f-=t[e],t[e]=0},this.#D=(e,i,n,s)=>{if(this.#h(i))return 0;if(!St(n))if(s){if(typeof s!="function")throw new TypeError("sizeCalculation must be a function");if(n=s(i,e),!St(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#I=(e,i,n)=>{if(t[e]=i,this.#e){const s=this.#e-t[e];for(;this.#f>s;)this.#$(!0)}this.#f+=t[e],n&&(n.entrySize=i,n.totalCalculatedSize=this.#f)}}#k=t=>{};#I=(t,e,i)=>{};#D=(t,e,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#C({allowStale:t=this.allowStale}={}){if(this.#a)for(let e=this.#m;!(!this.#q(e)||((t||!this.#x(e))&&(yield e),e===this.#v));)e=this.#S[e]}*#j({allowStale:t=this.allowStale}={}){if(this.#a)for(let e=this.#v;!(!this.#q(e)||((t||!this.#x(e))&&(yield e),e===this.#m));)e=this.#p[e]}#q(t){return t!==void 0&&this.#u.get(this.#l[t])===t}*entries(){for(const t of this.#C())this.#i[t]!==void 0&&this.#l[t]!==void 0&&!this.#h(this.#i[t])&&(yield[this.#l[t],this.#i[t]])}*rentries(){for(const t of this.#j())this.#i[t]!==void 0&&this.#l[t]!==void 0&&!this.#h(this.#i[t])&&(yield[this.#l[t],this.#i[t]])}*keys(){for(const t of this.#C()){const e=this.#l[t];e!==void 0&&!this.#h(this.#i[t])&&(yield e)}}*rkeys(){for(const t of this.#j()){const e=this.#l[t];e!==void 0&&!this.#h(this.#i[t])&&(yield e)}}*values(){for(const t of this.#C())this.#i[t]!==void 0&&!this.#h(this.#i[t])&&(yield this.#i[t])}*rvalues(){for(const t of this.#j())this.#i[t]!==void 0&&!this.#h(this.#i[t])&&(yield this.#i[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const i of this.#C()){const n=this.#i[i],s=this.#h(n)?n.__staleWhileFetching:n;if(s!==void 0&&t(s,this.#l[i],this))return this.get(this.#l[i],e)}}forEach(t,e=this){for(const i of this.#C()){const n=this.#i[i],s=this.#h(n)?n.__staleWhileFetching:n;s!==void 0&&t.call(e,s,this.#l[i],this)}}rforEach(t,e=this){for(const i of this.#j()){const n=this.#i[i],s=this.#h(n)?n.__staleWhileFetching:n;s!==void 0&&t.call(e,s,this.#l[i],this)}}purgeStale(){let t=!1;for(const e of this.#j({allowStale:!0}))this.#x(e)&&(this.#L(this.#l[e],"expire"),t=!0);return t}info(t){const e=this.#u.get(t);if(e===void 0)return;const i=this.#i[e],n=this.#h(i)?i.__staleWhileFetching:i;if(n===void 0)return;const s={value:n};if(this.#w&&this.#T){const a=this.#w[e],o=this.#T[e];if(a&&o){const l=a-(this.#c.now()-o);s.ttl=l,s.start=Date.now()}}return this.#_&&(s.size=this.#_[e]),s}dump(){const t=[];for(const e of this.#C({allowStale:!0})){const i=this.#l[e],n=this.#i[e],s=this.#h(n)?n.__staleWhileFetching:n;if(s===void 0||i===void 0)continue;const a={value:s};if(this.#w&&this.#T){a.ttl=this.#w[e];const o=this.#c.now()-this.#T[e];a.start=Math.floor(Date.now()-o)}this.#_&&(a.size=this.#_[e]),t.unshift([i,a])}return t}load(t){this.clear();for(const[e,i]of t){if(i.start){const n=Date.now()-i.start;i.start=this.#c.now()-n}this.set(e,i.value,i)}}set(t,e,i={}){if(e===void 0)return this.delete(t),this;const{ttl:n=this.ttl,start:s,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:l}=i;let{noUpdateTTL:h=this.noUpdateTTL}=i;const c=this.#D(t,e,i.size||0,o);if(this.maxEntrySize&&c>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#L(t,"set"),this;let f=this.#a===0?void 0:this.#u.get(t);if(f===void 0)f=this.#a===0?this.#m:this.#A.length!==0?this.#A.pop():this.#a===this.#t?this.#$(!1):this.#a,this.#l[f]=t,this.#i[f]=e,this.#u.set(t,f),this.#p[this.#m]=f,this.#S[f]=this.#m,this.#m=f,this.#a++,this.#I(f,c,l),l&&(l.set="add"),h=!1,this.#r&&this.#n?.(e,t,"add");else{this.#N(f);const u=this.#i[f];if(e!==u){if(this.#O&&this.#h(u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:m}=u;m!==void 0&&!a&&(this.#E&&this.#s?.(m,t,"set"),this.#d&&this.#g?.push([m,t,"set"]))}else a||(this.#E&&this.#s?.(u,t,"set"),this.#d&&this.#g?.push([u,t,"set"]));if(this.#k(f),this.#I(f,c,l),this.#i[f]=e,l){l.set="replace";const m=u&&this.#h(u)?u.__staleWhileFetching:u;m!==void 0&&(l.oldValue=m)}}else l&&(l.set="update");this.#r&&this.onInsert?.(e,t,e===u?"update":"replace")}if(n!==0&&!this.#w&&this.#P(),this.#w&&(h||this.#B(f,n,s),l&&this.#R(l,f)),!a&&this.#d&&this.#g){const u=this.#g;let m;for(;m=u?.shift();)this.#o?.(...m)}return this}pop(){try{for(;this.#a;){const t=this.#i[this.#v];if(this.#$(!0),this.#h(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#d&&this.#g){const t=this.#g;let e;for(;e=t?.shift();)this.#o?.(...e)}}}#$(t){const e=this.#v,i=this.#l[e],n=this.#i[e];return this.#O&&this.#h(n)?n.__abortController.abort(new Error("evicted")):(this.#E||this.#d)&&(this.#E&&this.#s?.(n,i,"evict"),this.#d&&this.#g?.push([n,i,"evict"])),this.#k(e),t&&(this.#l[e]=void 0,this.#i[e]=void 0,this.#A.push(e)),this.#a===1?(this.#v=this.#m=0,this.#A.length=0):this.#v=this.#p[e],this.#u.delete(i),this.#a--,e}has(t,e={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=e,s=this.#u.get(t);if(s!==void 0){const a=this.#i[s];if(this.#h(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#x(s))n&&(n.has="stale",this.#R(n,s));else return i&&this.#M(s),n&&(n.has="hit",this.#R(n,s)),!0}else n&&(n.has="miss");return!1}peek(t,e={}){const{allowStale:i=this.allowStale}=e,n=this.#u.get(t);if(n===void 0||!i&&this.#x(n))return;const s=this.#i[n];return this.#h(s)?s.__staleWhileFetching:s}#U(t,e,i,n){const s=e===void 0?void 0:this.#i[e];if(this.#h(s))return s;const a=new We,{signal:o}=i;o?.addEventListener("abort",()=>a.abort(o.reason),{signal:a.signal});const l={signal:a.signal,options:i,context:n},h=(g,v=!1)=>{const{aborted:S}=a.signal,x=i.ignoreFetchAbort&&g!==void 0;if(i.status&&(S&&!v?(i.status.fetchAborted=!0,i.status.fetchError=a.signal.reason,x&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),S&&!x&&!v)return f(a.signal.reason);const A=m,w=this.#i[e];return(w===m||x&&v&&w===void 0)&&(g===void 0?A.__staleWhileFetching!==void 0?this.#i[e]=A.__staleWhileFetching:this.#L(t,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(t,g,l.options))),g},c=g=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=g),f(g)),f=g=>{const{aborted:v}=a.signal,S=v&&i.allowStaleOnFetchAbort,x=S||i.allowStaleOnFetchRejection,A=x||i.noDeleteOnFetchRejection,w=m;if(this.#i[e]===m&&(!A||w.__staleWhileFetching===void 0?this.#L(t,"fetch"):S||(this.#i[e]=w.__staleWhileFetching)),x)return i.status&&w.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),w.__staleWhileFetching;if(w.__returned===w)throw g},u=(g,v)=>{const S=this.#b?.(t,s,l);S&&S instanceof Promise&&S.then(x=>g(x===void 0?void 0:x),v),a.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(g(void 0),i.allowStaleOnFetchAbort&&(g=x=>h(x,!0)))})};i.status&&(i.status.fetchDispatched=!0);const m=new Promise(u).then(h,c),y=Object.assign(m,{__abortController:a,__staleWhileFetching:s,__returned:void 0});return e===void 0?(this.set(t,y,{...l.options,status:void 0}),e=this.#u.get(t)):this.#i[e]=y,y}#h(t){if(!this.#O)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof We}async fetch(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:l=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:y=this.allowStaleOnFetchAbort,context:g,forceRefresh:v=!1,status:S,signal:x}=e;if(!this.#O)return S&&(S.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,status:S});const A={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,ttl:a,noDisposeOnSet:o,size:l,sizeCalculation:h,noUpdateTTL:c,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:y,ignoreFetchAbort:m,status:S,signal:x};let w=this.#u.get(t);if(w===void 0){S&&(S.fetch="miss");const b=this.#U(t,w,A,g);return b.__returned=b}else{const b=this.#i[w];if(this.#h(b)){const M=i&&b.__staleWhileFetching!==void 0;return S&&(S.fetch="inflight",M&&(S.returnedStale=!0)),M?b.__staleWhileFetching:b.__returned=b}const R=this.#x(w);if(!v&&!R)return S&&(S.fetch="hit"),this.#N(w),n&&this.#M(w),S&&this.#R(S,w),b;const T=this.#U(t,w,A,g),j=T.__staleWhileFetching!==void 0&&i;return S&&(S.fetch=R?"stale":"refresh",j&&R&&(S.returnedStale=!0)),j?T.__staleWhileFetching:T.__returned=T}}async forceFetch(t,e={}){const i=await this.fetch(t,e);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(t,e={}){const i=this.#y;if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:s,...a}=e,o=this.get(t,a);if(!s&&o!==void 0)return o;const l=i(t,o,{options:a,context:n});return this.set(t,l,a),l}get(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:a}=e,o=this.#u.get(t);if(o!==void 0){const l=this.#i[o],h=this.#h(l);return a&&this.#R(a,o),this.#x(o)?(a&&(a.get="stale"),h?(a&&i&&l.__staleWhileFetching!==void 0&&(a.returnedStale=!0),i?l.__staleWhileFetching:void 0):(s||this.#L(t,"expire"),a&&i&&(a.returnedStale=!0),i?l:void 0)):(a&&(a.get="hit"),h?l.__staleWhileFetching:(this.#N(o),n&&this.#M(o),l))}else a&&(a.get="miss")}#z(t,e){this.#S[e]=t,this.#p[t]=e}#N(t){t!==this.#m&&(t===this.#v?this.#v=this.#p[t]:this.#z(this.#S[t],this.#p[t]),this.#z(this.#m,t),this.#m=t)}delete(t){return this.#L(t,"delete")}#L(t,e){let i=!1;if(this.#a!==0){const n=this.#u.get(t);if(n!==void 0)if(i=!0,this.#a===1)this.#W(e);else{this.#k(n);const s=this.#i[n];if(this.#h(s)?s.__abortController.abort(new Error("deleted")):(this.#E||this.#d)&&(this.#E&&this.#s?.(s,t,e),this.#d&&this.#g?.push([s,t,e])),this.#u.delete(t),this.#l[n]=void 0,this.#i[n]=void 0,n===this.#m)this.#m=this.#S[n];else if(n===this.#v)this.#v=this.#p[n];else{const a=this.#S[n];this.#p[a]=this.#p[n];const o=this.#p[n];this.#S[o]=this.#S[n]}this.#a--,this.#A.push(n)}}if(this.#d&&this.#g?.length){const n=this.#g;let s;for(;s=n?.shift();)this.#o?.(...s)}return i}clear(){return this.#W("delete")}#W(t){for(const e of this.#j({allowStale:!0})){const i=this.#i[e];if(this.#h(i))i.__abortController.abort(new Error("deleted"));else{const n=this.#l[e];this.#E&&this.#s?.(i,n,t),this.#d&&this.#g?.push([i,n,t])}}if(this.#u.clear(),this.#i.fill(void 0),this.#l.fill(void 0),this.#w&&this.#T&&(this.#w.fill(0),this.#T.fill(0)),this.#_&&this.#_.fill(0),this.#v=0,this.#m=0,this.#A.length=0,this.#f=0,this.#a=0,this.#d&&this.#g){const e=this.#g;let i;for(;i=e?.shift();)this.#o?.(...i)}}}const Zr=typeof F=="object"&&F?F:{stdout:null,stderr:null},sl=r=>!!r&&typeof r=="object"&&(r instanceof Be||r instanceof In||ol(r)||al(r)),ol=r=>!!r&&typeof r=="object"&&r instanceof ir.EventEmitter&&typeof r.pipe=="function"&&r.pipe!==In.Writable.prototype.pipe,al=r=>!!r&&typeof r=="object"&&r instanceof ir.EventEmitter&&typeof r.write=="function"&&typeof r.end=="function",gt=Symbol("EOF"),wt=Symbol("maybeEmitEnd"),bt=Symbol("emittedEnd"),xe=Symbol("emittingEnd"),Qt=Symbol("emittedError"),Te=Symbol("closed"),Xr=Symbol("read"),Oe=Symbol("flush"),Qr=Symbol("flushChunk"),st=Symbol("encoding"),Ft=Symbol("decoder"),z=Symbol("flowing"),te=Symbol("paused"),Wt=Symbol("resume"),G=Symbol("buffer"),K=Symbol("pipes"),H=Symbol("bufferLength"),Pi=Symbol("bufferPush"),Ae=Symbol("bufferShift"),V=Symbol("objectMode"),B=Symbol("destroyed"),ki=Symbol("error"),Di=Symbol("emitData"),tn=Symbol("emitEnd"),$i=Symbol("emitEnd2"),ut=Symbol("async"),Ni=Symbol("abort"),Me=Symbol("aborted"),ee=Symbol("signal"),Ot=Symbol("dataListeners"),tt=Symbol("discarded"),ie=r=>Promise.resolve().then(r),ll=r=>r(),hl=r=>r==="end"||r==="finish"||r==="prefinish",cl=r=>r instanceof ArrayBuffer||!!r&&typeof r=="object"&&r.constructor&&r.constructor.name==="ArrayBuffer"&&r.byteLength>=0,ul=r=>!Buffer.isBuffer(r)&&ArrayBuffer.isView(r);class is{src;dest;opts;ondrain;constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[Wt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class fl extends is{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=n=>e.emit("error",n),t.on("error",this.proxyErrors)}}const dl=r=>!!r.objectMode,pl=r=>!r.objectMode&&!!r.encoding&&r.encoding!=="buffer";class Be extends ir.EventEmitter{[z]=!1;[te]=!1;[K]=[];[G]=[];[V];[st];[ut];[Ft];[gt]=!1;[bt]=!1;[xe]=!1;[Te]=!1;[Qt]=null;[H]=0;[B]=!1;[ee];[Me]=!1;[Ot]=0;[tt]=!1;writable=!0;readable=!0;constructor(...t){const e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");dl(e)?(this[V]=!0,this[st]=null):pl(e)?(this[st]=e.encoding,this[V]=!1):(this[V]=!1,this[st]=null),this[ut]=!!e.async,this[Ft]=this[st]?new nr(this[st]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[G]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[K]});const{signal:i}=e;i&&(this[ee]=i,i.aborted?this[Ni]():i.addEventListener("abort",()=>this[Ni]()))}get bufferLength(){return this[H]}get encoding(){return this[st]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[V]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ut]}set async(t){this[ut]=this[ut]||!!t}[Ni](){this[Me]=!0,this.emit("abort",this[ee]?.reason),this.destroy(this[ee]?.reason)}get aborted(){return this[Me]}set aborted(t){}write(t,e,i){if(this[Me])return!1;if(this[gt])throw new Error("write after end");if(this[B])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");const n=this[ut]?ie:ll;if(!this[V]&&!Buffer.isBuffer(t)){if(ul(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(cl(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[V]?(this[z]&&this[H]!==0&&this[Oe](!0),this[z]?this.emit("data",t):this[Pi](t),this[H]!==0&&this.emit("readable"),i&&n(i),this[z]):t.length?(typeof t=="string"&&!(e===this[st]&&!this[Ft]?.lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[st]&&(t=this[Ft].write(t)),this[z]&&this[H]!==0&&this[Oe](!0),this[z]?this.emit("data",t):this[Pi](t),this[H]!==0&&this.emit("readable"),i&&n(i),this[z]):(this[H]!==0&&this.emit("readable"),i&&n(i),this[z])}read(t){if(this[B])return null;if(this[tt]=!1,this[H]===0||t===0||t&&t>this[H])return this[wt](),null;this[V]&&(t=null),this[G].length>1&&!this[V]&&(this[G]=[this[st]?this[G].join(""):Buffer.concat(this[G],this[H])]);const e=this[Xr](t||null,this[G][0]);return this[wt](),e}[Xr](t,e){if(this[V])this[Ae]();else{const i=e;t===i.length||t===null?this[Ae]():typeof i=="string"?(this[G][0]=i.slice(t),e=i.slice(0,t),this[H]-=t):(this[G][0]=i.subarray(t),e=i.subarray(0,t),this[H]-=t)}return this.emit("data",e),!this[G].length&&!this[gt]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e="utf8"),t!==void 0&&this.write(t,e),i&&this.once("end",i),this[gt]=!0,this.writable=!1,(this[z]||!this[te])&&this[wt](),this}[Wt](){this[B]||(!this[Ot]&&!this[K].length&&(this[tt]=!0),this[te]=!1,this[z]=!0,this.emit("resume"),this[G].length?this[Oe]():this[gt]?this[wt]():this.emit("drain"))}resume(){return this[Wt]()}pause(){this[z]=!1,this[te]=!0,this[tt]=!1}get destroyed(){return this[B]}get flowing(){return this[z]}get paused(){return this[te]}[Pi](t){this[V]?this[H]+=1:this[H]+=t.length,this[G].push(t)}[Ae](){return this[V]?this[H]-=1:this[H]-=this[G][0].length,this[G].shift()}[Oe](t=!1){do;while(this[Qr](this[Ae]())&&this[G].length);!t&&!this[G].length&&!this[gt]&&this.emit("drain")}[Qr](t){return this.emit("data",t),this[z]}pipe(t,e){if(this[B])return t;this[tt]=!1;const i=this[bt];return e=e||{},t===Zr.stdout||t===Zr.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[K].push(e.proxyErrors?new fl(this,t,e):new is(this,t,e)),this[ut]?ie(()=>this[Wt]()):this[Wt]()),t}unpipe(t){const e=this[K].find(i=>i.dest===t);e&&(this[K].length===1?(this[z]&&this[Ot]===0&&(this[z]=!1),this[K]=[]):this[K].splice(this[K].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);if(t==="data")this[tt]=!1,this[Ot]++,!this[K].length&&!this[z]&&this[Wt]();else if(t==="readable"&&this[H]!==0)super.emit("readable");else if(hl(t)&&this[bt])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[Qt]){const n=e;this[ut]?ie(()=>n.call(this,this[Qt])):n.call(this,this[Qt])}return i}removeListener(t,e){return this.off(t,e)}off(t,e){const i=super.off(t,e);return t==="data"&&(this[Ot]=this.listeners("data").length,this[Ot]===0&&!this[tt]&&!this[K].length&&(this[z]=!1)),i}removeAllListeners(t){const e=super.removeAllListeners(t);return(t==="data"||t===void 0)&&(this[Ot]=0,!this[tt]&&!this[K].length&&(this[z]=!1)),e}get emittedEnd(){return this[bt]}[wt](){!this[xe]&&!this[bt]&&!this[B]&&this[G].length===0&&this[gt]&&(this[xe]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Te]&&this.emit("close"),this[xe]=!1)}emit(t,...e){const i=e[0];if(t!=="error"&&t!=="close"&&t!==B&&this[B])return!1;if(t==="data")return!this[V]&&!i?!1:this[ut]?(ie(()=>this[Di](i)),!0):this[Di](i);if(t==="end")return this[tn]();if(t==="close"){if(this[Te]=!0,!this[bt]&&!this[B])return!1;const s=super.emit("close");return this.removeAllListeners("close"),s}else if(t==="error"){this[Qt]=i,super.emit(ki,i);const s=!this[ee]||this.listeners("error").length?super.emit("error",i):!1;return this[wt](),s}else if(t==="resume"){const s=super.emit("resume");return this[wt](),s}else if(t==="finish"||t==="prefinish"){const s=super.emit(t);return this.removeAllListeners(t),s}const n=super.emit(t,...e);return this[wt](),n}[Di](t){for(const i of this[K])i.dest.write(t)===!1&&this.pause();const e=this[tt]?!1:super.emit("data",t);return this[wt](),e}[tn](){return this[bt]?!1:(this[bt]=!0,this.readable=!1,this[ut]?(ie(()=>this[$i]()),!0):this[$i]())}[$i](){if(this[Ft]){const e=this[Ft].end();if(e){for(const i of this[K])i.dest.write(e);this[tt]||super.emit("data",e)}}for(const e of this[K])e.end();const t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){const t=Object.assign([],{dataLength:0});this[V]||(t.dataLength=0);const e=this.promise();return this.on("data",i=>{t.push(i),this[V]||(t.dataLength+=i.length)}),await e,t}async concat(){if(this[V])throw new Error("cannot concat in objectMode");const t=await this.collect();return this[st]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(B,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[Symbol.asyncIterator](){this[tt]=!1;let t=!1;const e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();const n=this.read();if(n!==null)return Promise.resolve({done:!1,value:n});if(this[gt])return e();let s,a;const o=f=>{this.off("data",l),this.off("end",h),this.off(B,c),e(),a(f)},l=f=>{this.off("error",o),this.off("end",h),this.off(B,c),this.pause(),s({value:f,done:!!this[gt]})},h=()=>{this.off("error",o),this.off("data",l),this.off(B,c),e(),s({done:!0,value:void 0})},c=()=>o(new Error("stream destroyed"));return new Promise((f,u)=>{a=u,s=f,this.once(B,c),this.once("error",o),this.once("end",h),this.once("data",l)})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[tt]=!1;let t=!1;const e=()=>(this.pause(),this.off(ki,e),this.off(B,e),this.off("end",e),t=!0,{done:!0,value:void 0}),i=()=>{if(t)return e();const n=this.read();return n===null?e():{done:!1,value:n}};return this.once("end",e),this.once(ki,e),this.once(B,e),{next:i,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[B])return t?this.emit("error",t):this.emit(B),this;this[B]=!0,this[tt]=!0,this[G].length=0,this[H]=0;const e=this;return typeof e.close=="function"&&!this[Te]&&e.close(),t?this.emit("error",t):this.emit(B),this}static get isStream(){return sl}}const ml=Ts.native,oe={lstatSync:ks,readdir:Ps,readdirSync:js,readlinkSync:Ls,realpathSync:ml,promises:{lstat:Cs,readdir:Ms,readlink:As,realpath:Os}},rs=r=>!r||r===oe||r===Ds?oe:{...oe,...r,promises:{...oe.promises,...r.promises||{}}},ns=/^\\\\\?\\([a-z]:)\\?$/i,gl=r=>r.replace(/\//g,"\\").replace(ns,"$1\\"),wl=/[\\\/]/,rt=0,ss=1,os=2,dt=4,as=6,ls=8,At=10,hs=12,it=15,re=~it,Fi=16,en=32,ae=64,ot=128,Ce=256,ke=512,rn=ae|ot|ke,yl=1023,Ii=r=>r.isFile()?ls:r.isDirectory()?dt:r.isSymbolicLink()?At:r.isCharacterDevice()?os:r.isBlockDevice()?as:r.isSocket()?hs:r.isFIFO()?ss:rt,nn=new Map,le=r=>{const t=nn.get(r);if(t)return t;const e=r.normalize("NFKD");return nn.set(r,e),e},sn=new Map,Le=r=>{const t=sn.get(r);if(t)return t;const e=le(r.toLowerCase());return sn.set(r,e),e};class on extends Ke{constructor(){super({max:256})}}class vl extends Ke{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1})}}const cs=Symbol("PathScurry setAsCwd");class X{name;root;roots;parent;nocase;isCWD=!1;#t;#e;get dev(){return this.#e}#s;get mode(){return this.#s}#n;get nlink(){return this.#n}#o;get uid(){return this.#o}#b;get gid(){return this.#b}#y;get rdev(){return this.#y}#c;get blksize(){return this.#c}#a;get ino(){return this.#a}#f;get size(){return this.#f}#u;get blocks(){return this.#u}#l;get atimeMs(){return this.#l}#i;get mtimeMs(){return this.#i}#p;get ctimeMs(){return this.#p}#S;get birthtimeMs(){return this.#S}#v;get atime(){return this.#v}#m;get mtime(){return this.#m}#A;get ctime(){return this.#A}#g;get birthtime(){return this.#g}#_;#T;#w;#E;#O;#d;#r;#P;#M;#R;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(t,e=rt,i,n,s,a,o){this.name=t,this.#_=s?Le(t):le(t),this.#r=e&yl,this.nocase=s,this.roots=n,this.root=i||this,this.#P=a,this.#w=o.fullpath,this.#O=o.relative,this.#d=o.relativePosix,this.parent=o.parent,this.parent?this.#t=this.parent.#t:this.#t=rs(o.fs)}depth(){return this.#T!==void 0?this.#T:this.parent?this.#T=this.parent.depth()+1:this.#T=0}childrenCache(){return this.#P}resolve(t){if(!t)return this;const e=this.getRootString(t),n=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#B(n):this.#B(n)}#B(t){let e=this;for(const i of t)e=e.child(i);return e}children(){const t=this.#P.get(this);if(t)return t;const e=Object.assign([],{provisional:0});return this.#P.set(this,e),this.#r&=~Fi,e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;const i=this.children(),n=this.nocase?Le(t):le(t);for(const l of i)if(l.#_===n)return l;const s=this.parent?this.sep:"",a=this.#w?this.#w+s+t:void 0,o=this.newChild(t,rt,{...e,parent:this,fullpath:a});return this.canReaddir()||(o.#r|=ot),i.push(o),o}relative(){if(this.isCWD)return"";if(this.#O!==void 0)return this.#O;const t=this.name,e=this.parent;if(!e)return this.#O=this.name;const i=e.relative();return i+(!i||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#d!==void 0)return this.#d;const t=this.name,e=this.parent;if(!e)return this.#d=this.fullpathPosix();const i=e.relativePosix();return i+(!i||!e.parent?"":"/")+t}fullpath(){if(this.#w!==void 0)return this.#w;const t=this.name,e=this.parent;if(!e)return this.#w=this.name;const n=e.fullpath()+(e.parent?this.sep:"")+t;return this.#w=n}fullpathPosix(){if(this.#E!==void 0)return this.#E;if(this.sep==="/")return this.#E=this.fullpath();if(!this.parent){const n=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(n)?this.#E=`//?/${n}`:this.#E=n}const t=this.parent,e=t.fullpathPosix(),i=e+(!e||!t.parent?"":"/")+this.name;return this.#E=i}isUnknown(){return(this.#r&it)===rt}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#r&it)===ls}isDirectory(){return(this.#r&it)===dt}isCharacterDevice(){return(this.#r&it)===os}isBlockDevice(){return(this.#r&it)===as}isFIFO(){return(this.#r&it)===ss}isSocket(){return(this.#r&it)===hs}isSymbolicLink(){return(this.#r&At)===At}lstatCached(){return this.#r&en?this:void 0}readlinkCached(){return this.#M}realpathCached(){return this.#R}readdirCached(){const t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#M)return!0;if(!this.parent)return!1;const t=this.#r&it;return!(t!==rt&&t!==At||this.#r&Ce||this.#r&ot)}calledReaddir(){return!!(this.#r&Fi)}isENOENT(){return!!(this.#r&ot)}isNamed(t){return this.nocase?this.#_===Le(t):this.#_===le(t)}async readlink(){const t=this.#M;if(t)return t;if(this.canReadlink()&&this.parent)try{const e=await this.#t.promises.readlink(this.fullpath()),i=(await this.parent.realpath())?.resolve(e);if(i)return this.#M=i}catch(e){this.#q(e.code);return}}readlinkSync(){const t=this.#M;if(t)return t;if(this.canReadlink()&&this.parent)try{const e=this.#t.readlinkSync(this.fullpath()),i=this.parent.realpathSync()?.resolve(e);if(i)return this.#M=i}catch(e){this.#q(e.code);return}}#x(t){this.#r|=Fi;for(let e=t.provisional;e<t.length;e++){const i=t[e];i&&i.#F()}}#F(){this.#r&ot||(this.#r=(this.#r|ot)&re,this.#k())}#k(){const t=this.children();t.provisional=0;for(const e of t)e.#F()}#I(){this.#r|=ke,this.#D()}#D(){if(this.#r&ae)return;let t=this.#r;(t&it)===dt&&(t&=re),this.#r=t|ae,this.#k()}#C(t=""){t==="ENOTDIR"||t==="EPERM"?this.#D():t==="ENOENT"?this.#F():this.children().provisional=0}#j(t=""){t==="ENOTDIR"?this.parent.#D():t==="ENOENT"&&this.#F()}#q(t=""){let e=this.#r;e|=Ce,t==="ENOENT"&&(e|=ot),(t==="EINVAL"||t==="UNKNOWN")&&(e&=re),this.#r=e,t==="ENOTDIR"&&this.parent&&this.parent.#D()}#$(t,e){return this.#h(t,e)||this.#U(t,e)}#U(t,e){const i=Ii(t),n=this.newChild(t.name,i,{parent:this}),s=n.#r&it;return s!==dt&&s!==At&&s!==rt&&(n.#r|=ae),e.unshift(n),e.provisional++,n}#h(t,e){for(let i=e.provisional;i<e.length;i++){const n=e[i];if((this.nocase?Le(t.name):le(t.name))===n.#_)return this.#z(t,n,i,e)}}#z(t,e,i,n){const s=e.name;return e.#r=e.#r&re|Ii(t),s!==t.name&&(e.name=t.name),i!==n.provisional&&(i===n.length-1?n.pop():n.splice(i,1),n.unshift(e)),n.provisional++,e}async lstat(){if((this.#r&ot)===0)try{return this.#N(await this.#t.promises.lstat(this.fullpath())),this}catch(t){this.#j(t.code)}}lstatSync(){if((this.#r&ot)===0)try{return this.#N(this.#t.lstatSync(this.fullpath())),this}catch(t){this.#j(t.code)}}#N(t){const{atime:e,atimeMs:i,birthtime:n,birthtimeMs:s,blksize:a,blocks:o,ctime:l,ctimeMs:h,dev:c,gid:f,ino:u,mode:m,mtime:y,mtimeMs:g,nlink:v,rdev:S,size:x,uid:A}=t;this.#v=e,this.#l=i,this.#g=n,this.#S=s,this.#c=a,this.#u=o,this.#A=l,this.#p=h,this.#e=c,this.#b=f,this.#a=u,this.#s=m,this.#m=y,this.#i=g,this.#n=v,this.#y=S,this.#f=x,this.#o=A;const w=Ii(t);this.#r=this.#r&re|w|en,w!==rt&&w!==dt&&w!==At&&(this.#r|=ae)}#L=[];#W=!1;#H(t){this.#W=!1;const e=this.#L.slice();this.#L.length=0,e.forEach(i=>i(null,t))}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}const i=this.children();if(this.calledReaddir()){const s=i.slice(0,i.provisional);e?t(null,s):queueMicrotask(()=>t(null,s));return}if(this.#L.push(t),this.#W)return;this.#W=!0;const n=this.fullpath();this.#t.readdir(n,{withFileTypes:!0},(s,a)=>{if(s)this.#C(s.code),i.provisional=0;else{for(const o of a)this.#$(o,i);this.#x(i)}this.#H(i.slice(0,i.provisional))})}#G;async readdir(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();if(this.#G)await this.#G;else{let i=()=>{};this.#G=new Promise(n=>i=n);try{for(const n of await this.#t.promises.readdir(e,{withFileTypes:!0}))this.#$(n,t);this.#x(t)}catch(n){this.#C(n.code),t.provisional=0}this.#G=void 0,i()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();try{for(const i of this.#t.readdirSync(e,{withFileTypes:!0}))this.#$(i,t);this.#x(t)}catch(i){this.#C(i.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(this.#r&rn)return!1;const t=it&this.#r;return t===rt||t===dt||t===At}shouldWalk(t,e){return(this.#r&dt)===dt&&!(this.#r&rn)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#R)return this.#R;if(!((ke|Ce|ot)&this.#r))try{const t=await this.#t.promises.realpath(this.fullpath());return this.#R=this.resolve(t)}catch{this.#I()}}realpathSync(){if(this.#R)return this.#R;if(!((ke|Ce|ot)&this.#r))try{const t=this.#t.realpathSync(this.fullpath());return this.#R=this.resolve(t)}catch{this.#I()}}[cs](t){if(t===this)return;t.isCWD=!1,this.isCWD=!0;const e=new Set([]);let i=[],n=this;for(;n&&n.parent;)e.add(n),n.#O=i.join(this.sep),n.#d=i.join("/"),n=n.parent,i.push("..");for(n=t;n&&n.parent&&!e.has(n);)n.#O=void 0,n.#d=void 0,n=n.parent}}class Ye extends X{sep="\\";splitSep=wl;constructor(t,e=rt,i,n,s,a,o){super(t,e,i,n,s,a,o)}newChild(t,e=rt,i={}){return new Ye(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}getRootString(t){return Ui.parse(t).root}getRoot(t){if(t=gl(t.toUpperCase()),t===this.root.name)return this.root;for(const[e,i]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=i;return this.roots[t]=new lr(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(ns,"$1\\"),t===e}}class Je extends X{splitSep="/";sep="/";constructor(t,e=rt,i,n,s,a,o){super(t,e,i,n,s,a,o)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=rt,i={}){return new Je(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}}class us{root;rootPath;roots;cwd;#t;#e;#s;nocase;#n;constructor(t=F.cwd(),e,i,{nocase:n,childrenCacheSize:s=16*1024,fs:a=oe}={}){this.#n=rs(a),(t instanceof URL||t.startsWith("file://"))&&(t=Sn(t));const o=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(o),this.#t=new on,this.#e=new on,this.#s=new vl(s);const l=o.substring(this.rootPath.length).split(i);if(l.length===1&&!l[0]&&l.pop(),n===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=n,this.root=this.newRoot(this.#n),this.roots[this.rootPath]=this.root;let h=this.root,c=l.length-1;const f=e.sep;let u=this.rootPath,m=!1;for(const y of l){const g=c--;h=h.child(y,{relative:new Array(g).fill("..").join(f),relativePosix:new Array(g).fill("..").join("/"),fullpath:u+=(m?"":f)+y}),m=!0}this.cwd=h}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#s}resolve(...t){let e="";for(let s=t.length-1;s>=0;s--){const a=t[s];if(!(!a||a===".")&&(e=e?`${a}/${e}`:a,this.isAbsolute(a)))break}const i=this.#t.get(e);if(i!==void 0)return i;const n=this.cwd.resolve(e).fullpath();return this.#t.set(e,n),n}resolvePosix(...t){let e="";for(let s=t.length-1;s>=0;s--){const a=t[s];if(!(!a||a===".")&&(e=e?`${a}/${e}`:a,this.isAbsolute(a)))break}const i=this.#e.get(e);if(i!==void 0)return i;const n=this.cwd.resolve(e).fullpathPosix();return this.#e.set(e,n),n}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i}=e;if(t.canReaddir()){const n=await t.readdir();return i?n:n.map(s=>s.name)}else return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0}=e;return t.canReaddir()?i?t.readdirSync():t.readdirSync().map(n=>n.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t.withFileTypes,t=this.cwd);const i=await t.readlink();return e?i:i?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t.withFileTypes,t=this.cwd);const i=t.readlinkSync();return e?i:i?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t.withFileTypes,t=this.cwd);const i=await t.realpath();return e?i:i?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t.withFileTypes,t=this.cwd);const i=t.realpathSync();return e?i:i?.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:n=!1,filter:s,walkFilter:a}=e,o=[];(!s||s(t))&&o.push(i?t:t.fullpath());const l=new Set,h=(f,u)=>{l.add(f),f.readdirCB((m,y)=>{if(m)return u(m);let g=y.length;if(!g)return u();const v=()=>{--g===0&&u()};for(const S of y)(!s||s(S))&&o.push(i?S:S.fullpath()),n&&S.isSymbolicLink()?S.realpath().then(x=>x?.isUnknown()?x.lstat():x).then(x=>x?.shouldWalk(l,a)?h(x,v):v()):S.shouldWalk(l,a)?h(S,v):v()},!0)},c=t;return new Promise((f,u)=>{h(c,m=>{if(m)return u(m);f(o)})})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:n=!1,filter:s,walkFilter:a}=e,o=[];(!s||s(t))&&o.push(i?t:t.fullpath());const l=new Set([t]);for(const h of l){const c=h.readdirSync();for(const f of c){(!s||s(f))&&o.push(i?f:f.fullpath());let u=f;if(f.isSymbolicLink()){if(!(n&&(u=f.realpathSync())))continue;u.isUnknown()&&u.lstatSync()}u.shouldWalk(l,a)&&l.add(u)}}return o}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:n=!1,filter:s,walkFilter:a}=e;(!s||s(t))&&(yield i?t:t.fullpath());const o=new Set([t]);for(const l of o){const h=l.readdirSync();for(const c of h){(!s||s(c))&&(yield i?c:c.fullpath());let f=c;if(c.isSymbolicLink()){if(!(n&&(f=c.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(o,a)&&o.add(f)}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:n=!1,filter:s,walkFilter:a}=e,o=new Be({objectMode:!0});(!s||s(t))&&o.write(i?t:t.fullpath());const l=new Set,h=[t];let c=0;const f=()=>{let u=!1;for(;!u;){const m=h.shift();if(!m){c===0&&o.end();return}c++,l.add(m);const y=(v,S,x=!1)=>{if(v)return o.emit("error",v);if(n&&!x){const A=[];for(const w of S)w.isSymbolicLink()&&A.push(w.realpath().then(b=>b?.isUnknown()?b.lstat():b));if(A.length){Promise.all(A).then(()=>y(null,S,!0));return}}for(const A of S)A&&(!s||s(A))&&(o.write(i?A:A.fullpath())||(u=!0));c--;for(const A of S){const w=A.realpathCached()||A;w.shouldWalk(l,a)&&h.push(w)}u&&!o.flowing?o.once("drain",f):g||f()};let g=!0;m.readdirCB(y,!0),g=!1}};return f(),o}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof X||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:n=!1,filter:s,walkFilter:a}=e,o=new Be({objectMode:!0}),l=new Set;(!s||s(t))&&o.write(i?t:t.fullpath());const h=[t];let c=0;const f=()=>{let u=!1;for(;!u;){const m=h.shift();if(!m){c===0&&o.end();return}c++,l.add(m);const y=m.readdirSync();for(const g of y)(!s||s(g))&&(o.write(i?g:g.fullpath())||(u=!0));c--;for(const g of y){let v=g;if(g.isSymbolicLink()){if(!(n&&(v=g.realpathSync())))continue;v.isUnknown()&&v.lstatSync()}v.shouldWalk(l,a)&&h.push(v)}}u&&!o.flowing&&o.once("drain",f)};return f(),o}chdir(t=this.cwd){const e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[cs](e)}}class lr extends us{sep="\\";constructor(t=F.cwd(),e={}){const{nocase:i=!0}=e;super(t,Ui,"\\",{...e,nocase:i}),this.nocase=i;for(let n=this.cwd;n;n=n.parent)n.nocase=this.nocase}parseRootPath(t){return Ui.parse(t).root.toUpperCase()}newRoot(t){return new Ye(this.rootPath,dt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}}class hr extends us{sep="/";constructor(t=F.cwd(),e={}){const{nocase:i=!1}=e;super(t,bn,"/",{...e,nocase:i}),this.nocase=i}parseRootPath(t){return"/"}newRoot(t){return new Je(this.rootPath,dt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}}class fs extends hr{constructor(t=F.cwd(),e={}){const{nocase:i=!0}=e;super(t,{...e,nocase:i})}}F.platform;const bl=F.platform==="win32"?lr:F.platform==="darwin"?fs:hr,Sl=r=>r.length>=1,El=r=>r.length>=1;class Ze{#t;#e;#s;length;#n;#o;#b;#y;#c;#a;#f=!0;constructor(t,e,i,n){if(!Sl(t))throw new TypeError("empty pattern list");if(!El(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,i<0||i>=this.length)throw new TypeError("index out of range");if(this.#t=t,this.#e=e,this.#s=i,this.#n=n,this.#s===0){if(this.isUNC()){const[s,a,o,l,...h]=this.#t,[c,f,u,m,...y]=this.#e;h[0]===""&&(h.shift(),y.shift());const g=[s,a,o,l,""].join("/"),v=[c,f,u,m,""].join("/");this.#t=[g,...h],this.#e=[v,...y],this.length=this.#t.length}else if(this.isDrive()||this.isAbsolute()){const[s,...a]=this.#t,[o,...l]=this.#e;a[0]===""&&(a.shift(),l.shift());const h=s+"/",c=o+"/";this.#t=[h,...a],this.#e=[c,...l],this.length=this.#t.length}}}pattern(){return this.#t[this.#s]}isString(){return typeof this.#t[this.#s]=="string"}isGlobstar(){return this.#t[this.#s]===J}isRegExp(){return this.#t[this.#s]instanceof RegExp}globString(){return this.#b=this.#b||(this.#s===0?this.isAbsolute()?this.#e[0]+this.#e.slice(1).join("/"):this.#e.join("/"):this.#e.slice(this.#s).join("/"))}hasMore(){return this.length>this.#s+1}rest(){return this.#o!==void 0?this.#o:this.hasMore()?(this.#o=new Ze(this.#t,this.#e,this.#s+1,this.#n),this.#o.#a=this.#a,this.#o.#c=this.#c,this.#o.#y=this.#y,this.#o):this.#o=null}isUNC(){const t=this.#t;return this.#c!==void 0?this.#c:this.#c=this.#n==="win32"&&this.#s===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3]}isDrive(){const t=this.#t;return this.#y!==void 0?this.#y:this.#y=this.#n==="win32"&&this.#s===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0])}isAbsolute(){const t=this.#t;return this.#a!==void 0?this.#a:this.#a=t[0]===""&&t.length>1||this.isDrive()||this.isUNC()}root(){const t=this.#t[0];return typeof t=="string"&&this.isAbsolute()&&this.#s===0?t:""}checkFollowGlobstar(){return!(this.#s===0||!this.isGlobstar()||!this.#f)}markFollowGlobstar(){return this.#s===0||!this.isGlobstar()||!this.#f?!1:(this.#f=!1,!0)}}const _l=typeof F=="object"&&F&&typeof F.platform=="string"?F.platform:"linux";class an{relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(t,{nobrace:e,nocase:i,noext:n,noglobstar:s,platform:a=_l}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=a,this.mmopts={dot:!0,nobrace:e,nocase:i,noext:n,noglobstar:s,optimizationLevel:2,platform:a,nocomment:!0,nonegate:!0};for(const o of t)this.add(o)}add(t){const e=new Rt(t,this.mmopts);for(let i=0;i<e.set.length;i++){const n=e.set[i],s=e.globParts[i];if(!n||!s)throw new Error("invalid pattern object");for(;n[0]==="."&&s[0]===".";)n.shift(),s.shift();const a=new Ze(n,s,0,this.platform),o=new Rt(a.globString(),this.mmopts),l=s[s.length-1]==="**",h=a.isAbsolute();h?this.absolute.push(o):this.relative.push(o),l&&(h?this.absoluteChildren.push(o):this.relativeChildren.push(o))}}ignored(t){const e=t.fullpath(),i=`${e}/`,n=t.relative()||".",s=`${n}/`;for(const a of this.relative)if(a.match(n)||a.match(s))return!0;for(const a of this.absolute)if(a.match(e)||a.match(i))return!0;return!1}childrenIgnored(t){const e=t.fullpath()+"/",i=(t.relative()||".")+"/";for(const n of this.relativeChildren)if(n.match(i))return!0;for(const n of this.absoluteChildren)if(n.match(e))return!0;return!1}}class cr{store;constructor(t=new Map){this.store=t}copy(){return new cr(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){const i=t.fullpath(),n=this.store.get(i);n?n.add(e.globString()):this.store.set(i,new Set([e.globString()]))}}class Rl{store=new Map;add(t,e,i){const n=(e?2:0)|(i?1:0),s=this.store.get(t);this.store.set(t,s===void 0?n:n&s)}entries(){return[...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}}class xl{store=new Map;add(t,e){if(!t.canReaddir())return;const i=this.store.get(t);i?i.find(n=>n.globString()===e.globString())||i.push(e):this.store.set(t,[e])}get(t){const e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return[...this.store.keys()].filter(t=>t.canReaddir())}}class qe{hasWalkedCache;matches=new Rl;subwalks=new xl;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new cr}processPatterns(t,e){this.patterns=e;const i=e.map(n=>[t,n]);for(let[n,s]of i){this.hasWalkedCache.storeWalked(n,s);const a=s.root(),o=s.isAbsolute()&&this.opts.absolute!==!1;if(a){n=n.resolve(a==="/"&&this.opts.root!==void 0?this.opts.root:a);const f=s.rest();if(f)s=f;else{this.matches.add(n,!0,!1);continue}}if(n.isENOENT())continue;let l,h,c=!1;for(;typeof(l=s.pattern())=="string"&&(h=s.rest());)n=n.resolve(l),s=h,c=!0;if(l=s.pattern(),h=s.rest(),c){if(this.hasWalkedCache.hasWalked(n,s))continue;this.hasWalkedCache.storeWalked(n,s)}if(typeof l=="string"){const f=l===".."||l===""||l===".";this.matches.add(n.resolve(l),o,f);continue}else if(l===J){(!n.isSymbolicLink()||this.follow||s.checkFollowGlobstar())&&this.subwalks.add(n,s);const f=h?.pattern(),u=h?.rest();if(!h||(f===""||f===".")&&!u)this.matches.add(n,o,f===""||f===".");else if(f===".."){const m=n.parent||n;u?this.hasWalkedCache.hasWalked(m,u)||this.subwalks.add(m,u):this.matches.add(m,o,!0)}}else l instanceof RegExp&&this.subwalks.add(n,s)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new qe(this.opts,this.hasWalkedCache)}filterEntries(t,e){const i=this.subwalks.get(t),n=this.child();for(const s of e)for(const a of i){const o=a.isAbsolute(),l=a.pattern(),h=a.rest();l===J?n.testGlobstar(s,a,h,o):l instanceof RegExp?n.testRegExp(s,l,h,o):n.testString(s,l,h,o)}return n}testGlobstar(t,e,i,n){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,n,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(i&&e.checkFollowGlobstar()?this.subwalks.add(t,i):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),i){const s=i.pattern();if(typeof s=="string"&&s!==".."&&s!==""&&s!==".")this.testString(t,s,i.rest(),n);else if(s===".."){const a=t.parent||t;this.subwalks.add(a,i)}else s instanceof RegExp&&this.testRegExp(t,s,i.rest(),n)}}testRegExp(t,e,i,n){e.test(t.name)&&(i?this.subwalks.add(t,i):this.matches.add(t,n,!1))}testString(t,e,i,n){t.isNamed(e)&&(i?this.subwalks.add(t,i):this.matches.add(t,n,!1))}}const Tl=(r,t)=>typeof r=="string"?new an([r],t):Array.isArray(r)?new an(r,t):r;class ds{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#t=[];#e;#s;signal;maxDepth;includeChildMatches;constructor(t,e,i){if(this.patterns=t,this.path=e,this.opts=i,this.#s=!i.posix&&i.platform==="win32"?"\\":"/",this.includeChildMatches=i.includeChildMatches!==!1,(i.ignore||!this.includeChildMatches)&&(this.#e=Tl(i.ignore??[],i),!this.includeChildMatches&&typeof this.#e.add!="function")){const n="cannot ignore child matches, ignore lacks add() method.";throw new Error(n)}this.maxDepth=i.maxDepth||1/0,i.signal&&(this.signal=i.signal,this.signal.addEventListener("abort",()=>{this.#t.length=0}))}#n(t){return this.seen.has(t)||!!this.#e?.ignored?.(t)}#o(t){return!!this.#e?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=this.#t.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#t.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||await t.realpath(),!i)return;t=i}const s=t.isUnknown()||this.opts.stat?await t.lstat():t;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){const a=await s.realpath();a&&(a.isUnknown()||this.opts.stat)&&await a.lstat()}return this.matchCheckTest(s,e)}matchCheckTest(t,e){return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!t.isSymbolicLink()||!t.realpathCached()?.isDirectory())&&!this.#n(t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||t.realpathSync(),!i)return;t=i}const s=t.isUnknown()||this.opts.stat?t.lstatSync():t;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){const a=s.realpathSync();a&&(a?.isUnknown()||this.opts.stat)&&a.lstatSync()}return this.matchCheckTest(s,e)}matchFinish(t,e){if(this.#n(t))return;if(!this.includeChildMatches&&this.#e?.add){const s=`${t.relativePosix()}/**`;this.#e.add(s)}const i=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);const n=this.opts.mark&&t.isDirectory()?this.#s:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(i){const s=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(s+n)}else{const s=this.opts.posix?t.relativePosix():t.relative(),a=this.opts.dotRelative&&!s.startsWith(".."+this.#s)?"."+this.#s:"";this.matchEmit(s?a+s+n:"."+n)}}async match(t,e,i){const n=await this.matchCheck(t,i);n&&this.matchFinish(n,e)}matchSync(t,e,i){const n=this.matchCheckSync(t,i);n&&this.matchFinish(n,e)}walkCB(t,e,i){this.signal?.aborted&&i(),this.walkCB2(t,e,new qe(this.opts),i)}walkCB2(t,e,i,n){if(this.#o(t))return n();if(this.signal?.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2(t,e,i,n));return}i.processPatterns(t,e);let s=1;const a=()=>{--s===0&&n()};for(const[o,l,h]of i.matches.entries())this.#n(o)||(s++,this.match(o,l,h).then(()=>a()));for(const o of i.subwalkTargets()){if(this.maxDepth!==1/0&&o.depth()>=this.maxDepth)continue;s++;const l=o.readdirCached();o.calledReaddir()?this.walkCB3(o,l,i,a):o.readdirCB((h,c)=>this.walkCB3(o,c,i,a),!0)}a()}walkCB3(t,e,i,n){i=i.filterEntries(t,e);let s=1;const a=()=>{--s===0&&n()};for(const[o,l,h]of i.matches.entries())this.#n(o)||(s++,this.match(o,l,h).then(()=>a()));for(const[o,l]of i.subwalks.entries())s++,this.walkCB2(o,l,i.child(),a);a()}walkCBSync(t,e,i){this.signal?.aborted&&i(),this.walkCB2Sync(t,e,new qe(this.opts),i)}walkCB2Sync(t,e,i,n){if(this.#o(t))return n();if(this.signal?.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,i,n));return}i.processPatterns(t,e);let s=1;const a=()=>{--s===0&&n()};for(const[o,l,h]of i.matches.entries())this.#n(o)||this.matchSync(o,l,h);for(const o of i.subwalkTargets()){if(this.maxDepth!==1/0&&o.depth()>=this.maxDepth)continue;s++;const l=o.readdirSync();this.walkCB3Sync(o,l,i,a)}a()}walkCB3Sync(t,e,i,n){i=i.filterEntries(t,e);let s=1;const a=()=>{--s===0&&n()};for(const[o,l,h]of i.matches.entries())this.#n(o)||this.matchSync(o,l,h);for(const[o,l]of i.subwalks.entries())s++,this.walkCB2Sync(o,l,i.child(),a);a()}}class ln extends ds{matches=new Set;constructor(t,e,i){super(t,e,i)}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((t,e)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}}class hn extends ds{results;constructor(t,e,i){super(t,e,i),this.results=new Be({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){const t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end())}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}}const Ol=typeof F=="object"&&F&&typeof F.platform=="string"?F.platform:"linux";class jt{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=Sn(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.includeChildMatches=e.includeChildMatches!==!1,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(l=>l.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(l=>l.includes("/")?l:`./**/${l}`)}if(this.pattern=t,this.platform=e.platform||Ol,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{const l=e.platform==="win32"?lr:e.platform==="darwin"?fs:e.platform?hr:bl;this.scurry=new l(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;const i=this.platform==="darwin"||this.platform==="win32",n={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:i,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},s=this.pattern.map(l=>new Rt(l,n)),[a,o]=s.reduce((l,h)=>(l[0].push(...h.set),l[1].push(...h.globParts),l),[[],[]]);this.patterns=a.map((l,h)=>{const c=o[h];if(!c)throw new Error("invalid pattern object");return new Ze(l,c,0,this.platform)})}async walk(){return[...await new ln(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new ln(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new hn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new hn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}const Al=(r,t={})=>{Array.isArray(r)||(r=[r]);for(const e of r)if(new Rt(e,t).hasMagic())return!0;return!1};function Xe(r,t={}){return new jt(r,t).streamSync()}function ps(r,t={}){return new jt(r,t).stream()}function ms(r,t={}){return new jt(r,t).walkSync()}async function cn(r,t={}){return new jt(r,t).walk()}function Qe(r,t={}){return new jt(r,t).iterateSync()}function gs(r,t={}){return new jt(r,t).iterate()}const Ml=Xe,Cl=Object.assign(ps,{sync:Xe}),Ll=Qe,jl=Object.assign(gs,{sync:Qe}),Pl=Object.assign(ms,{stream:Xe,iterate:Qe}),un=Object.assign(cn,{glob:cn,globSync:ms,sync:Pl,globStream:ps,stream:Cl,globStreamSync:Xe,streamSync:Ml,globIterate:gs,iterate:jl,globIterateSync:Qe,iterateSync:Ll,Glob:jt,hasMagic:Al,escape:Kn,unescape:qt});un.glob=un;const{join:fn,normalize:kl}=bn,Dl=r=>({factory:t,visitChildren:e,currentNode:i})=>q.ts.isImportDeclaration(i)&&q.ts.isStringLiteral(i.moduleSpecifier)&&i.moduleSpecifier.text==="pardon"?t.createImportDeclaration(i.modifiers,i.importClause,i.moduleSpecifier,t.createImportAttributes(t.createNodeArray([t.createImportAttribute(t.createIdentifier("parent"),t.createStringLiteral(r)),...i.attributes?.elements??[]]))):i.kind===q.ts.SyntaxKind.SourceFile?e():i,$l=r=>({factory:t,visitChildren:e,currentNode:i})=>{if(!r)return i;if(q.ts.isImportDeclaration(i)||q.ts.isExportDeclaration(i)){if(!i.moduleSpecifier||!q.ts.isStringLiteral(i.moduleSpecifier)||!i.moduleSpecifier.text.startsWith("pardon:"))return e();if(q.ts.isImportDeclaration(i))return t.createImportDeclaration(i.modifiers,i.importClause,i.moduleSpecifier,t.createImportAttributes(t.createNodeArray([t.createImportAttribute(t.createIdentifier("identity"),t.createStringLiteral(r)),...i.attributes?.elements??[]])));if(!i.isTypeOnly)return t.createExportDeclaration(i.modifiers,!1,i.exportClause,i.moduleSpecifier,t.createImportAttributes(t.createNodeArray([t.createImportAttribute(t.createIdentifier("identity"),t.createStringLiteral(r))])))}return e()};function Nl({collection:{data:r,scripts:t}}){const e=new q.Project({compilerOptions:{outDir:"memory",module:q.ts.ModuleKind.ES2022,target:q.ts.ScriptTarget.ES2022,lib:["lib.es2022.d.ts"],allowJs:!0,noCheck:!0,strict:!1,rootDir:"/",noEmitOnError:!0,inlineSourceMap:!0},useInMemoryFileSystem:!0});i.cache={};function i(o,l){if(i.cache[o])return i.cache[o];const h=t.identities[o],c=e.createSourceFile(o,l,{scriptKind:o.endsWith(".js")?q.ts.ScriptKind.JS:q.ts.ScriptKind.TS}).transform(Fs).transform(Dl(o)).transform($l(h)).asKind(q.ts.SyntaxKind.SourceFile),f=[...c?.getExportedDeclarations().entries()??[]].filter(([,u])=>u.some(m=>!((m.getSymbol()?.getValueDeclaration()?.getFlags()??q.ts.SymbolFlags.Transient)&q.ts.SymbolFlags.Transient))).map(([u])=>u);return i.cache[o]={compiled:c,exports:f}}return{compile:a,resolveModule:ws,resolve:de,import:n};async function n(o,l){const h=de(o,l);return await Vo(()=>import(h))}function s(o,l){let[,h,c]=/^([^?]*)(?:[?](.*))?$/.exec(o);if(h.startsWith("file:///")){const u=new URL(h).pathname;if(t.identities[u]){const{identity:m}=l.importAttributes;if(!m)throw new Error("illegal direct import of exported script");if(m!==t.identities[u])throw new Error("improper import of exported script");return{resolution:u,identity:m}}return{resolution:u}}if(!h.startsWith("pardon:"))return{resolution:h};h=h.replace(/[.][tj]s$/,"");const f=t.resolutions[h];if(f)return c?{resolved:f,index:Number(c),identity:h}:{resolved:f,index:f.length,identity:h};throw new lt(`${h}: unresolved`)}function a(o,l){if(o in r)return`export default (${he.stringify(r[o].values??null)});`;const{resolution:h,resolved:c,identity:f,index:u}=s(o,l);if(h&&!h.startsWith("pardon:")&&!h.endsWith(".https")){const m=$s();return i(h,m)?.compiled.transform(({currentNode:g,visitChildren:v,factory:S})=>l.importAttributes.parent?q.ts.isPropertyAccessExpression(g)&&q.ts.isMetaProperty(g.expression)&&g.name.text==="parent"?S.createStringLiteral(l.importAttributes.parent):v():g).asKind(q.ts.SyntaxKind.SourceFile)?.getEmitOutput()?.getOutputFiles()[0].getText()}if(c){const m=new Set;return c.slice(0,u).reverse().map(({path:y,content:g})=>({path:y,exports:i(y,g).exports.filter(v=>m.has(v)?!1:m.add(v))})).reverse().map(({path:y,exports:g},v)=>`export { ${g.join(", ")} } from ${he.stringify(Ns(y))} with { identity: ${he.stringify(`${f}?${v}`)} };`).join(`
`)}throw new Error(`${c}: compiler confused what to do here`)}}function de(r,t){return ws(r,t)}function ws(r,t){if(!q.ts.isExternalModuleNameRelative(r))return kl(r);if(!t.startsWith("pardon:"))return fn(t,r);const e=fn(t.replace("pardon:","__pardon__/"),r);if(q.ts.isExternalModuleNameRelative(e)&&!e.startsWith("__pardon__/"))throw new Error("module cannot escape a collection: "+r+" from "+t);return e.replace("__pardon__/","pardon:")}const{promise:Fl,resolution:Wh}=Lo();function Il(){return Fl}function Wl(){const r=[];return{memory:r,learn(t,e){r.push([t,e])},recall(t,...e){const i=r.reduce((n,[s,a])=>(Object.entries(s).every(([o,l])=>t[o]===l)&&Object.assign(n,a),n),{});return e.length===1?i[e[0]]:i}}}function ys(r){const{secrets:t}=r.environment.app??{};function e(n,...s){return n=Bl(n),t?.recall(n,...s)}function i(n){return new Proxy({},{set(s,a,o){if(typeof a!="string")return!1;const l=a==="*"?o:{[a]:o};return t?.learn(n,l),!0},get(s,a){return typeof a!="string"?s[a]:e({...r.environment.contextValues,...r.evaluationScope.resolvedValues(),...n},a)}})}return new Proxy(()=>{},{apply(n,s,a){return i(a[0])},get(n,s){if(s!=="then")return s===Symbol.toPrimitive?()=>{}:typeof s!="string"?n[s]:e({...r.environment.contextValues,...r.evaluationScope.resolvedValues()},s)},set(){return!1}})}function Bl(r){return ht(ht(r,{select:t=>$e(t)}),String)}function ql(r){return ht(r,{filter(t,e){return typeof e=="string"||typeof e=="number"},values:String})}function pt({app:r,endpoint:t,values:e={},secrets:i={},runtime:n={},options:s,context:a}){const o=new Gi({app:r,name:t.configuration.name,config:t.configuration.config,defaults:t.configuration.defaults,input:e,runtime:{false:!1,true:!0,null:null,String,Number,Math,Date,Boolean(l){return l instanceof Number?!!Number(l):!!l},BigInt(l){return l instanceof Number?BigInt(l.source??l):BigInt(l)},...n},resolve(l,{name:h,scoped:c}){return e[h]??i[h]??vs(h,t?.configuration?.defaults,l)},resolvedDefaults(l){return Hl(l,t?.configuration?.defaults)},evaluate(l,h){return l==="secrets"&&h.environment.app?.secrets?ys(h):(h.evaluationScope.imported(l,h),Wi(l,t.configuration,r.compiler))},async redact(l,h){if(s?.secrets)return l;if(h){const c=h?.find(Gl);if(!c)return l;if(!$e(l)&&!fi(c))return"{{redacted}}";const f=$e(l)&&!fi(c)?Xs(c,String(l)):[l];if(!f)return"{{redacted}}";const u=await Promise.all(f.map(async(m,y)=>{const g=c.vars[y],{param:v,redactor:S}=g;if(He(g)||S){if(S)return(await Wi(S,t.configuration,r.compiler)??n[S])(m,g.param,l);const x=await Wi(`redact$${v}`,t.configuration,r.compiler)??n[`redact$${v}`];return typeof x=="function"?x(m,g.param,l):`{{ @${v??""} }}`}return m}));return fi(c)?u[0]:Qs(c,u)}return"{{redacted}}"},async express({source:l,identifier:h,evaluation:c}){return c()},options(l){return s?.[l]},get extendedContext(){const{service:l,action:h,configuration:{name:c}}=t;return{service:l,action:h,endpoint:c}}});return o.choose(o.implied(ql(e),a)),o}function vs(r,t,e){let i=t?.[r];const n=[r];for(;i&&typeof i=="object";){const[s,...a]=Object.keys(i);if(a.length)throw new Error(`invalid defaults: ${n.join("/")}`);const o=i[s],l=Us(e,s)??e.environment.implied({})[s];if(n.push(`${s}=${o?.[String(l)]?l:"default"}`),i=o?.[l??"default"]??o?.default,i===null)return;if(i===void 0){if(e.mode==="render")throw new lt(`unresolved default: ${n.join("/")}`);break}}return i}function Wi(r,t,e){return Ul(r,t,e,`pardon:${t.path}`)}async function Ul(r,t,e,i){const n=zl(r,t);if(n){const s=await e.import(n.specifier,i);return n.import==="*"?s:s[n.import]}}function zl(r,{import:t={}}){for(const[e,i]of Object.entries(t)){if(typeof i=="string"){if(i===r)return{specifier:e,import:"*"};continue}for(const n of i){let[s,a]=n.split(/\s+as\s+/,2);if(a??(a=s),a.trim()===r)return{specifier:e,import:s.trim()}}}return null}function Gl(r){return to(r)&&r.vars.some(He)}function Hl(r,t){return ue(Object.keys(t??{}),e=>{const i=vs(e,t,r)??null;return typeof i!="object"&&{[e]:i}})}function Vl(r){return Object.entries(r).map(([t,e])=>{switch(!0){case/[/](service|config)[.]yaml$/.test(t):return{type:"config",name:t,id:t.replace(/[/](service|config)[.]yaml$/,""),source:e};case/[.](yaml|json)$/.test(t):{const i=`pardon:${t.replace(/[.](yaml|json)$/,"")}`;return{type:"data",name:t,id:i,source:e}}case/[.](mix(?:in)?)[.](https)$/.test(t):return{type:"mixin",name:t,id:`pardon:${t}`,source:e};case/[.]flow[.]https$/.test(t):return{type:"flow",name:t,id:t.replace(/[.]https$/,""),source:e};case/[.]https$/.test(t):return{type:"endpoint",name:t,id:t.replace(/[.]https$/,""),source:e};case/[.]flow[.][tj]s$/.test(t):return{type:"script",subtype:"flow",name:t,id:`pardon:${t.replace(/[.][tj]s$/,"")}`,source:e};case/[.][tj]s$/.test(t):return{type:"script",name:t,id:`pardon:${t.replace(/[.][tj]s$/,"")}`,source:e};default:return{type:"unknown",name:t,id:t,source:e}}})}function Kl(r,t){return r?r.push(t):r=[t],r}function Yl(...r){return r.reduce((t,e)=>Object.assign(t,ht(e,(i,n)=>Kl(t[n],i))),{})}function dn(r){switch(r){case"config":return 0;default:return 1}}function Jl(r){const t=r.map(({files:s})=>Vl(s)),e=r.flatMap(({files:s})=>Object.values(s)).reduce((s,{path:a,content:o})=>Object.assign(s,{[a]:o}),{}),i={collections:r,filesystem:e},n={configurations:{},endpoints:{},data:{},mixins:{},assets:{},scripts:{resolutions:{},identities:{}},errors:[]};for(const s of Object.values(Yl(...t.map(a=>ue(a,({type:o,id:l,...h})=>({[`${o}:${l}`]:{type:o,id:l,...h}}))))).sort(([{type:a}],[{type:o}])=>dn(a)-dn(o))){const{type:a,name:o,id:l}=s[0],h=s.map(({source:c})=>c);switch(n.assets[l]={type:a,sources:h,name:o},a){case"config":th({collection:n,source:i,id:l});break;case"endpoint":Ss({collection:n,source:i,id:l});break;case"data":eh({collection:n,id:l});break;case"mixin":ih({collection:n,id:l});break;case"script":rh({collection:n,id:l});break}}return Zl({collection:n,source:i}),Xl(n),n}function Zl({collection:r,source:t}){const{endpoints:e,configurations:i,assets:n}=r,s={},a="//fallback/defaults";t.collections.push({root:a,files:s});for(const[o,{name:l}]of Object.entries(i))if(/[/]service[.]yaml$/.test(l)&&!e[[o,"default"].join("/")]){const h=[o,"default"].join("/"),c=`${h}.https`,f=`${a}/${c}`,u=`>>>
ANY //`;s[h]={path:c,content:u},t.filesystem[f]=u,n[h]={name:c,sources:[{path:f,content:u}],type:"endpoint"},Ss({collection:r,source:t,id:h})}}function Xl({endpoints:r,data:t}){for(const[e,i]of Object.entries(r)){const{defaults:n}=e.split("/").reduce(({path:s,defaults:a},o)=>(s.push(o),{path:s,defaults:Kt(a,t[[...s,"defaults"].join("/")]||{})}),{path:[],defaults:{}});i.configuration.defaults=Kt(i.configuration.defaults,n)}}function Kt(r,t,e={merge:Kt,mix:(i,n)=>n??i}){return typeof r=="object"&&typeof t=="object"&&r&&t&&!Array.isArray(r)&&!Array.isArray(t)?{...r,...t,...ue(Object.keys(r??{}).filter(i=>(t??{})[i]!==void 0),i=>({[i]:e.merge((r??{})[i],(t??{})[i],e)}))}:typeof r>"u"?t:e.mix(r,t)}function bs(r,t,e,i,n){var s,a,o;if(n?.export){const l=_n(xn(i),Gs(n.path,n.export)),h=(s=t.resolutions)[a=`pardon:${r}`]??(s[a]=[]),c=`pardon:${r}?${h.length}`;if(l in e){if(((o=t.identities)[l]??(o[l]=c))!==c)throw new lt(`cannot reidentify ${l} from ${t.identities[l]} to ${c}`);return h.push({path:l,content:e[l]}),!0}}}function Ql(r,t){const e=[],i=[];let n;for(const s of r.split("/")){e.push(s);const a=e.join("/"),o=t[a];o&&(o.type==="service"&&(n=a),i.push(o))}return{service:n,configuration:ge({name:r,configurations:i,mixing:!1})}}function th({collection:{configurations:r,assets:t,scripts:e,errors:i},source:{collections:n,filesystem:s},id:a}){const{name:o}=t[a];r[a]=n.reduce((l,{files:h,root:c})=>{const{content:f,path:u}=h[`${a}/service.yaml`]??h[`${a}/config.yaml`]??{},m=u?nh({content:f,name:o,path:u},i):void 0,y=[l,m].filter(Boolean);if(y.length===0)return null;const g=ge({name:o,configurations:y});return!bs(a,e,s,u??_n(c,g.name),g)&&m?.export&&console.warn(`export: could not resolve direct reference to ${m.export} from ${u}`),g},null)}function Ss({collection:{configurations:r,assets:t,scripts:e,endpoints:i,errors:n},source:{filesystem:s},id:a}){const{name:o,sources:l}=t[a],{service:h,configuration:{export:c,...f}}=Ql(a,r);i[a]=l.reduce((u,{content:m,path:y})=>{const{steps:g,configuration:v}=ti(y,()=>Rn.parse(m),n,()=>({mode:"merge",configuration:{},steps:[]}));return u.configuration=ge({name:o.replace(/[.]https$/,""),configurations:[u.configuration,v].filter(Boolean)}),!bs(a,e,s,y,u.configuration)&&v?.export&&console.warn(`export: could not resolve direct reference to ${v.export} from ${y}`),u.layers.push({path:y,steps:g}),u},{service:h,action:a.split("/").slice(-1)[0],configuration:f,layers:[]})}function eh({collection:{assets:r,data:t,errors:e},id:i}){const{sources:n}=r[i];t[i]=n.reduce((s,{content:a,path:o})=>({values:ti(o,()=>Kt(s.values,o.endsWith(".json")?he.parse(a):Tn(a)),e,()=>s.values)}),{values:{}})}function ih({collection:{assets:r,mixins:t,errors:e},id:i}){const{name:n,sources:s}=r[i],[,a]=/[.]mix(?:in)?[.]https$/.exec(n);t[i]=s.reduce((o,{content:l,path:h})=>{const{steps:c,configuration:f}=ti(h,()=>Rn.parse(l,a),e,()=>({configuration:{},mode:a,steps:[]}));return o.configuration=ge({name:n,configurations:[o.configuration,f].filter(Boolean)}),o.layers.push({path:h,steps:c}),o},{configuration:void 0,layers:[],mode:a})}function rh({collection:{assets:r,scripts:t},id:e}){var i;const{sources:n}=r[e];if(n.some(({path:s})=>t.identities[s])){n.every(({path:s})=>t.identities[s])||console.warn(`inconsistent usage of script ${e}`);return}for(const{path:s,content:a}of n){const o=(i=t.resolutions)[e]??(i[e]=[]);t.identities[s]=`${e}?${o.length}`,o.push({path:s,content:a})}}function nh({content:r,name:t,path:e},i){const n=ti(e,()=>Tn(r),i,()=>({})),[,s,a]=/^(.*)[/](service|config)[.]yaml$/.exec(t);return{...n,type:a,name:s,path:e}}function ge({name:r,configurations:t,mixing:e}){const i=`pardon:${xn(r)}`;return{...t.filter(Boolean).reduce((s,{config:a,defaults:o,import:l,export:h,mixin:c,type:f})=>({config:zs(a,s.config),defaults:e?Kt(o??{},s.defaults):Kt(s.defaults,o??{}),import:Object.assign({},s.import,ht(l||{},{keys:u=>de(u,i),values:(u,m)=>{let y=s.import?.[m];return y?(typeof y=="string"?(typeof u=="string"&&(u=[`* as ${u}`]),y=[`* as ${y}`]):Array.isArray(y)&&typeof u=="string"&&(u=[`* as ${u}`]),[...y.filter(g=>!u.includes(g)),...u]):u}})),export:h?de(h,i):s.export,mixin:[...sh(s,c,i),...s.mixin||[]],type:s.type==="service"||f==="service"?"service":"config"}),{config:[{}],defaults:{},import:{},mixin:[]}),name:r,path:i}}function sh(r,t,e){return[t||[]].flat(1).map(i=>de(i,e)).filter(i=>![r.mixin].filter(Boolean).flat(1).includes(i))}function ti(r,t,e,i){try{return t()}catch(n){return console.warn(`${r}: error loading`,n),e.push({path:r,error:new lt(`${r}: error loading`,n)}),i()??(()=>{throw n})()}}var oh=Object.defineProperty,ah=(r,t,e)=>t in r?oh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ne=(r,t,e)=>ah(r,typeof t!="symbol"?t+"":t,e);class ei{constructor({schema:t,object:e,context:i,values:n,match:s}){ne(this,"object"),ne(this,"schema"),ne(this,"context"),ne(this,"values"),ne(this,"match"),this.schema=t,this.object=e,this.context=i,this.values=n,this.match=s}extend(t,e){const i=Et({mode:"merge",phase:"build",...t.meta},this.schema,t,e.environment),n=i.schema&&Et({mode:this.match?"match":"merge",phase:"validate",...this.object?.meta},i.schema,this.object,e.environment);return n?.schema&&!n.context.environment.exhausted()?{matching:n,progress:new ei({schema:i.schema,context:i.context,object:this.object,values:{...e.values,...this.values}})}:{matching:{...i,schema:void 0}}}}var lh=Object.defineProperty,hh=(r,t,e)=>t in r?lh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ft=(r,t,e)=>hh(r,typeof t!="symbol"?t+"":t,e);function ch(r,t){return t.endpoint==="-/-"?[{action:"-",service:"-",configuration:{name:"-",config:[{}],path:"-"},layers:[{path:"-",steps:[{type:"request",computations:{},values:{},request:{headers:new Headers}}]}]}]:Object.values(r).filter(({configuration:{name:e},service:i})=>t.endpoint?t.endpoint===e:`${i}/default`!==e).filter(({service:e})=>t.service?t.service===e:t.endpoint||e!=="default").filter(({action:e})=>!t.action||t.action===e)}function uh(r,t){return Object.values(r).filter(({service:e})=>t.service?t.service===e:e!=="default").filter(({configuration:{name:e},service:i})=>`${i}/default`===e).filter(({action:e})=>!t.action||t.action===e)}class fh{constructor(t,e,i){ft(this,"context"),ft(this,"request"),ft(this,"endpoint"),ft(this,"responseLayers",[]),ft(this,"acceptedMixins",[]),ft(this,"todoMixins",[]),ft(this,"implied"),ft(this,"archetypeSchema"),ft(this,"requestSchema"),ft(this,"requestContext"),this.context=t,this.request=e,this.endpoint=i,this.implied=ph(t.values),this.archetypeSchema=Hi()}match(){const{endpoint:{configuration:{name:t,...e},layers:i}}=this,n=this.applyLayers({configuration:e,layers:i,specifier:t});if(n){for(n.match.requestSchema&&this.acceptSlice(n);this.todoMixins.length;){const s=this.todoMixins.shift(),a=this.applyLayers(s);a&&a.match.matcher&&(this.acceptedMixins.push(s.specifier),this.acceptSlice(a))}if(this.requestContext&&this.requestSchema){const{requestSchema:s,requestContext:a,endpoint:o,responseLayers:l,acceptedMixins:h,endpoint:{service:c,action:f},context:{values:u},implied:m}=this;return{schema:s,context:a,endpoint:{...o,configuration:{...o.configuration,mixin:h,name:t}},service:c,action:f,layers:l,values:{...a?.environment.implied(m),...u}}}return{diagnostics:n.match.mismatchContext?.diagnostics,endpoint:this.endpoint}}}applyLayers({configuration:t,layers:e}){const{context:{app:i},requestContext:n,implied:s,archetypeSchema:a}=this,o={...this.endpoint,configuration:ge({name:this.endpoint.configuration.name,configurations:[this.endpoint.configuration,t],mixing:!0})};if(n&&pt({endpoint:o,app:i(),values:{...s,...this.context.values}}).init({context:n}).choose(s).exhausted())return!1;const l=pt({app:i(),endpoint:o,values:{...s,...this.context.values},context:n}),h=new ei({schema:a,object:this.request,context:n,values:{...s,...this.context.values}}),c=this.matchLayers({environment:l,implied:s,layers:e,matcher:h});if(c)return{match:c,endpoint:o}}matchLayers({implied:{...t},environment:e,layers:i,matcher:n}){const{request:s}=this;let a,o,l;return i=mn(i),i.every(({steps:c})=>{if(!c.some(je))return!0;for(;c.length;){const f=c.shift();if(!je(f)||t.variant&&f.variant&&t.variant!=f.variant||s.method!==void 0&&f.request.method!==void 0&&s.method!==f.request.method)continue;const u=n.extend({...f.request,computations:f.computations},{environment:e,values:f.values});if(u?.matching.schema){f.variant&&(t.variant??(t.variant=f.variant)),n=u.progress,a=u.matching.schema,o=u.matching.context;const{context:m,error:y}=u.matching;if(y)throw y;return Object.assign(t,m.environment.implied(t,m)),!0}l??(l=u?.matching.context)}return!1})?{matcher:n,requestSchema:a,requestContext:o,implied:t,layers:i}:{mismatchContext:l}}acceptSlice({match:{requestSchema:t,requestContext:e,layers:i,matcher:n,implied:s},endpoint:a}){const{todoMixins:o,context:{app:l},endpoint:{configuration:{name:h}}}=this,{compiler:c,collection:f}=l();this.archetypeSchema=n.schema,e&&(this.requestSchema=t,this.requestContext=e),this.endpoint=a;const u=a.configuration.mixin;a.configuration.mixin=[],Object.assign(this.implied,n.values,s),this.responseLayers.push(...i.map(({steps:y,...g})=>({steps:y.filter(v=>!je(v)),...g,configuration:a.configuration})));const m=[];for(const{mixin:{configuration:y,layers:g},specifier:v}of[u||[]].flat(1).map(S=>{const x=c.resolveModule(S,a.configuration.path??h);if(!f.mixins[x])throw console.error(new Error("mixin not found: "+x)),new Error("mixin not found: "+x);return{mixin:f.mixins[x],specifier:S}}))m.push({configuration:y,layers:mn(g),specifier:v});o.unshift(...m)}}function Bi(r,t,e){try{const i=new fh(r,t,e).match();return i?.schema?{status:"fulfilled",value:i}:{status:"rejected",reason:i?.diagnostics}}catch(i){return{status:"rejected",reason:i}}}function pn(r){return r.filter(t=>t.status==="fulfilled").map(({value:t})=>t).filter(Boolean).length>0}function dh(r,t){const{values:e,app:i}=t,{endpoints:n}=i().collection,s=ch(n,e).map(o=>Bi(t,r,o));if(pn(s)||t.values.endpoint)return s;const a=uh(n,e).map(o=>Bi(t,r,o));return pn(a)||t.values.service||t.values.action?a:n["default/default"]?[Bi(t,r,n["default/default"])]:[]}function ph(r){return ht(r,{values:String,select:$e})}function mn(r){return r.map(({steps:[...t],...e})=>({...e,steps:t}))}const mh=(r,{context:t,fetchObject:e})=>{if(r.length!==1){const i=r.map(({endpoint:{configuration:{name:s}}})=>s),n=["pathname","origin"];for(const s of n){const{template:a}=Vi(e[s]??""),o=r.filter(({endpoint:{layers:l}})=>l.flatMap(({steps:h})=>h.filter(je)).some(({request:{[s]:h}})=>h&&Vi(h).template===a));if(o.length===1){r=o;break}}if(r.length===1)return r[0];throw new lt(`${r.length?`ambiguous ask:${i.map(s=>`
 - ${s}`).join("")}
`:`no matches for
`}${e.method??"GET"} ${Lt(e)} (${he.stringify(t.values)})`)}return r[0]};function gh(r){if(r===void 0)return;const{values:t,...e}=Ne.parse(r);return Ne.stringify({...e,values:ur(t??{})})}function wh(r){return{values:ur(r??{}),secrets:yh(r??{})}}function ur(r){return Es(ht(r,{filter:t=>!He(tr(t))}))}function yh(r){return Es(ht(r,{filter:t=>He(tr(t))}))}function Es(r){return ht(r,{keys:t=>tr(t).param})}const Bh=Qo({init({url:r,init:t,values:e,options:i,app:n,ask:s,...a}){const{method:o=e.method,headers:l=[],body:h=void 0,meta:c}=t??{};return{url:r,init:t,...wh(e),options:i,timestamps:{intent:Date.now()},durations:{},app:n,ask:gh(s)??Ne.stringify({...r&&qi(r),method:o,headers:new Headers(l),body:h,values:ur(e),meta:c}),...a}},async match({context:{url:r,init:t,configuration:e,...i}}){if(e){const o=br(r,t),{values:l}=i,h=i.app(),c={action:"flow",layers:[],service:"flow",configuration:e},{schema:f,context:u}=Et({mode:"merge",phase:"build"},Hi(),o,pt({app:h,endpoint:c,values:l}));return{endpoint:c,values:l,schema:f,layers:[],context:u}}const n=br(r,t);if(typeof i.values?.method=="string"&&(n.method??(n.method=i.values.method),i.values.method!==n.method))throw new Error("specified values method does not match reqeust method");if(n.origin&&(n.pathname||(n.pathname="/")),i.options?.unmatched){const{values:o}=i,l=i.app(),h={service:"-",action:"-",layers:[],configuration:{path:"-",name:"-",config:[{}],mixin:[],defaults:{}}},c=Hi(),f=Et({mode:"merge",phase:"build"},c,n,pt({app:l,endpoint:h,values:o}));if(!f.schema)throw Error("unmatched match failure");return{schema:f.schema,context:f.context,endpoint:h,values:o,layers:[]}}const s=dh(n,i);if(s.length===1){const[o]=s;if(o.status==="rejected"){let l=[o.reason].flat()[0];throw l?.err&&(l=l.err),new lt(`error matching ask to endpoint(s): ${l?.stack??l}`)}else if(o.value?.schema===void 0)throw new lt(`error(s) matching ask to ${o.value?.endpoint.configuration.name}:${o.value?.diagnostics?.map(({loc:l,err:h})=>typeof h=="string"?h:h?.stack?.split(`
`).slice(0,2).join(`
  `)??l).join(`
`)}`)}const a=s.filter(o=>o.status==="fulfilled").map(({value:o})=>o).filter(Boolean);return i.select?.(a,{context:i,fetchObject:n})??mh(a,{context:i,fetchObject:n})},async preview({context:r,match:{schema:t,values:e,endpoint:i}}){const{values:n}=r,s=r.app(),a=pt({endpoint:i,values:e,app:s,options:{"pretty-print":!0,secrets:!0}}),o=await vr(t,a),l=o.context.evaluationScope.resolvedValues({secrets:!1}),h=pt({endpoint:i,values:{...e,...l},app:s,options:{"pretty-print":!0,secrets:!1}}),c=await vr(t,h),f=wn(t,c.output,i,s,n);return{request:{...o.output,meta:Fe({...o.output.meta,body:void 0}),values:It(o.context,{secrets:!0})},redacted:{...c.output,meta:Fe({...c.output.meta,body:void 0}),values:It(c.context)},reduced:f,evaluationScope:o.context.evaluationScope}},async render({context:r,match:{schema:t,values:e,endpoint:i,layers:n}}){const{durations:s,runtime:a,options:o,values:l,secrets:h,init:{computations:c}={}}=r,f=r.app(),u=Et({mode:"merge",phase:"build"},t,{computations:Bs(c)});if(!u.schema)throw new lt("unexpected: failed to merge computations into matched schema: "+(u.error??u.context?.diagnostics[0]));t=u.schema;const m=Date.now(),y=pt({endpoint:i,values:e,secrets:h,app:f,runtime:a,options:{"pretty-print":o?.pretty??!1,secrets:!0}}),g=await qs(t,y);for(const{steps:b}of n)for(;b.length&&ui(b[0]);){const R=b.shift();await bh(r,R,{values:{...g.context.environment.contextValues,...g.context.evaluationScope.resolvedValues({secrets:!0}),egress:g.output}})}const v=g.context.evaluationScope.resolvedValues({secrets:!1}),S=pt({endpoint:i,values:{...e,...v},secrets:h,app:f,runtime:{},options:{"pretty-print":o?.pretty??!0,secrets:!1}}),x=Et({mode:"match",phase:"build"},t,g.output,S);x.schema||console.error("failed to redact output: ",x.error??x.context?.diagnostics[0]);const A=await yr(x.schema,S),w=wn(t,A.output,i,f,l);return s.render=Date.now()-m,{request:{...g.output,values:gn(It(g.context,{secrets:!0}))},redacted:{...A.output,values:gn(It(g.context))},reduced:w,evaluationScope:g.context.evaluationScope}},async fetch({context:{timestamps:r},egress:{request:t}}){r&&(r.request=Date.now());const[e,i]=vn(t);i.headers??(i.headers=new Headers),i.headers.append("Connection","close");try{return await Ws(await fetch(e,i))}finally{r.response=Date.now()}},async process({context:r,egress:t,match:e,error:i,ingress:n}){const{layers:s,endpoint:a}=e;if(!n)throw i;const o=r.app(),l=Date.now(),h=n.meta?.body??Is(n.body??"",n.headers)??"raw";let c,f,u=new ei({schema:gr(),match:!0,object:{...n,statusText:n.statusText?.trim()||void 0},values:{}});t:for(const{steps:v}of s)for(;v.length;){if(!v.some(wr))continue t;for(;!wr(v[0]);)v.shift();const S=v.shift(),{status:x,headers:A,body:w,outcome:b,meta:R}=S,T=u.extend({status:x,headers:A,meta:R,...w&&{body:w}},{environment:new Gi});if(T?.progress){u=T.progress,b&&(f??(f=b)),c=T.matching.schema;break}else for(;v.length&&ui(v[0]);)v.shift()}if(!c){const v=gr();c=Et({mode:"match",phase:"build",body:h},v,n,new Gi).schema??v}r.timestamps.response=l,r.durations.request=l-r.timestamps.request;const[m,y]=await Promise.all([{secrets:!0},{secrets:!1}].map(async({secrets:v})=>{const{output:S,context:x}=await yr(c,pt({endpoint:{...a,configuration:{name:a.configuration.name,path:a.configuration.path,import:a.configuration.import,config:[{}]}},app:o,options:{"pretty-print":!0,secrets:v}}));return{context:x,response:S,evaluationScope:x.evaluationScope,values:vh(It(x,{secrets:v}))}})),g=y.evaluationScope.resolvedValues({exportsOnly:!0});for(const{steps:v}of s)for(;v.length&&ui(v[0]);){const S=v.shift(),{service:x,action:A,configuration:{name:w}}=a;await Sh(m.context,S,{values:{service:x,action:A,endpoint:w,...r.values,...t.request.values,...m.values,egress:t.request,ingress:n}})}return{endpoint:a.configuration.path,egress:t,ingress:{actual:n,outcome:f,evaluationScope:m.evaluationScope,response:m.response,secrets:m.values,redacted:y.response,values:y.values},output:g}},error(){}});function gn(r){return On({...r,pathname:void 0,origin:void 0,search:void 0,method:void 0})}function vh(r){return On({...r,status:void 0,statusText:void 0})}function wn(r,t,e,i,n){const s=pt({endpoint:e,values:{},app:i,runtime:{},options:{secrets:!1}}),a={...n};try{const o=Et({mode:"match",phase:"build"},r,t,s);if(o.error)throw o.error;const l=It(o.context);for(const[h,c]of Object.entries(l))try{(a[h]==c||Er(a[h])===Er(c))&&delete a[h]}catch(f){}}catch{}return a}async function bh(r,t,{values:e}){const i=`(() => { ${t.script} ;;; })()`;await En(i,{binding(n){return e[n]??globalThis[n]}})}async function Sh(r,t,{values:e}){const i=`(() => { ${t.script} ;;; })()`;await En(i,{binding(n){return e[n]??globalThis[n]??{get secrets(){return ys(r)}}[n]}})}let De;Il().then(r=>De=r);function qh(r={},t){if(!De)throw new Error("pardon: no pardon runtime context loaded");return Eh({context:{app:()=>De,durations:{},timestamps:{},values:r,...t},execution:De.execution})}function Eh({context:r,execution:t}){const e=(n,...s)=>{const a=String.raw(n,...s),{values:o,...l}=Ne.parse(a,{acceptcurl:r.options?.parsecurl});function h(){return t.init({...r,url:Lt(l),init:{...l},values:Object.assign({},o,r.values??{})})}return Object.assign(()=>h().result,{init(){return h()},preview(){return h().preview},render(){return h().egress},async request(){return(await h().egress).request}})};function i(...[n,s,a]){return{...a,url:n?.toString(),init:{...s,headers:new Headers(s?.headers)},values:Object.assign({},r.values??{}),options:{...r?.options,...a?.options},app:r.app}}return Object.assign(e,{match(...[n,s,a]){return t.match(i(n,s,a))},preview(...[n,s,a]){return t.preview(i(n,s,a))},render(...[n,s,a]){return t.render(i(n,s,a))},fetch(...[n,s,a]){return t.process(i(n,s,a))}})}Promise.resolve();function Uh({config:r,layers:t,database:e,samples:i,example:n,secrets:s}){const a=Jl(t),o=Nl({collection:a});return{config:r,collection:a,compiler:o,database:e,samples:i,example:n,secrets:s??Wl()}}function fr(r){return typeof r!="object"||Ki(r)}function _h(r,t){return Ki(r)&&Ki(t)&&r.source!==void 0&&t.source!==void 0?r.source===t.source:r?.valueOf()===t?.valueOf()}const Q=Symbol("alt"),U=Symbol("gen");function ct(r){if(r.parent){const t=ct(r.parent);return{environment:{...t.environment,...r.environment},defs:{...t.defs,...r.defs}}}return r}let zt=[];function _s(r,t){const e=zt;try{return zt=r,t()}finally{zt=e}}function Rh(r){if(mt(r))return r;const t=[],e=_s(t,r);return t.length&&t[0]!==e?Zi(...t):pe(e)?e:Zi(...t)}function Ue(r){if(mt(r))Ct(r);else if(Array.isArray(r))for(const t of r)Ue(t);else r&&!fr(r)&&Ue(Object.values(r));return r}function Zi(...r){return Ue(r),{async[U](t){for(const{[U]:e}of r)t=await e(t);return t}}}function dr(r,t){return _t({[U]:e=>yt(e,r),...t&&{[Q]:e=>t(e)}})}function mt(r){return r?typeof r=="object"&&typeof r[U]=="function":!1}function pe(r){return r?typeof r=="object"&&typeof r[Q]=="function":!1}function _t(r){const t=ii(r);return mt(t)&&zt?.push(t),t}function ii(r){if(typeof r=="function")return Ct(Rh(r));if(mt(r))return Ct(r);throw new Error(`cannot regenerate ${typeof r} (${r})`)}function Ct(r){const t=zt.indexOf(r);return t!==-1&&zt.splice(t,1),r}async function at(r,t){if(t=ct(t),r=await r,!r||fr(r))return[r];if(typeof r[Q]=="function")return yt(r[Q](t),a=>at(a,t));if(Array.isArray(r)){if(r.length===0)return[[]];const[a,...o]=r,l=[],h=await at(o,t);for(const c of await at(a,t))l.push(h.flatMap(f=>[c,...f]));return l.flat(1)}if(Object.keys(r).length===0)return[{}];const[[e,i],...n]=Object.entries(r),s=n.reduce((a,[o,l])=>Object.assign(a,{[o]:l}),{});return yt(at(i,t),async a=>(await at(s,t)).map(o=>({[e]:a,...o})))}function xh(r,t){return at(t,r)}function Th(r){return t=>{function e(i){return!i||fr(i)?n=>_h(n,i):n=>Object.entries(i).every(([s,a])=>e(a)(n?.[s]))}return e(r)(ct(t).environment)}}function ze(r){return(...t)=>{if(t.length===0)return{[Q]:async()=>[],[U]:async()=>[]};if(t.every(n=>typeof n!="function"&&!mt(n)))return{[Q]:r(...t)};const e=t.map(ii),i=r(...e);return dr(async n=>yt(i(),s=>s[U]([n])))}}function Oh(r){return{[Q]:async t=>[r(t)]}}function zh(r,t){return{[Q]:async e=>yt(at(t,e),i=>r(e,i))}}function Gt(...r){const t=r.map(e=>typeof e=="function"?ii(e):Ct(e));if(t.length===1){if(pe(t[0]))return t[0];if(!mt(t[0]))return Oh(()=>t[0])}if(t.length>1&&!t.every(e=>mt(e)))throw new Error("testcases cannot intepret a non-singular non-generation value");return Ct(Zi(...t))}async function Gh(r,t){const{environment:e}=r;Ue(t);const i=await at(t,r);return(await yt(i,async n=>await at([...Object.entries(e).filter(([s])=>!(s in n)),...Object.entries(n)].reduce((s,[a,o])=>Object.assign(s,{[a]:o}),{}),r))).map(n=>({...r,environment:n}))}function Hh(r,t=[{environment:{},defs:{}}]){return _s([{[U]:async()=>t}],()=>ii(()=>r())[U](t))}function Vh(r,t){typeof r=="boolean"&&(r=(l=>()=>l)(r)),typeof r=="string"&&(r={[r]:t});const e=l=>typeof l=="boolean"?()=>l:Th(l);let i={[U]:async l=>l,[Q]:async()=>[]},n={[U]:async()=>[],[Q]:async()=>[]},s;async function a(l,h){return yt(at(l,h),async c=>{if(typeof c=="function"){const f=ct(h);return a(await c(f.environment,f.defs),h)}return await at(c,h)})}const o=s=_t({async[U](l){return!mt(i)||!mt(n)?l:yt(l,async h=>((await a(r,h)).filter(f=>e(f)(h)).length?i:n)[U]([h]))},async[Q](l){return!pe(i)||!pe(n)?[]:[((await a(r,l)).filter(c=>e(c)(l)).length?i:n)[Q](l)]},then(...l){i=Gt(...l),n=Gt();const{then:h,...c}=o;return Ct(s),_t(s=c)},else(...l){n=Gt(...l);const{then:h,else:c,...f}=o;return Ct(s),_t(s=f)}});return o}function Kh(...r){const t=Gt(...r);return{export:(...e)=>{const i=Gt(...e);return _t({async[U](n){const s=await t[U](n.map(a=>({environment:{},defs:{},parent:a})));return(await i[U](s.map(a=>({environment:{},defs:{},parent:a})))).map(({environment:a,defs:o,parent:l})=>ct({environment:a,defs:o,parent:l.parent}))}})}}}function Yh(r,...t){const e=Gt(...t);return dr(async({defs:i,...n})=>[{defs:{...i,[r]:e},...n}])}function Jh(r){return dr(async t=>{const e=ct(t).defs[r];if(e===void 0)throw new Error(`exe: ${String(r)} - not fun`);return mt(e)?e[U]([t]):[t]},t=>{const e=ct(t).defs[r];if(!pe(e))throw new Error(`exe: ${String(r)} - not a value alternation: `);return e[Q](t)})}function Ah(r=1,t=524287n,e=1337n,i=2n**29n){let n=BigInt(r);return s=>Number(n=(n*t+e*BigInt(s??1))%i)}function Zh(r=1){if(r===0)return()=>{};const t=Ah(r);return _t({async[U](e){const i=[...e];for(let n=i.length-1;n>=0;n--){const s=t()%(n+1);[i[s],i[n]]=[i[n],i[s]]}return i}})}function Xh(r){return _t({async[U](t){return[...t].sort((e,i)=>{const n=ct(e).environment[r],s=ct(i).environment[r];return typeof n=="number"&&typeof s=="number"?n-s:String(n).localeCompare(s)})}})}function Qh(r,t=e=>ct(e).environment){return typeof r=="function"&&(t=r,r=void 0),r??(r="debug"),_t({async[U](e){console.info(`----- cases at ${r} -----`);let i=1;for(const n of e)console.info(` - ${r} (${i++}):`,t(n));return e}})}function tc(r,t){return{async[Q](e){const i=ct(e);return yt(xh(i,r),n=>i.environment[n]??t)}}}async function yt(r,t){return(await Promise.all((await r).map(t))).flat(1)}const ec=Object.assign(ze((...r)=>async()=>r),{apply:ze(r=>async()=>await r)}),ic=Object.assign(ze((...r)=>{if(r.length===0)throw new Error("empty round robin");let t=0;return async()=>(t===r.length&&(t=0),[r[t++]])}),{apply:ze(r=>{let t=0;return async()=>{const e=await r;if(e.length===0)throw new Error("empty round robin");return t===e.length&&(t=0),[e[t++]]}})}),ce=[],Xi=[];function Mh(r){try{const t=r();return typeof t?.then=="function"&&ce.push(zi(t)),t}catch(t){throw ce.push(zi(Promise.reject(t))),t}}async function rc(r){for(;ce.length;)await Promise.all(ce.splice(0,ce.length));return Xi.splice(0,Xi.length).map(({name:t,descriptions:e,definition:i})=>({descriptions:[r.setup,...e,({set:n,format:s,fun:a})=>{const o=Hs(...[r.prefix,...t].filter(Boolean));n("testcase",s(o)),a("trial",`${++jh}/${o}`),n("::testexecution",async l=>(await null,await i(l)))}].filter(Boolean)}))}const me=new Uo;function nc(r){return me.run({name:[],descriptions:[]},r)}function Ch(r){const{descriptions:t}=me.getStore();return t.push(r),{trial(...e){if(t.pop()!==r)throw new Error("cases.trial invoked late");Lh(()=>{Ch(r),Ph(...e)})}}}function Ge(r,t){const e=me.getStore();return Mh(()=>me.run({...e,name:[...e.name||[],...r?[r]:[]],descriptions:[...e.descriptions||[]]},t))}function Lh(r,t){return t?Ge(r,t):Ge(void 0,r)}let jh=0;function yn(r){const{name:t,descriptions:e}=me.getStore();Xi.push({name:t,descriptions:[...e],definition:r})}function Ph(r,t){return t?Ge(r,()=>yn(e=>(environment=e,t(e)))):Ge(void 0,()=>yn(e=>(environment=e,r(e))))}export{xh as A,Mh as B,nc as C,rc as D,Ph as E,Ch as F,Lh as G,Ne as H,Eh as I,Lo as J,Bh as P,Il as a,Ul as b,vs as c,wn as d,qh as e,Qh as f,Hh as g,Xh as h,Wl as i,Zh as j,Jh as k,Kh as l,Yh as m,ct as n,Vh as o,Qo as p,ic as q,Uh as r,Vo as s,ec as t,tc as u,Ue as v,zh as w,Oh as x,dr as y,Gh as z};
