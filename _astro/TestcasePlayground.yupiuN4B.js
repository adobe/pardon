import{e as G,b as d,g as m,t as p,i as g,F as x,o as O,H as V,f as T,S as C,c as q,z,B as te,n as ne,M as se,I as ae}from"./web.Di1l7vN_.js";import{b as oe,v as ie,K as N}from"./index.BDwdYHGq.js";import{g as le,n as S,f as ce,h as J,j as Q,l as j,k as ue,m as fe,o as v,q as de,t as A,u as ge,v as I,w as me,x as F,y as k,z as P,A as pe,B as he,C as be,D as K,E as ye,F as we,G as ve}from"./trial-DPXB9fCI.Dj3pK0Vu.js";import"./schema-utils-qbCEesrZ.D4WS2fP6.js";import{C as D}from"./CodeMirror.DGkncNyo.js";/* empty css                                */import"./api.CbqjR6t5.js";function U(e){if(!e)return;const[,t,r,n]=/^([^~%]*)(?:%([^~]*))?(?:~([0-9]+))?$/.exec(e),s=t.split(",");let a;/^[0-9]+$/.test(s[0])&&(a=Number(s.splice(0,1)));const i=s.map(l=>/^(.*?)(?::([0-9]+))?$/.exec(l)),o=oe(i,([,l,c])=>({[l]:c?Number(c):a??1}));return{smoke:Object.keys(o).length===0?a??1:o,shuffle:n?Number(n):void 0,per:r!==void 0?r.split(",").filter(Boolean):void 0}}function W(e,t){t&&(({smoke:r,exe:n,config:s})=>{r(s.smoke).per(...(s.per??["trial"]).map(a=>a!=="trial"?a:n("trial"))).shuffled(s.shuffle)})({...e,config:t})}function E(e,t){if(typeof e=="string"){const r=e;e=Promise.resolve(t).then(n=>({[r]:n}))}return typeof e=="function"?k(async r=>P(r,await e(S(r).environment))):k(async r=>P(r,await e))}function X(e,t){return typeof e=="string"&&(e={[e]:t}),typeof e=="function"?k(r=>P(r,H(e(r.environment),S(r)))):k(r=>P(r,H(e,S(r))))}function H(e,t){return Object.entries(e).filter(([r])=>!(r in t.environment)).reduce((r,[n,s])=>Object.assign(r,{[n]:s}),{})}function $e(e,t,r){return typeof e=="string"?(r={[e]:r},e={[e]:t},t=void 0):r=t,A(()=>{X(e),v(e).else(()=>{v(r??!1)})})}function B(e,t){return typeof t=="number"||typeof e=="string"?(t??(t=0),E(e,F(()=>t++))):(t=e??0,F(()=>t++))}function _e(e){return typeof e=="function"?e:t=>e.replace(/%([a-z0-9_]+)|%\{([^{}]+)\}|%\(([^()]+)\)|%%/gi,(r,n,s,a)=>r==="%%"?"%":String(t[a??s??n]))}function Y(e,t){if(t&&typeof e!="string")throw new Error("invalid format()");return t?E(()=>({[e]:Y(t)})):me((r,n)=>[_e(n)(r.environment)],e)}function L(e,t){return e?(typeof e=="string"?v(e,t):v(e)).then(v(!1)):v(!1)}function xe(e){j(E({repeat:A(...Array(e))})).export()}function ke(e=ie){const t=new Set;return v(r=>{const n=e(r);return t.has(n)?!1:(t.add(n),!0)})}function je(...e){return k(async({environment:t,...r})=>[{...r,environment:Object.entries(t).filter(([n])=>!e.includes(n)).reduce((n,[s,a])=>Object.assign(n,{[s]:a}),{})}])}function Z(e){j(B("taking")).export(L(({taking:t})=>t>=e))}function ee(e){j(B("skipping")).export(L(({skipping:t})=>t<e))}function Ce(e,{size:t}){ee((e-1)*t),Z(t)}function Oe(...e){const t={},r=e[0],n=o=>typeof r=="number"?r:typeof r=="object"?r[o]??1:1;typeof e[0]!="string"&&(typeof e[0]=="object"?e=Object.keys(e[0]):e=e.slice(1)),e=e.filter(Boolean);function s(...o){return v((l,c)=>{var f;const h={environment:l,defs:c},b=[...o.map(u=>typeof u=="string"?l[u]:Se(h,u))].filter(Boolean).join(":"),$=Object.keys(l).filter(u=>e.includes(u)),y=t[b]??(t[b]={});if(e.length===0?((f=y.count??(y.count={})).count??(f.count=0))<n("default"):$.some(u=>{var _,R;return((_=y[u]??(y[u]={}))[R=l[u]]??(_[R]=0))<n(u)})){if(e.length===0)(y.count??(y.count={})).count++;else for(const u of $)(y[u]??(y[u]={}))[l[u]]++;return!0}})}const a=s();return i(Object.assign(a,{per(...o){return I(a),i(s(...o))}}));function i(o){return Object.assign(o,{shuffled(l){return j(B("shuffle-counter"),Q(l)).export(I(o),J("shuffle-counter"))}})}}async function Se(e,t){const r=await pe(e,t);if(r.length==0)throw new Error("unexpected smoke.per category: no alternates for value");if(r.length>1)throw new Error("unexpected smoke.per category: multiple alternates: "+r);const n=r[0];if(n&&!["string","number","boolean"].includes(typeof n))throw new Error("unexpected smoke.per category type:"+typeof n);return n}const Pe=Object.freeze({set:E,get:ge,def:X,defi:$e,unset:je,each:A,repeat:xe,robin:de,fi:v,stop:L,fun:fe,exe:ue,counter:B,format:Y,unique:ke,local:j,page:Ce,skip:ee,take:Z,smoke:Oe,shuffle:Q,sort:J,debug:ce});async function M(e,t){try{return(await le(()=>e(Pe),t)).map(S)}catch(r){throw console.warn("error describing testcases",r),r}}function Ee(e=69,t=524287n,r=1337n,n=2n**29n){let s=BigInt(e);return a=>Number(s=(s*t+r*BigInt(a??1))%n)}function re(e){const r=[...new TextEncoder().encode(N.stringify(e)).values()].reduce((n,s)=>(n(s),n),Ee())();return`light-dark(hsl(${r%360}, 60%, 87%), hsl(${r%360}, 20%, 17%))`}var Be=p('<div class="relative mt-2 flex max-h-[50vh] overflow-y-hidden rounded-md border border-solid border-gray-500 px-2 shadow-md dark:shadow-gray-500"><div class="absolute top-0 right-0 flex aspect-square min-h-fit min-w-fit place-items-center rounded-bl-md border-0 border-b border-l border-solid border-gray-500 bg-stone-300 p-1 opacity-75 dark:bg-lime-800"></div><div class="grow overflow-y-scroll pr-4"><table class="testcase-table mt-3 mb-2"><thead><tr></tr></thead><tbody>'),Te=p("<div><!$><!/> empty row(s)."),Me=p("<th>"),Ne=p("<tr>"),Ae=p("<td>");function Le(e){const t=G(()=>Object.keys(Object.assign({},...e.rows)).sort());return d(C,{get when(){return t().length},get fallback(){return(()=>{var r=m(Te),n=r.firstChild,[s,a]=T(n.nextSibling);return s.nextSibling,g(r,()=>e.rows.length,s,a),r})()},get children(){var r=m(Be),n=r.firstChild,s=n.nextSibling,a=s.firstChild,i=a.firstChild,o=i.firstChild,l=i.nextSibling;return g(n,()=>e.rows.length),g(o,d(x,{get each(){return t()},children:c=>(()=>{var f=m(Me);return g(f,c),f})()})),g(l,d(x,{get each(){return e.rows},children:c=>(()=>{var f=m(Ne);return g(f,d(x,{get each(){return t()},children:h=>(()=>{var b=m(Ae);return g(b,()=>N.stringify(c[h])),O($=>V(b,"background-color",re(c[h]))),b})()})),f})()})),O(c=>{var f=!!e.error,h=!!e.error;return f!==c.e&&r.classList.toggle("opacity-50",c.e=f),h!==c.t&&a.classList.toggle("error",c.t=h),c},{e:void 0,t:void 0}),r}})}var Re=p('<div class="relative mt-2 max-h-[50vh] overflow-y-hidden rounded-md border border-solid border-gray-500 px-2 shadow-md dark:shadow-gray-500"><div class="absolute top-0 right-0 flex aspect-square min-h-fit min-w-fit place-items-center rounded-bl-md border-0 border-b border-l border-solid border-gray-500 bg-gray-300 p-1 opacity-75 dark:bg-lime-800"></div><div class="flex max-h-[50vh] flex-col gap-2 overflow-y-scroll pr-4 pb-4 pl-2">'),qe=p('<fieldset class="relative mt-2 -mb-1 rounded-bl-none border-none p-0 dark:border-gray-700"><legend class="m-0 flex w-full p-0"><span class="m-0 w-full rounded-md rounded-b-none border-0 bg-gray-300 p-1 px-2 font-mono text-sm font-medium tracking-wide outline-0 dark:bg-gray-700"></span></legend><div class="flex flex-row flex-wrap place-content-evenly overflow-hidden rounded-md rounded-t-none">'),ze=p('<span class="min-w-28 flex-1 text-center">');function Ie(e){return(()=>{var t=m(Re),r=t.firstChild,n=r.nextSibling;return g(r,()=>e.rows.length),g(n,d(x,{get each(){return e.rows},children:({testcase:s,...a})=>(()=>{var i=m(qe),o=i.firstChild,l=o.firstChild,c=o.nextSibling;return g(l,s),g(c,d(x,{get each(){return Object.entries(a)},children:([f,h])=>(()=>{var b=m(ze);return g(b,()=>N.stringify({[f]:h})),O($=>V(b,"background-color",re(h))),b})()})),i})()})),O(()=>t.classList.toggle("opacity-50",!!e.error)),t})()}var Fe=p("<span class=text-sm>smoke"),Ke=p('<select class="ml-2 w-32"value="try it">'),De=p('<div class="flex w-full flex-row"><!$><!/><!$><!/>'),He=p('<pre class="text-base opacity-50">cases(({ set, each, ... }) => {'),Ge=p("<option>");function tr(e){const[t,r]=q(z(()=>e.example??"").trim()),[n,s]=q(Array.isArray(e.smoker)?e.smoker[0]:e.smoker),[a]=te(()=>({mode:e.mode,script:t(),smoke:n()}),async({mode:o,script:l,smoke:c})=>{try{return{cases:o==="trials"?await Je(l,c):await Ve(l,c)}}catch(f){return{error:f}}}),i=G(({cases:o}={})=>{switch(a.state){case"pending":return{state:a.state};case"unresolved":case"errored":case"refreshing":case"ready":return{cases:a.latest?.cases??o,error:a?.latest?.error,state:a.state}}});return[d(C,{get when(){return e.smoker},get children(){return[m(Fe),(()=>{var o=m(De),l=o.firstChild,[c,f]=T(l.nextSibling),h=c.nextSibling,[b,$]=T(h.nextSibling);return g(o,d(D,{class:"grow bg-stone-300 dark:bg-stone-600",readwrite:!0,get value(){return n()},onValueChange:s}),c,f),g(o,d(C,{get when(){return Array.isArray(e.smoker)},get children(){var y=m(Ke);return y.addEventListener("change",u=>{s(u.target.value)}),g(y,d(x,{get each(){return e.smoker},children:u=>(()=>{var _=m(Ge);return ne(_,"value",u),g(_,u),_})()})),y}}),b,$),o})()]}}),d(C,{get when(){return e.mode!=="trials"},get children(){return m(He)}}),d(D,{readwrite:!0,get value(){return z(t)},onValueChange:r,class:"rounded-md bg-zinc-50 p-2 shadow-md dark:bg-stone-700",javascript:!0}),d(ae,{get fallback(){return d(Le,{get rows(){return i()?.cases??[]},get error(){return i()?.error}})},get children(){return d(se,{get when(){return e.mode==="trials"},get children(){return d(Ie,{get rows(){return i()?.cases??[]},get error(){return i()?.error}})}})}})]}async function Ve(e,t){return(await M(r=>{const n=Object.entries(r);new Function(...n.map(([i])=>i),e)(...n.map(([,i])=>i));const{fun:s,get:a}=r;s("trial",a("trial","stub")),W(r,U(t))})).map(r=>r.environment)}async function Je(e,t){const r=Object.entries({stop:void 0,cases:we,trial:ye,gamut(...n){try{w.unshift({...w[0]}),ve(...n)}finally{w.shift()}}});try{await he(()=>be(()=>new Function(...r.map(([i])=>i),e)(...r.map(([,i])=>i))));const n=await K({}),s=(await Promise.all(n.flatMap(async({descriptions:i})=>{let o;for(const l of i)o=await M(l,o);return o??[]}))).flat(1);return(await M(i=>W(i,U(t)),s)).map(({environment:{"::testexecution":i,testcase:o,...l}})=>({testcase:o,...l}))}catch(n){throw console.warn("error generating testcases",n),n}finally{w.splice(0,w.length,{}),await K({})}}const w=[{}],Qe=new Proxy({},{ownKeys(){return Object.getOwnPropertyNames(w[0])},getOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(w[0],t)},has(e,t){return t in w[0]},set(e,t,r){return w[0][t]=r,!0},get(e,t){return w[0][t]},deleteProperty(e,t){return delete w[0][t],!0}});Object.defineProperty(globalThis,"environment",{configurable:!1,enumerable:!0,get(){return Qe},set(e){Object.assign(w[0],e)}});export{tr as default};
