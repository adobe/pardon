import{J as P}from"./index.Btz51mwu.js";import{m,h}from"./execution-hook-e3NYtyQD.D32r8L4z.js";import{P as w}from"./trial-Cj5iz3_u.D3l6nG93.js";import{i as y,a as g}from"./schema-utils--9Z99Pw3.CcP18aF2.js";import{c as f,z as o}from"./web.DXQyQflz.js";function c(t){return new Response(P.stringify(t),{headers:[["Content-Type","application/json"]]})}function i(){return new Response(null,{status:404})}const[,p]=m(f(1e3),{name:"pid"}),[,x]=m(f(9e3),{name:"oid"}),[a,u]=m(f({}),{name:"products"});function O(){return`P${p(t=>t+1)}`}function S(){return`P${x(t=>t+1)}`}function R(){p(1e3),u({})}const F=h(w,{async fetch({egress:{request:t}},n){const[e,r]=y(t);return g(await b(e,r))}});async function b(t,n){switch(n.method){case"GET":{if(/^[/]products[/]?$/.test(t.pathname))return T(t);const e=/^[/]products[/]([^/]+)?$/.exec(t.pathname);if(e)return _(t,n,{product:e[1]});break}case"PUT":{const e=/^[/]products[/]([^/]+)?$/.exec(t.pathname);if(e)return E(t,n,{product:e[1]});break}case"POST":{if(/^[/]products[/]?$/.test(t.pathname))return $(t,n);if(/^[/]orders[/]?$/.test(t.pathname))return k(t,n);break}case"DELETE":{const e=/^[/]products[/]([^/]+)?$/.exec(t.pathname);if(e)return l(t,n,{product:e[1]});break}}return i()}function T(t,n){return c(Object.entries(o(a)).map(([e,r])=>({...r,id:e})).filter(e=>[...t.searchParams?.keys()||[]].every(r=>t.searchParams.getAll(r).some(s=>e[r]===s))))}function _(t,n,{product:e}){return o(a)[e]?c(o(a)[e]):i()}async function $(t,n){const e=JSON.parse(String(n.body)),r=O();return await new Promise(s=>setTimeout(s,500)),u(s=>({...s,[r]:e})),c({...e,id:r})}async function k(t,n){const e=JSON.parse(String(n.body)),r=S();return await new Promise(s=>setTimeout(s,800)),c({...e,id:r})}async function E(t,n,{product:e}){if(!o(a)[e])return i();const r=JSON.parse(String(n.body)),s={...o(a)[e],...r};return await new Promise(d=>setTimeout(d,500)),u(d=>({...d,[e]:s})),c({...s,id:e})}async function l(t,n,{product:e}){return o(a)[e]?(await new Promise(r=>setTimeout(r,500)),u(({[e]:r,...s})=>s),new Response(null,{status:204})):i()}export{F as P,R as c,i as f,a as p};
