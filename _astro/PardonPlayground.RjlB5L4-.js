import{e as E,z as D,c as C,b as n,x as re,G as V,y as ne,g as p,t as m,h as M,r as b,B as H,f as I,i as _,S as R,o as q,a as U,J as oe,j as ae,k as Y,n as Z,N as ve,I as fe,M as A,D as we,m as xe,u as $e}from"./web.Di1l7vN_.js";import{C as N}from"./CodeMirror.DGkncNyo.js";import{usePardonApplicationContext as se}from"./PardonApplication.CAQnJ1vq.js";import{f as be,P as ye}from"./products-server-hook.D0GdLL7C.js";import{u as ke,T as _e}from"./todo-server-hook.Dj4CrwBI.js";import{K as L,m as Me}from"./index.BDwdYHGq.js";import{I as Se,H as F,J as Pe,P as Ee}from"./trial-DPXB9fCI.Dj3pK0Vu.js";import{q as Te,a as Ce}from"./schema-utils-qbCEesrZ.D4WS2fP6.js";import"./api.CbqjR6t5.js";/* empty css                                 */import{h as je}from"./execution-hook-BoAbYzcm.DlAui30b.js";import"./store.CJja-brN.js";function Be({context:e,execution:t,input:w,restart:c}){const $={delayed:(i,o)=>new Promise(l=>setTimeout(()=>l(o),i)),async serviceToken(i){return await new Promise(o=>setTimeout(o,700)),`service-token-${i}-${`${Date.now()}`.slice(-5)}`},async digest(i){return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",new TextEncoder().encode(i)))).map(o=>o.toString(16).padStart(2,"0")).join("")}},d=E(()=>{const i=e();if("error"in i)return{error:i.error};const{compiler:o,collection:l}=i.application,h=(r={},u)=>Se({execution:t,context:{app:()=>i.application,durations:{},timestamps:{},...u,values:r,options:{pretty:!0,...u?.options},runtime:{...$,...u?.runtime}}});return o.import=async(r,u)=>{let g=o.resolve(r,u);const x=l.configurations[g.replace(/^pardon:/,"")];if(x?.export&&(g=o.resolve(x.export,`pardon:${x.path}`)),console.log(i.server,g),i.server==="todo"&&g==="pardon:todo/authorization.ts")return{async authorizeUser({origin:k,username:a}){const{ingress:{secrets:{token:v}}}=await h({origin:k,username:a})`PUT https://todo.example.com/users`();return v},getPassword:function(k){return ke()[k]}};if(i.server==="products"&&g==="pardon:example/products/products-helper.ts")return{async price({product:y,env:k}){const{ingress:{values:{price:a}}}=await h({product:y,env:k})`https://example.com/products/{{product}}`();return a}};console.warn(`no playground import definition for ${g}`)},{pardon:h}});return E(()=>{const i=d();if("error"in i)return{error:i.error};const{pardon:o}=i;try{const l=o({},{}),r=w()?l`${w()}`.init():l.match("");return c(),{execution:r}}catch(l){return{error:l}}})}const ie=re();function Ie(e){const t=D(()=>e.secrets);if(t!==void 0){const[w,c]=C(t);return n(ie.Provider,{value:{secrets:w,setSecrets:c,enabled:!0},get children(){return e.children}})}return V(()=>e.children)}function W(){return ne(ie)??{enabled:!1,secrets:()=>!1}}const le=re();function Re(e){return n(le.Provider,{get value(){return C(void 0)},get children(){return e.children}})}function ce(){return ne(le)}var Le=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M20 12H10m10 0l-4 4m4-4l-4-4M4 4v16">');const He=(e={})=>(()=>{var t=p(Le);return M(t,e,!0),b(),t})();var qe=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 20V10m0 10l4-4m-4 4l-4-4M4 4h16">');const Ae=(e={})=>(()=>{var t=p(qe);return M(t,e,!0),b(),t})();var Ve=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0-4 0"></path><path d="M21 12q-3.6 6-9 6t-9-6q3.6-6 9-6t9 6">');const ze=(e={})=>(()=>{var t=p(Ve);return M(t,e,!0),b(),t})();var Oe=m("<div class=icon-grid><!$><!/><!$><!/>");function De(e){const{secrets:t,enabled:w}=W(),[c]=ce(),$=se(),[d]=H(()=>({response:c(),context:$()}),async({response:r,context:u})=>{if(!u?.application)return r;try{return{result:await r?.execution.reprocess({app:()=>u.application})}}catch(g){return{result:void 0,error:g}}}),[i]=H(()=>({executionHandle:e.executionHandle(),response:d.state!=="pending"?d.latest:void 0}),async({executionHandle:r,response:u})=>{if("error"in r)return{error:new Error("invalid application context",{cause:r.error})};if(u?.result){const{ingress:{values:x,secrets:y}}=u.result;return{data:{values:x,secrets:y}}}const{execution:g}=r;try{const{request:{values:x},redacted:{values:y}}=await g.egress;return{data:{values:y,secrets:x}}}catch(x){return{data:void 0,error:x}}}),o=E(r=>{const u=i.latest?.error,g=i.latest?.data??r?.data??{};return{error:u,data:g}}),l=E(()=>{const{search:r,body:u,...g}=(w&&t()?o()?.data?.secrets:o()?.data?.values)||{};return{...g,...r?{search:String(r)}:null}}),h=E(()=>L.stringify(l(),{indent:2}));return n(N,{class:"max-h-56 overflow-y-auto rounded-md p-2 text-blue-800 dark:bg-stone-700 dark:text-blue-200",get classList(){return{"text-yellow-900 dark:text-purple-300":!c(),"text-green-800 dark:text-green-500":!!c()}},get icon(){return(()=>{var r=p(Oe),u=r.firstChild,[g,x]=I(u.nextSibling),y=g.nextSibling,[k,a]=I(y.nextSibling);return _(r,n(R,{get when(){return c()},get fallback(){return n(He,{color:"gray",class:"text-2xl"})},get children(){return n(Ae,{color:"gray",class:"text-2xl"})}}),g,x),_(r,n(ze,{color:"gray",class:"text-2xl transition-transform hover:rotate-12"}),k,a),q(()=>r.classList.toggle("icon-grid-col",(h()?.split(`
`).length??0)<3)),r})()},readonly:!0,get value(){return h()}})}var Ue=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M5 13a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2z"></path><path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0-2 0m-3-5V7a4 4 0 1 1 8 0v4">');const Fe=(e={})=>(()=>{var t=p(Ue);return M(t,e,!0),b(),t})();var Ne=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M5 13a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2z"></path><path d="M11 16a1 1 0 1 0 2 0a1 1 0 1 0-2 0m-3-5V6a4 4 0 0 1 8 0">');const Ge=(e={})=>(()=>{var t=p(Ne);return M(t,e,!0),b(),t})();var Je=m('<button class="-m-1 rounded-md border-none bg-transparent p-1 leading-none hover:bg-yellow-200 dark:hover:bg-fuchsia-900">'),Ke=m("<div class=icon-grid>");function Qe(e){const{secrets:t,setSecrets:w,enabled:c}=W(),[$]=H(()=>({executionHandle:e.executionHandle()}),async({executionHandle:o})=>{if("error"in o)return{error:new Error("invalid application context",{cause:o.error})};const{execution:l}=o;await new Promise(r=>requestAnimationFrame(r));const h=l.preview;try{await h}catch(r){return{render:void 0,error:ee(r)}}try{const r=await l.egress;return{render:{request:F.stringify({...r.request,values:void 0}),redacted:F.stringify({...r.redacted,values:void 0})}}}catch(r){return{render:void 0,error:ee(r)}}}),d=E(o=>{if($.state==="pending")return{};const l=$.latest?.error,h=$.latest?.render??o?.render;return{error:l,render:h}}),i=E(()=>d()?.error?String(d()?.error):c&&t()?d()?.render?.request:d()?.render?.redacted);return U(oe(()=>e.inflight,o=>{o==="pending"&&e.reset()})),n(N,{get value(){return i()},readonly:!0,class:"rounded-md bg-neutral-200 p-2 shadow outline-gray-500 dark:bg-fuchsia-950",get classList(){return{[e.class??""]:!0,...e.classList,"opacity-50":!!(d()?.error||$.loading)}},get icon(){return(()=>{var o=p(Ke);return _(o,n(R,{when:c,get children(){var l=p(Je);return l.$$mousedown=()=>c&&w(h=>!h),_(l,n(R,{get when(){return c&&t()},get fallback(){return n(Fe,{color:"gray",class:"text-2xl"})},get children(){return n(Ge,{color:"gray",class:"text-2xl"})}})),b(),l}})),q(()=>o.classList.toggle("icon-grid-col",(i()?.split(`
`).length??0)<4)),o})()}})}function ee(e){const t=[];for(t.unshift(String(e?.message??e));e.cause;)e=e.cause,t.unshift(String(e?.message??e));return t.join(`
`)}ae(["mousedown"]);var We=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4m-4 4a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4">');const Xe=(e={})=>(()=>{var t=p(We);return M(t,e,!0),b(),t})();var Ye=m('<div class="flex flex-row gap-2"><button class="light:border-purple-800 flex-1 rounded-xl border-2 p-2 pl-4 text-left !font-mono text-xl !font-extrabold shadow-md active:shadow-sm enabled:cursor-pointer disabled:opacity-50 dark:border-white dark:shadow-amber-200/25"></button><button class="light:bg-gray-300 light:disabled:text-gray-400 aspect-square rounded-xl border-2 border-gray-600 p-2 shadow-md active:shadow-sm enabled:cursor-pointer dark:bg-gray-500 dark:disabled:bg-neutral-700 [:not(:disabled)]:active:bg-gray-500">'),Ze=m('<button class="-m-1 rounded-md border-none bg-transparent p-1 leading-none hover:bg-emerald-100 dark:hover:bg-lime-900">'),et=m("<div class=icon-grid>");function tt(e){const{secrets:t,setSecrets:w,enabled:c}=W(),[,$]=ce(),[d,i]=C(()=>({inflight:"pending",gate:void 0})),o=E(()=>d()().inflight),l=E(()=>d()().gate),[h]=H(()=>({executionHandle:e.executionHandle()}),async({executionHandle:{execution:a,error:v}})=>{try{return v?{error:v}:await a?.egress}catch(s){return{error:s}}}),[r]=H(()=>({executionHandle:e.executionHandle()}),async({executionHandle:a})=>{const[v,s]=C("pending"),[f,S]=C();if(i(()=>E(()=>({inflight:v(),gate:f()}))),s("pending"),"error"in a)return{error:new Error("invalid application context",{cause:a.error})};const{execution:P}=a;try{await P.egress}catch(T){return{error:T}}await new Promise(T=>requestAnimationFrame(T));const B=Pe();S(B),await B.promise,s("inflight");try{return{pardon:{result:await P.result,execution:P}}}catch(T){return{error:T}}finally{s("done")}}),[u,g]=C();U(oe(()=>r.state,a=>{g(v=>{if(a==="pending"||a==="refreshing")return{};const s=r.latest?.error,f=r.latest?.pardon??v?.pardon;if(a==="ready"&&r.latest?.pardon){const{output:S}=f.result;e.update(S)}return{pardon:f,error:s}})}));function x(){g(()=>({})),e.reset?.()}const y=E(()=>{const a=u()?.pardon?.result;return a&&(c&&t()?F.responseObject.stringify(a.ingress.response):F.responseObject.stringify(a.ingress.redacted))});U(()=>{$(u()?.pardon)});const k=E(()=>h.latest?.error?"error":h.latest?.redacted?.method??"GET");return[n(Qe,{get executionHandle(){return e.executionHandle},get inflight(){return o()},class:"mb-2",reset:x}),n(R,{get when(){return!!e.server},get children(){var a=p(Ye),v=a.firstChild,s=v.nextSibling;return Y(v,"click",()=>D(l)?.resolution.resolve()),_(v,(()=>{var f=V(()=>!!h.latest?.error);return()=>f()?"...":[V(()=>h.latest?.redacted?.method)," ",V(()=>String(Te(h.latest?.redacted??"none")))]})()),Y(s,"click",x),_(s,n(Xe,{class:"text-2xl"})),q(f=>{var S=o()!=="pending",P={"light:bg-teal-400 dark:bg-teal-800":!["POST","PUT","DELETE"].includes(k()),"light:bg-amber-400 dark:bg-yellow-800":["POST","PUT"].includes(k()),"light:bg-red-400 dark:bg-red-800":["DELETE"].includes(k())},B=r.loading;return S!==f.e&&Z(v,"disabled",f.e=S),f.t=ve(v,P,f.t),B!==f.a&&Z(s,"disabled",f.a=B),f},{e:void 0,t:void 0,a:void 0}),a}}),n(R,{get when(){return y()},get children(){return n(N,{get icon(){return(()=>{var a=p(et);return _(a,n(R,{when:c,get children(){var v=p(Ze);return v.$$mousedown=()=>c&&w(s=>!s),b(),v}})),q(()=>a.classList.toggle("icon-grid-col",!!((y()?.trim()?.split(`
`).length??0)<3))),a})()},get value(){return y()?.trim()},readonly:!0,class:"h-full overflow-y-auto rounded-md bg-emerald-200 p-2 shadow outline-gray-500 dark:bg-lime-800"})}})]}ae(["mousedown"]);var rt=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m6-2h.01M15 10h.01">');const nt=(e={})=>(()=>{var t=p(rt);return M(t,e,!0),b(),t})();var ot=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M20.955 11.104a9 9 0 1 0-9.895 9.847M9 10h.01M15 10h.01"></path><path d="M9.5 15c.658.672 1.56 1 2.5 1q.189 0 .376-.018m6.044-.372a2.1 2.1 0 0 1 2.97 2.97L18 22h-3v-3z">');const at=(e={})=>(()=>{var t=p(ot);return M(t,e,!0),b(),t})();var st=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M12 21a9 9 0 1 1 0-18a9 9 0 0 1 0 18"></path><path d="M15 14c-2 0-3 1-3.5 2.05M9 10h-.01M15 10h-.01">');const it=(e={})=>(()=>{var t=p(st);return M(t,e,!0),b(),t})();var lt=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m8 4l4-1.5"></path><path d="M10 10c-.5-1-2.5-1-3 0m10 0c-.5-1-2.5-1-3 0">');const ct=(e={})=>(()=>{var t=p(lt);return M(t,e,!0),b(),t})();var dt=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m6-2h.01M15 10h.01"></path><path d="M9.5 15.25a3.5 3.5 0 0 1 5 0">');const ut=(e={})=>(()=>{var t=p(dt);return M(t,e,!0),b(),t})();var gt=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m6-2h.01M15 10h.01"></path><path d="M9.5 15a3.5 3.5 0 0 0 5 0">');const ht=(e={})=>(()=>{var t=p(gt);return M(t,e,!0),b(),t})();function pt(e){const t=e.type==="response"?nt:at;return n(fe,{get children(){return[n(A,{get when(){return e.mood==="confused"},get children(){return n(it,{class:"text-2xl",color:"gray"})}}),n(A,{get when(){return e.mood==="confuzzled"},get children(){return n(ct,{class:"text-2xl",color:"gray"})}}),n(A,{get when(){return e.mood==="error"},get children(){return n(ut,{class:"text-2xl",color:"gray"})}}),n(A,{get when(){return e.mood==="thinking"},get children(){return n(t,{class:"pulse text-2xl",color:"gray"})}}),n(A,{get when(){return e.mood==="happy"},get children(){return n(ht,{color:"gray",class:"text-2xl"})}})]}})}function mt(e){const[t]=H(()=>({executionHandle:e.executionHandle()}),async({executionHandle:w})=>{if("error"in w)return"confuzzled";const{execution:c}=w;await new Promise(d=>requestAnimationFrame(d));const $=c.preview;try{await $}catch{return"confused"}await new Promise(d=>requestAnimationFrame(d));try{await c.egress}catch{return"error"}return"happy"});return n(pt,{get mood(){return V(()=>!!t.loading)()?"thinking":t()??"thinking"}})}const te=je(Ee,{async fetch(){return Ce(be())}});var vt=m('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 20h4L18.5 9.5a2.828 2.828 0 1 0-4-4L4 16zm9.5-13.5l4 4">');const ft=(e={})=>(()=>{var t=p(vt);return M(t,e,!0),b(),t})();var wt=m('<div class="not-content pp-app grid gap-2"data-pardon-playground><!$><!/><!$><!/><!$><!/><!$><!/>'),xt=m("<div class=icon-grid><!$><!/><!$><!/>");function Bt(e){const t=se(),w=D(t);if("error"in w)throw new Error("invalid initial application context",{cause:w.error});const{server:c,secrets:$}=e.options,[d,i]=C((w.application.example?.request||"").trim()),[o,l]=C(d());U(()=>l(d()));const[h,r]=C({}),u=Be({context:t,execution:{products:ye,todo:_e,null:te}[c??"null"]??te,input:d,restart:h}),[g,x]=C(),[y,k]=C(!1);function a(s){if(y()){l(s);return}i(s)}function v(s,{clear:f,display:S}){const P=g(),B=P.state.doc.toString(),{[L.unparsed]:T,...G}=L.parse(B,"stream"),{[L.unparsed]:J,...z}=L.parse(s,"stream"),O=J?.trim()||T?.trim(),K=L.stringify(Me({...G,...z},{filter:Q=>!f.includes(Q)}),{indent:2,trailer:O?`
`:""})+(O?.trim()??"");$e(()=>{S&&k(!0);try{P.dispatch([P.state.update({changes:{from:0,to:P.state.doc.length,insert:K}})])}finally{S&&k(!1)}})}return n(Ie,{secrets:$?$==="shown":void 0,get children(){return n(Re,{get children(){var s=p(wt),f=s.firstChild,[S,P]=I(f.nextSibling),B=S.nextSibling,[T,G]=I(B.nextSibling),J=T.nextSibling,[z,O]=I(J.nextSibling),K=z.nextSibling,[Q,de]=I(K.nextSibling);return we(j=>{j.pardonPlayground={update:v}},s),_(s,()=>e.children,S,P),_(s,n(N,{get icon(){return(()=>{var j=p(xt),ue=j.firstChild,[X,ge]=I(ue.nextSibling),he=X.nextSibling,[pe,me]=I(he.nextSibling);return _(j,n(ft,{color:"gray",class:"text-2xl"}),X,ge),_(j,n(R,{get when(){return e.options.response},get children(){return n(mt,{executionHandle:u})}}),pe,me),q(()=>j.classList.toggle("icon-grid-col",(o()?.split(`
`).length??0)<4)),j})()},class:"rounded-md bg-yellow-100 p-2 shadow dark:bg-gray-700",get value(){return D(o)},editorViewRef:x,onValueChange:a}),T,G),_(s,n(tt,{server:c,executionHandle:u,reset:()=>r({}),update:j=>{Object.keys(j).length>0&&v(L.stringify(j),{clear:[],display:!0})}}),z,O),_(s,n(R,{get when(){return e.options.data},get children(){return n(De,{executionHandle:u})}}),Q,de),q(()=>xe(s,"id",e.id)),s}})}})}export{Bt as default};
