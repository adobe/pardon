import{A as o,z as w}from"./web.Di1l7vN_.js";import{r as p}from"./store.CJja-brN.js";import{p as h}from"./trial-DPXB9fCI.Dj3pK0Vu.js";import"./index.BDwdYHGq.js";import"./schema-utils-qbCEesrZ.D4WS2fP6.js";function I(e,a={}){const t=a.storage||globalThis.localStorage,r=a.name||`storage-${o()}`;if(!t)return[e[0],e[1],null];const s=a.storageOptions,y=a.serialize||JSON.stringify.bind(JSON),l=a.deserialize||JSON.parse.bind(JSON),i=t.getItem(r,s),f=typeof e[0]=="function"?c=>{try{const n=l(c);e[1](()=>n)}catch{}}:c=>{try{const n=l(c);e[1](p(n))}catch{}};let m=!0;if(i instanceof Promise?i.then(c=>m&&c&&f(c)):i&&f(i),typeof a.sync?.[0]=="function"){const c=typeof e[0]=="function"?e[0]:()=>e[0];a.sync[0](n=>{n.key!==r||(n.url||globalThis.location.href)!==globalThis.location.href||n.newValue===y(w(c))||f(n.newValue)})}return[e[0],typeof e[0]=="function"?c=>{const n=e[1](c),u=c!=null?y(n):c;return a.sync?.[1](r,u),u!=null?t.setItem(r,u,s):t.removeItem(r,s),m=!1,n}:(...c)=>{e[1](...c);const n=y(w(()=>e[0]));a.sync?.[1](r,n),t.setItem(r,n,s),m=!1},i]}function S({executor:e},a){return h({async init(t){return await a.init?.(t,async r=>e.init(r))??await e.init(t)},async match(t){return await a.match?.(t,async r=>e.match(r))??await e.match(t)},async preview(t){return await a.preview?.(t,async r=>e.preview(r))??await e.preview(t)},async render(t){return await a.render?.(t,async r=>e.render(r))??await e.render(t)},async fetch(t){return await a.fetch?.(t,async r=>e.fetch(r))??await e.fetch(t)},async process(t){const r=await a.process?.(t,async s=>e.process(s))??await e.process(t);return await a.result?.({...t,result:r}),r},error(t,r){a.error?.(t,r),e.error(t,r)}})}export{S as h,I as m};
